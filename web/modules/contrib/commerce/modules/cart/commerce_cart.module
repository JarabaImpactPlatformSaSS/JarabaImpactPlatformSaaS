<?php

/**
 * @file
 * Implements the shopping cart system and add to cart features.
 */

use Drupal\commerce_cart\Hook\CommerceCartHooks;
use Drupal\commerce_cart\Hook\CommerceCartThemeHooks;
use Drupal\commerce_cart\Hook\CommerceCartViewsHooks;
use Drupal\commerce_order\Entity\OrderInterface;
use Drupal\commerce_order\Entity\OrderItemInterface;
use Drupal\Core\Access\AccessResultInterface;
use Drupal\Core\Entity\Display\EntityFormDisplayInterface;
use Drupal\Core\Entity\EntityTypeInterface;
use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Hook\Attribute\LegacyHook;
use Drupal\Core\Session\AccountInterface;
use Drupal\views\Plugin\views\query\QueryPluginBase;
use Drupal\views\ViewExecutable;

/**
 * Implements hook_cron().
 */
#[LegacyHook]
function commerce_cart_cron(): void {
  \Drupal::service(CommerceCartHooks::class)->cron();
}

/**
 * Implements hook_entity_base_field_info().
 */
#[LegacyHook]
function commerce_cart_entity_base_field_info(EntityTypeInterface $entity_type): array {
  return \Drupal::service(CommerceCartHooks::class)
    ->entityBaseFieldInfo($entity_type);
}

/**
 * Implements hook_ENTITY_TYPE_access().
 */
#[LegacyHook]
function commerce_cart_commerce_order_access(OrderInterface $order, string $operation, AccountInterface $account): AccessResultInterface {
  return \Drupal::service(CommerceCartHooks::class)
    ->commerceOrderAccess($order, $operation, $account);
}

/**
 * Implements hook_ENTITY_TYPE_access().
 */
#[LegacyHook]
function commerce_cart_commerce_order_item_access(OrderItemInterface $order_item, $operation, AccountInterface $account): AccessResultInterface {
  return \Drupal::service(CommerceCartHooks::class)
    ->commerceOrderItemAccess($order_item, $operation, $account);
}

/**
 * Implements hook_entity_type_build().
 */
#[LegacyHook]
function commerce_cart_entity_type_build(array &$entity_types): void {
  \Drupal::service(CommerceCartHooks::class)->entityTypeBuild($entity_types);
}

/**
 * Implements hook_form_BASE_FORM_ID_alter() for 'commerce_order_form'.
 */
#[LegacyHook]
function commerce_cart_form_commerce_order_form_alter(array &$form, FormStateInterface $form_state): void {
  \Drupal::service(CommerceCartHooks::class)
    ->formCommerceOrderFormAlter($form, $form_state);
}

/**
 * Implements hook_form_BASE_FORM_ID_alter() for 'commerce_order_item_type_form'.
 */
#[LegacyHook]
function commerce_cart_form_commerce_order_item_type_form_alter(array &$form, FormStateInterface $form_state): void {
  \Drupal::service(CommerceCartHooks::class)
    ->formCommerceOrderItemTypeFormAlter($form, $form_state);
}

/**
 * Implements hook_form_BASE_FORM_ID_alter() for 'commerce_order_type_form'.
 */
#[LegacyHook]
function commerce_cart_form_commerce_order_type_form_alter(array &$form, FormStateInterface $form_state): void {
  \Drupal::service(CommerceCartHooks::class)
    ->formCommerceOrderTypeFormAlter($form, $form_state);
}

/**
 * Implements hook_form_FORM_ID_alter() for 'entity_form_display_edit_form'.
 *
 * Hides irrelevant purchased_entity widgets on the add_to_cart order item
 * form display.
 */
#[LegacyHook]
function commerce_cart_form_entity_form_display_edit_form_alter(array &$form, FormStateInterface $form_state): void {
  \Drupal::service(CommerceCartHooks::class)
    ->formEntityFormDisplayEditFormAlter($form, $form_state);
}

/**
 * Implements hook_entity_form_display_alter().
 */
#[LegacyHook]
function commerce_cart_entity_form_display_alter(EntityFormDisplayInterface $form_display, array $context): void {
  \Drupal::service(CommerceCartHooks::class)
    ->entityFormDisplayAlter($form_display, $context);
}

/**
 * Implements hook_menu_links_discovered_alter().
 */
#[LegacyHook]
function commerce_cart_menu_links_discovered_alter(array &$links): void {
  \Drupal::service(CommerceCartHooks::class)->menuLinksDiscoveredAlter($links);
}

/**
 * Implements hook_user_login().
 */
#[LegacyHook]
function commerce_cart_user_login($account): void {
  \Drupal::service(CommerceCartHooks::class)->userLogin($account);
}

/**
 * Implements hook_views_data_alter().
 */
#[LegacyHook]
function commerce_cart_views_data_alter(array &$data): void {
  \Drupal::service(CommerceCartViewsHooks::class)->viewsDataAlter($data);
}

/**
 * Implements hook_views_query_alter().
 */
#[LegacyHook]
function commerce_cart_views_query_alter(ViewExecutable $view, QueryPluginBase $query): void {
  \Drupal::service(CommerceCartViewsHooks::class)
    ->viewsQueryAlter($view, $query);
}

/**
 * Implements hook_theme().
 */
#[LegacyHook]
function commerce_cart_theme(): array {
  return \Drupal::service(CommerceCartThemeHooks::class)->theme();
}

/**
 * Implements hook_preprocess_HOOK().
 */
#[LegacyHook]
function commerce_cart_preprocess_commerce_order(array &$variables): void {
  \Drupal::service(CommerceCartThemeHooks::class)
    ->preprocessCommerceOrder($variables);
}

/**
 * Implements hook_preprocess_views_view().
 *
 * Moves the commerce_cart_form footer output above the submit buttons.
 */
#[LegacyHook]
function commerce_cart_preprocess_views_view(array &$variables): void {
  \Drupal::service(CommerceCartThemeHooks::class)
    ->preprocessViewsView($variables);
}

/**
 * Prepares variables for the cart block element template.
 */
function template_preprocess_commerce_cart_block(array &$variables): void {
  \Drupal::service(CommerceCartThemeHooks::class)
    ->preprocessCommerceCartBlock($variables);
}
