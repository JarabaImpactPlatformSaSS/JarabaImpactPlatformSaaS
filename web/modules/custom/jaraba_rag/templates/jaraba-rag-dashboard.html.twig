{#
/**
 * @file
 * Template para el Dashboard de Analytics de Jaraba RAG.
 *
 * Variables disponibles:
 * - week_stats: EstadÃ­sticas de la Ãºltima semana
 * - month_stats: EstadÃ­sticas del Ãºltimo mes
 *
 * @see Drupal\jaraba_rag\Controller\RagAdminController::dashboard()
 */
#}

{# Diccionario de etiquetas traducibles #}
{% set labels = {
  'total_queries': 'Consultas Totales'|t,
  'avg_response_time': 'Tiempo Promedio'|t,
  'success_rate': 'Tasa de Ã‰xito'|t,
  'grounding_score': 'Score de Grounding'|t,
  'this_week': 'Esta Semana'|t,
  'this_month': 'Este Mes'|t,
  'no_data': 'Sin datos disponibles'|t,
  'configure': 'Configurar RAG'|t,
  'queries': 'consultas'|t,
  'ms': 'ms'|t,
} %}

<div class="admin-premium rag-dashboard">
  {# Header #}
  <div class="premium-header">
    <div class="premium-header__content">
      <h1 class="premium-header__title">
        <span class="premium-header__icon">ğŸ§ </span>
        {% trans %}Panel de AnalÃ­tica KB{% endtrans %}
      </h1>
      <p class="premium-header__subtitle">
        {% trans %}MÃ©tricas y estadÃ­sticas de la Knowledge Base AI-Nativa{% endtrans %}
      </p>
    </div>
    <div class="premium-header__actions">
      <a href="{{ path('jaraba_rag.settings') }}" class="premium-btn premium-btn--secondary">
        âš™ï¸ {{ labels.configure }}
      </a>
    </div>
  </div>

  {# MÃ©tricas Semanales #}
  <div class="premium-section">
    <h2 class="premium-section__title">
      <span class="premium-section__icon">ğŸ“Š</span>
      {{ labels.this_week }}
    </h2>

    {% if week_stats %}
    <div class="premium-cards">
      <div class="premium-card premium-card--primary">
        <span class="premium-card__icon">ğŸ’¬</span>
        <span class="premium-card__value">{{ week_stats.total_queries|default(0)|number_format }}</span>
        <span class="premium-card__label">{{ labels.total_queries }}</span>
      </div>

      <div class="premium-card premium-card--gold">
        <span class="premium-card__icon">âš¡</span>
        <span class="premium-card__value">{{ week_stats.avg_response_time|default(0)|number_format(0) }} {{ labels.ms }}</span>
        <span class="premium-card__label">{{ labels.avg_response_time }}</span>
      </div>

      <div class="premium-card premium-card--success">
        <span class="premium-card__icon">âœ…</span>
        <span class="premium-card__value">{{ week_stats.success_rate|default(0)|number_format(1) }}%</span>
        <span class="premium-card__label">{{ labels.success_rate }}</span>
      </div>

      <div class="premium-card premium-card--purple">
        <span class="premium-card__icon">ğŸ¯</span>
        <span class="premium-card__value">{{ week_stats.grounding_score|default(0)|number_format(2) }}</span>
        <span class="premium-card__label">{{ labels.grounding_score }}</span>
      </div>
    </div>
    {% else %}
    <div class="premium-empty">
      <span class="premium-empty__icon">ğŸ“­</span>
      <p class="premium-empty__message">{{ labels.no_data }}</p>
    </div>
    {% endif %}
  </div>

  {# MÃ©tricas Mensuales #}
  <div class="premium-section">
    <h2 class="premium-section__title">
      <span class="premium-section__icon">ğŸ“ˆ</span>
      {{ labels.this_month }}
    </h2>

    {% if month_stats %}
    <div class="premium-cards">
      <div class="premium-card premium-card--primary">
        <span class="premium-card__icon">ğŸ’¬</span>
        <span class="premium-card__value">{{ month_stats.total_queries|default(0)|number_format }}</span>
        <span class="premium-card__label">{{ labels.total_queries }}</span>
      </div>

      <div class="premium-card premium-card--gold">
        <span class="premium-card__icon">âš¡</span>
        <span class="premium-card__value">{{ month_stats.avg_response_time|default(0)|number_format(0) }} {{ labels.ms }}</span>
        <span class="premium-card__label">{{ labels.avg_response_time }}</span>
      </div>

      <div class="premium-card premium-card--success">
        <span class="premium-card__icon">âœ…</span>
        <span class="premium-card__value">{{ month_stats.success_rate|default(0)|number_format(1) }}%</span>
        <span class="premium-card__label">{{ labels.success_rate }}</span>
      </div>

      <div class="premium-card premium-card--purple">
        <span class="premium-card__icon">ğŸ¯</span>
        <span class="premium-card__value">{{ month_stats.grounding_score|default(0)|number_format(2) }}</span>
        <span class="premium-card__label">{{ labels.grounding_score }}</span>
      </div>
    </div>
    {% else %}
    <div class="premium-empty">
      <span class="premium-empty__icon">ğŸ“­</span>
      <p class="premium-empty__message">{{ labels.no_data }}</p>
    </div>
    {% endif %}
  </div>

  {# InformaciÃ³n Adicional #}
  <div class="premium-section">
    <h2 class="premium-section__title">
      <span class="premium-section__icon">â„¹ï¸</span>
      {% trans %}InformaciÃ³n{% endtrans %}
    </h2>
    <div class="premium-recommendations">
      <div class="premium-recommendation">
        <div class="premium-recommendation__header">
          <span class="premium-recommendation__icon">ğŸ”—</span>
          <strong>{% trans %}Qdrant Vector DB{% endtrans %}</strong>
        </div>
        <p class="premium-recommendation__message">
          {% trans %}La Knowledge Base utiliza Qdrant como base de datos vectorial para bÃºsquedas semÃ¡nticas de alta velocidad.{% endtrans %}
        </p>
      </div>
      <div class="premium-recommendation">
        <div class="premium-recommendation__header">
          <span class="premium-recommendation__icon">ğŸ›¡ï¸</span>
          <strong>{% trans %}Grounding Validator{% endtrans %}</strong>
        </div>
        <p class="premium-recommendation__message">
          {% trans %}Sistema anti-alucinaciones que verifica que las respuestas estÃ©n fundamentadas en datos reales.{% endtrans %}
        </p>
      </div>
      <div class="premium-recommendation">
        <div class="premium-recommendation__header">
          <span class="premium-recommendation__icon">ğŸ¢</span>
          <strong>{% trans %}Multi-Tenant{% endtrans %}</strong>
        </div>
        <p class="premium-recommendation__message">
          {% trans %}Aislamiento completo de datos por tenant con contexto automÃ¡tico.{% endtrans %}
        </p>
      </div>
    </div>
  </div>

</div>
