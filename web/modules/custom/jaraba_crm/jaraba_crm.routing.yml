# Rutas del módulo Jaraba CRM.
#
# Estructura:
# - /admin/content/* → Collections de entidades
# - /admin/structure/crm-* → Settings para Field UI
# - /crm → Dashboard frontend (ruta limpia)

# =============================================================================
# RUTAS DE SETTINGS (Field UI) - /admin/structure
# =============================================================================

entity.crm_company.settings:
  path: '/admin/structure/crm-company'
  defaults:
    _form: '\Drupal\jaraba_crm\Form\CompanySettingsForm'
    _title: 'Configuración de Empresas'
  requirements:
    _permission: 'administer crm entities'

entity.crm_contact.settings:
  path: '/admin/structure/crm-contact'
  defaults:
    _form: '\Drupal\jaraba_crm\Form\ContactSettingsForm'
    _title: 'Configuración de Contactos'
  requirements:
    _permission: 'administer crm entities'

entity.crm_opportunity.settings:
  path: '/admin/structure/crm-opportunity'
  defaults:
    _form: '\Drupal\jaraba_crm\Form\OpportunitySettingsForm'
    _title: 'Configuración de Oportunidades'
  requirements:
    _permission: 'administer crm entities'

entity.crm_activity.settings:
  path: '/admin/structure/crm-activity'
  defaults:
    _form: '\Drupal\jaraba_crm\Form\ActivitySettingsForm'
    _title: 'Configuración de Actividades'
  requirements:
    _permission: 'administer crm entities'

# =============================================================================
# DASHBOARD FRONTEND - /crm
# =============================================================================

jaraba_crm.dashboard:
  path: '/crm'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmDashboardController::dashboard'
    _title: 'CRM Dashboard'
  requirements:
    _permission: 'view crm entities'

jaraba_crm.pipeline:
  path: '/crm/pipeline'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmDashboardController::pipeline'
    _title: 'Pipeline de Ventas'
  requirements:
    _permission: 'view crm entities'

# =============================================================================
# SETTINGS GLOBALES
# =============================================================================

jaraba_crm.settings:
  path: '/admin/config/jaraba/crm'
  defaults:
    _form: '\Drupal\jaraba_crm\Form\CrmSettingsForm'
    _title: 'Configuración del CRM'
  requirements:
    _permission: 'administer crm entities'

# =============================================================================
# KANBAN BOARD - /crm/kanban
# =============================================================================

jaraba_crm.kanban:
  path: '/crm/kanban'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\PipelineKanbanController::kanban'
    _title: 'Pipeline Kanban'
  requirements:
    _permission: 'view crm entities'

# API: Mover oportunidad entre etapas
jaraba_crm.api.pipeline.move:
  path: '/api/v1/crm/pipeline/move'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\PipelineKanbanController::move'
  methods: [POST]
  requirements:
    _permission: 'edit crm entities'
    _csrf_token: 'TRUE'

# =============================================================================
# PIPELINE STAGE SETTINGS (Field UI)
# =============================================================================

entity.crm_pipeline_stage.settings:
  path: '/admin/structure/crm-pipeline-stage'
  defaults:
    _form: '\Drupal\jaraba_crm\Form\PipelineStageSettingsForm'
    _title: 'Configuracion de Etapas de Pipeline'
  requirements:
    _permission: 'administer crm entities'

# =============================================================================
# REST API — CRM (spec 150 §4)
# =============================================================================

# --- Empresas ---

jaraba_crm.api.companies.list:
  path: '/api/v1/crm/companies'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::listCompanies'
  methods: [GET]
  requirements:
    _permission: 'view crm entities'

jaraba_crm.api.companies.get:
  path: '/api/v1/crm/companies/{id}'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::getCompany'
  methods: [GET]
  requirements:
    _permission: 'view crm entities'
    id: '\d+'

jaraba_crm.api.companies.create:
  path: '/api/v1/crm/companies'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::createCompany'
  methods: [POST]
  requirements:
    _permission: 'create crm entities'
    _csrf_token: 'TRUE'

jaraba_crm.api.companies.update:
  path: '/api/v1/crm/companies/{id}'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::updateCompany'
  methods: [PATCH]
  requirements:
    _permission: 'edit crm entities'
    id: '\d+'

jaraba_crm.api.companies.delete:
  path: '/api/v1/crm/companies/{id}'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::deleteCompany'
  methods: [DELETE]
  requirements:
    _permission: 'delete crm entities'
    id: '\d+'

# --- Contactos ---

jaraba_crm.api.contacts.list:
  path: '/api/v1/crm/contacts'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::listContacts'
  methods: [GET]
  requirements:
    _permission: 'view crm entities'

jaraba_crm.api.contacts.get:
  path: '/api/v1/crm/contacts/{id}'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::getContact'
  methods: [GET]
  requirements:
    _permission: 'view crm entities'
    id: '\d+'

jaraba_crm.api.contacts.create:
  path: '/api/v1/crm/contacts'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::createContact'
  methods: [POST]
  requirements:
    _permission: 'create crm entities'
    _csrf_token: 'TRUE'

jaraba_crm.api.contacts.update:
  path: '/api/v1/crm/contacts/{id}'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::updateContact'
  methods: [PATCH]
  requirements:
    _permission: 'edit crm entities'
    id: '\d+'

jaraba_crm.api.contacts.delete:
  path: '/api/v1/crm/contacts/{id}'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::deleteContact'
  methods: [DELETE]
  requirements:
    _permission: 'delete crm entities'
    id: '\d+'

# --- Oportunidades ---

jaraba_crm.api.opportunities.list:
  path: '/api/v1/crm/opportunities'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::listOpportunities'
  methods: [GET]
  requirements:
    _permission: 'view crm entities'

jaraba_crm.api.opportunities.get:
  path: '/api/v1/crm/opportunities/{id}'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::getOpportunity'
  methods: [GET]
  requirements:
    _permission: 'view crm entities'
    id: '\d+'

jaraba_crm.api.opportunities.create:
  path: '/api/v1/crm/opportunities'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::createOpportunity'
  methods: [POST]
  requirements:
    _permission: 'create crm entities'
    _csrf_token: 'TRUE'

jaraba_crm.api.opportunities.update:
  path: '/api/v1/crm/opportunities/{id}'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::updateOpportunity'
  methods: [PATCH]
  requirements:
    _permission: 'edit crm entities'
    id: '\d+'

jaraba_crm.api.opportunities.delete:
  path: '/api/v1/crm/opportunities/{id}'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::deleteOpportunity'
  methods: [DELETE]
  requirements:
    _permission: 'delete crm entities'
    id: '\d+'

jaraba_crm.api.opportunities.stage:
  path: '/api/v1/crm/opportunities/{id}/stage'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::changeStage'
  methods: [POST]
  requirements:
    _permission: 'edit crm entities'
    _csrf_token: 'TRUE'
    id: '\d+'

jaraba_crm.api.opportunities.won:
  path: '/api/v1/crm/opportunities/{id}/won'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::markWon'
  methods: [POST]
  requirements:
    _permission: 'edit crm entities'
    _csrf_token: 'TRUE'
    id: '\d+'

jaraba_crm.api.opportunities.lost:
  path: '/api/v1/crm/opportunities/{id}/lost'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::markLost'
  methods: [POST]
  requirements:
    _permission: 'edit crm entities'
    _csrf_token: 'TRUE'
    id: '\d+'

# --- Sales Playbook (Doc 186) ---

jaraba_crm.api.opportunities.playbook:
  path: '/api/v1/crm/opportunities/{id}/playbook'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::getPlaybook'
  methods: [GET]
  requirements:
    _permission: 'view crm entities'
    id: '\d+'

jaraba_crm.api.opportunities.bant:
  path: '/api/v1/crm/opportunities/{id}/bant'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::updateBant'
  methods: [PATCH]
  requirements:
    _permission: 'edit crm entities'
    id: '\d+'

# --- Pipeline Stages ---

jaraba_crm.api.pipeline_stages.list:
  path: '/api/v1/crm/pipeline-stages'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::listPipelineStages'
  methods: [GET]
  requirements:
    _permission: 'view crm entities'

jaraba_crm.api.pipeline_stages.reorder:
  path: '/api/v1/crm/pipeline-stages/reorder'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::reorderPipelineStages'
  methods: [POST]
  requirements:
    _permission: 'edit crm entities'
    _csrf_token: 'TRUE'

jaraba_crm.api.pipeline_stages.defaults:
  path: '/api/v1/crm/pipeline-stages/defaults'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::createDefaultStages'
  methods: [POST]
  requirements:
    _permission: 'administer crm entities'
    _csrf_token: 'TRUE'

# --- Actividades ---

jaraba_crm.api.activities.list:
  path: '/api/v1/crm/activities'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::listActivities'
  methods: [GET]
  requirements:
    _permission: 'view crm entities'

jaraba_crm.api.activities.create:
  path: '/api/v1/crm/activities'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::createActivity'
  methods: [POST]
  requirements:
    _permission: 'create crm entities'
    _csrf_token: 'TRUE'

# --- Forecasting ---

jaraba_crm.api.forecast:
  path: '/api/v1/crm/forecast'
  defaults:
    _controller: '\Drupal\jaraba_crm\Controller\CrmApiController::getForecast'
  methods: [GET]
  requirements:
    _permission: 'view crm entities'
