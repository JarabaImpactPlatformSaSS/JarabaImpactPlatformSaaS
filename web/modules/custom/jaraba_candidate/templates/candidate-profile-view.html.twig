{#
/**
 * @file
 * Premium candidate profile view.
 *
 * Variables:
 *   - profile.full_name, headline, summary, city, province
 *   - profile.experience_years, experience_level, education_level
 *   - profile.availability, availability_raw, completion_percent
 *   - profile.photo_url, linkedin_url, github_url, portfolio_url, website_url
 *   - profile.skills[] (name, level, verified)
 *   - profile.experiences[] (company_name, job_title, description, location, start_date, end_date, is_current)
 *   - profile.educations[] (institution, degree, field_of_study, start_date, end_date)
 *   - is_own_profile: boolean
 */
#}

{% set completion = profile.completion_percent|default(0) %}
{% set circumference = 251 %}
{% set dash_offset = circumference - (circumference * completion / 100) %}

<article class="cp-profile">

  {# ── HERO ─────────────────────────────────────────────────────────── #}
  <header class="cp-hero cp-animate-in" style="--cp-stagger: 0">
    <div class="cp-hero__avatar">
      {% if profile.photo_url %}
        <img src="{{ profile.photo_url }}" alt="{{ profile.full_name }}" class="cp-hero__photo">
      {% else %}
        <span class="cp-hero__initial">
          {{ profile.full_name ? profile.full_name|slice(0,1)|upper : '?' }}
        </span>
      {% endif %}
    </div>

    <div class="cp-hero__info">
      <h1 class="cp-hero__name">{{ profile.full_name|default('Perfil en construcción'|t) }}</h1>

      {% if profile.headline %}
        <p class="cp-hero__headline">{{ profile.headline }}</p>
      {% endif %}

      <div class="cp-hero__meta">
        {% if profile.city %}
          <span class="cp-hero__meta-item">
            {{ jaraba_icon('ui', 'map-pin', { variant: 'duotone', size: '16px' }) }}
            {{ profile.city }}{% if profile.province %}, {{ profile.province }}{% endif %}
          </span>
        {% endif %}

        {% if profile.experience_years %}
          <span class="cp-hero__meta-item">
            {{ jaraba_icon('business', 'briefcase', { variant: 'duotone', size: '16px' }) }}
            {{ profile.experience_years }} {{ 'años'|t }}
            {% if profile.experience_level %} · {{ profile.experience_level }}{% endif %}
          </span>
        {% endif %}

        {% if profile.availability %}
          {% set avail_class = 'cp-badge--' ~ profile.availability_raw|default('passive') %}
          <span class="cp-hero__meta-item cp-badge {{ avail_class }}">
            {{ profile.availability }}
          </span>
        {% endif %}
      </div>
    </div>

    {# Completion ring #}
    {% if is_own_profile %}
      <div class="cp-hero__completion" title="{{ 'Perfil completado al'|t }} {{ completion }}%">
        <svg class="cp-ring" viewBox="0 0 90 90" aria-hidden="true">
          <circle class="cp-ring__bg" cx="45" cy="45" r="40" />
          <circle class="cp-ring__fill" cx="45" cy="45" r="40"
                  style="stroke-dasharray: {{ circumference }}; stroke-dashoffset: {{ dash_offset }}" />
        </svg>
        <span class="cp-ring__label">{{ completion }}<small>%</small></span>
      </div>
    {% endif %}

    {# Actions #}
    {% if is_own_profile %}
      <div class="cp-hero__actions">
        <a href="{{ path('jaraba_candidate.my_profile.edit') }}"
           class="cp-btn cp-btn--primary"
           data-slide-panel="profile-edit"
           data-slide-panel-url="{{ path('jaraba_candidate.my_profile.edit') }}"
           data-slide-panel-title="{% trans %}Editar perfil{% endtrans %}">
          {{ jaraba_icon('actions', 'edit', { variant: 'duotone', size: '16px' }) }}
          {{ 'Editar perfil'|t }}
        </a>
      </div>
    {% endif %}
  </header>

  {# ── ABOUT ────────────────────────────────────────────────────────── #}
  {% if profile.summary %}
    <section class="cp-section cp-section--about cp-animate-in" style="--cp-stagger: 1">
      <h2 class="cp-section__title">
        {{ jaraba_icon('ui', 'user', { variant: 'duotone', color: 'naranja-impulso', size: '20px' }) }}
        {% trans %}Sobre mí{% endtrans %}
      </h2>
      <div class="cp-section__body">
        {{ profile.summary|safe_html }}
      </div>

      {% if profile.education_level %}
        <div class="cp-about__detail">
          {{ jaraba_icon('education', 'book-open', { variant: 'duotone', color: 'verde-innovacion', size: '16px' }) }}
          <span>{% trans %}Formación:{% endtrans %} {{ profile.education_level }}</span>
        </div>
      {% endif %}
    </section>
  {% endif %}

  {# ── EXPERIENCE ───────────────────────────────────────────────────── #}
  {% if profile.experiences|length > 0 %}
    <section class="cp-section cp-section--experience cp-animate-in" style="--cp-stagger: 2">
      <h2 class="cp-section__title">
        {{ jaraba_icon('business', 'briefcase', { variant: 'duotone', color: 'naranja-impulso', size: '20px' }) }}
        {% trans %}Experiencia{% endtrans %}
      </h2>
      <div class="cp-timeline">
        {% for exp in profile.experiences %}
          <div class="cp-timeline__item">
            <div class="cp-timeline__dot{% if exp.is_current %} cp-timeline__dot--current{% endif %}"></div>
            <div class="cp-timeline__card">
              <h3 class="cp-timeline__title">{{ exp.job_title }}</h3>
              <p class="cp-timeline__company">
                {{ exp.company_name }}
                {% if exp.location %}<span class="cp-timeline__location"> · {{ exp.location }}</span>{% endif %}
              </p>
              <p class="cp-timeline__dates">
                {% if exp.start_date %}
                  {{ exp.start_date|date('M Y') }}
                {% endif %}
                –
                {% if exp.is_current %}
                  <span class="cp-badge cp-badge--active">{% trans %}Actual{% endtrans %}</span>
                {% elseif exp.end_date %}
                  {{ exp.end_date|date('M Y') }}
                {% endif %}
              </p>
              {% if exp.description %}
                <p class="cp-timeline__desc">{{ exp.description }}</p>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    </section>
  {% endif %}

  {# ── EDUCATION ────────────────────────────────────────────────────── #}
  {% if profile.educations|length > 0 %}
    <section class="cp-section cp-section--education cp-animate-in" style="--cp-stagger: 3">
      <h2 class="cp-section__title">
        {{ jaraba_icon('education', 'graduation-cap', { variant: 'duotone', color: 'naranja-impulso', size: '20px' }) }}
        {% trans %}Educación{% endtrans %}
      </h2>
      <div class="cp-edu-grid">
        {% for edu in profile.educations %}
          <div class="cp-edu-card">
            <h3 class="cp-edu-card__degree">{{ edu.degree }}{% if edu.field_of_study %} — {{ edu.field_of_study }}{% endif %}</h3>
            <p class="cp-edu-card__institution">{{ edu.institution }}</p>
            <p class="cp-edu-card__dates">
              {% if edu.start_date %}{{ edu.start_date|date('Y') }}{% endif %}
              {% if edu.end_date %} – {{ edu.end_date|date('Y') }}{% endif %}
            </p>
          </div>
        {% endfor %}
      </div>
    </section>
  {% endif %}

  {# ── SKILLS ───────────────────────────────────────────────────────── #}
  {% if profile.skills|length > 0 %}
    <section class="cp-section cp-section--skills cp-animate-in" style="--cp-stagger: 4">
      <h2 class="cp-section__title">
        {{ jaraba_icon('ui', 'skills', { variant: 'duotone', color: 'naranja-impulso', size: '20px' }) }}
        {% trans %}Habilidades{% endtrans %}
      </h2>
      <div class="cp-skills">
        {% for skill in profile.skills %}
          <span class="cp-skill cp-skill--{{ skill.level }}">
            {{ skill.name }}
            {% if skill.verified %}
              <span class="cp-skill__verified" title="{% trans %}Verificada{% endtrans %}">
                {{ jaraba_icon('actions', 'verified', { variant: 'duotone', size: '12px' }) }}
              </span>
            {% endif %}
          </span>
        {% endfor %}
      </div>
    </section>
  {% endif %}

  {# ── LINKS ────────────────────────────────────────────────────────── #}
  {% set has_links = profile.linkedin_url or profile.github_url or profile.portfolio_url or profile.website_url %}
  {% if has_links %}
    <section class="cp-section cp-section--links cp-animate-in" style="--cp-stagger: 5">
      <h2 class="cp-section__title">
        {{ jaraba_icon('ui', 'external-link', { variant: 'duotone', color: 'naranja-impulso', size: '20px' }) }}
        {% trans %}Enlaces{% endtrans %}
      </h2>
      <div class="cp-links">
        {% if profile.linkedin_url %}
          <a href="{{ profile.linkedin_url }}" class="cp-link" target="_blank" rel="noopener">
            {{ jaraba_icon('social', 'linkedin', { variant: 'duotone', size: '20px' }) }}
            <span>LinkedIn</span>
          </a>
        {% endif %}
        {% if profile.github_url %}
          <a href="{{ profile.github_url }}" class="cp-link" target="_blank" rel="noopener">
            {{ jaraba_icon('ui', 'code', { variant: 'duotone', size: '20px' }) }}
            <span>GitHub</span>
          </a>
        {% endif %}
        {% if profile.portfolio_url %}
          <a href="{{ profile.portfolio_url }}" class="cp-link" target="_blank" rel="noopener">
            {{ jaraba_icon('ui', 'palette', { variant: 'duotone', size: '20px' }) }}
            <span>{% trans %}Portfolio{% endtrans %}</span>
          </a>
        {% endif %}
        {% if profile.website_url %}
          <a href="{{ profile.website_url }}" class="cp-link" target="_blank" rel="noopener">
            {{ jaraba_icon('ui', 'globe', { variant: 'duotone', size: '20px' }) }}
            <span>{% trans %}Web personal{% endtrans %}</span>
          </a>
        {% endif %}
      </div>
    </section>
  {% endif %}

  {# ── CTA (only for own incomplete profiles) ───────────────────────── #}
  {% if is_own_profile and completion < 100 %}
    <section class="cp-cta cp-animate-in" style="--cp-stagger: 6">
      <div class="cp-cta__icon">
        {{ jaraba_icon('analytics', 'trending-up', { variant: 'duotone', color: 'naranja-impulso', size: '32px' }) }}
      </div>
      <div class="cp-cta__content">
        <h3 class="cp-cta__title">{% trans %}Completa tu perfil para destacar{% endtrans %}</h3>
        <p class="cp-cta__text">{% trans %}Un perfil completo aumenta tus posibilidades de encontrar oportunidades y recibir recomendaciones personalizadas.{% endtrans %}</p>
      </div>
      <a href="{{ path('jaraba_candidate.my_profile.personal') }}"
         class="cp-btn cp-btn--secondary"
         data-slide-panel="profile-section"
         data-slide-panel-url="{{ path('jaraba_candidate.my_profile.personal') }}"
         data-slide-panel-title="{% trans %}Datos Personales{% endtrans %}">
        {{ jaraba_icon('actions', 'edit', { variant: 'duotone', size: '16px' }) }}
        {% trans %}Completar perfil{% endtrans %}
      </a>
    </section>
  {% endif %}

</article>
