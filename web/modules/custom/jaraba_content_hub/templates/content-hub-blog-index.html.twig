{#
/**
 * @file
 * Template: Blog index page — Premium world-class design.
 *
 * Variables (from BlogController::index):
 * - title: Título del blog (configurable desde jaraba_content_hub.settings)
 * - articles: Array de artículos con keys:
 *   id, title, slug, excerpt, reading_time, publish_date,
 *   category_name, category_color, category_url, featured_image, url
 * - categories: Array de categorías con keys:
 *   id, name, slug, color, icon, count, url
 * - trending: Array de artículos trending con keys: id, title, url
 * - current_category: Array with category data when filtering (or NULL)
 *   keys: id, name, slug, description, color, icon, featured_image,
 *   meta_title, meta_description
 * - current_author: NULL (author pages use content-hub-author-page.html.twig)
 * - show_reading_time: Boolean
 * - pager: Array de paginación con keys:
 *   current_page, total_pages, total_articles, has_previous, has_next,
 *   previous_url, next_url, pages (array con number, is_current, url)
 * - stats: Array con total_articles, total_categories
 *
 * Directrices aplicadas:
 * - i18n: Todos los textos con {% trans %}
 * - URLs: path() en vez de strings hardcodeados
 * - Parciales: _article-card.html.twig, _category-filter.html.twig
 * - Iconos: jaraba_icon() del sistema de iconos
 * - CSS: Clases BEM del sistema de diseño con tokens var(--ej-*)
 * - Animaciones: .animate-on-scroll compatible con scroll-animations.js
 */
#}
{{ attach_library('ecosistema_jaraba_theme/content-hub') }}
{{ attach_library('ecosistema_jaraba_theme/scroll-animations') }}
{{ attach_library('ecosistema_jaraba_theme/blog-hero-particles') }}
{{ attach_library('jaraba_content_hub/newsletter-form') }}

<div class="blog-page">

  {# =========================================================
     S1 — HERO: Context-aware (category filter vs main blog)
     ========================================================= #}
  {% if current_category %}
    {# Category-filtered hero — shows category info with back link #}
    <section class="blog-hero blog-hero--category" aria-label="{{ current_category.name }}">
      <div class="blog-hero__container">
        <div class="blog-hero__text">
          <a href="{{ path('jaraba_content_hub.blog') }}" class="blog-hero__back-link">
            {{ jaraba_icon('ui', 'arrow-left', { size: '14px' }) }}
            {% trans %}All articles{% endtrans %}
          </a>
          <span class="blog-hero__eyebrow" style="color: {{ current_category.color|default('#233D63') }}">
            {% if current_category.icon %}
              {{ jaraba_icon('ui', current_category.icon, { size: '14px' }) }}
            {% endif %}
            {% trans %}Category{% endtrans %}
          </span>
          <h1 class="blog-hero__title">{{ current_category.name }}</h1>
          {% if current_category.description %}
            <p class="blog-hero__subtitle">{{ current_category.description }}</p>
          {% endif %}
          <div class="blog-hero__meta-info">
            <span class="blog-hero__count">
              {{ jaraba_icon('ui', 'file-text', { size: '14px' }) }}
              {{ stats.total_articles }}
              {% trans %}articles{% endtrans %}
            </span>
          </div>
        </div>
        {% if current_category.featured_image %}
          <div class="blog-hero__visual">
            <img src="{{ current_category.featured_image }}"
                 alt="{{ current_category.name }}"
                 class="blog-hero__category-image"
                 loading="eager"
                 fetchpriority="high"
                 decoding="async">
          </div>
        {% else %}
          <div class="blog-hero__visual" aria-hidden="true">
            <div class="blog-hero__visual-circle" style="border-color: {{ current_category.color|default('#233D63') }}">
              {% if current_category.icon %}
                {{ jaraba_icon('ui', current_category.icon, { variant: 'duotone', size: '64px' }) }}
              {% else %}
                {{ jaraba_icon('ui', 'folder', { variant: 'duotone', size: '64px' }) }}
              {% endif %}
            </div>
          </div>
        {% endif %}
      </div>
    </section>
  {% else %}
    {# Default blog hero — full premium experience #}
    <section class="blog-hero blog-hero--premium" aria-label="{{ title }}">
      <canvas id="blog-hero-particles" class="blog-hero__particles" aria-hidden="true"></canvas>
      <div class="blog-hero__container">
        <div class="blog-hero__text">
          <span class="blog-hero__eyebrow">
            {{ jaraba_icon('ui', 'book-open', { size: '14px' }) }}
            {% trans %}Knowledge Hub{% endtrans %}
          </span>
          <h1 class="blog-hero__title">{{ title }}</h1>
          <p class="blog-hero__subtitle">
            {% trans %}Insights, strategies, and stories to power your growth. Expert content curated for impact-driven professionals.{% endtrans %}
          </p>
          <div class="blog-hero__actions">
            <a href="#blog-articles" class="blog-hero__cta blog-hero__cta--primary">
              {{ jaraba_icon('ui', 'arrow-down', { size: '16px' }) }}
              {% trans %}Explore articles{% endtrans %}
            </a>
            {% if categories is not empty %}
              <a href="#blog-categories" class="blog-hero__cta blog-hero__cta--secondary">
                {% trans %}Browse categories{% endtrans %}
              </a>
            {% endif %}
          </div>
        </div>
        <div class="blog-hero__visual" aria-hidden="true">
          <div class="blog-hero__visual-circle">
            {{ jaraba_icon('ui', 'book-open', { variant: 'duotone', size: '64px' }) }}
          </div>
        </div>
      </div>
    </section>
  {% endif %}

  {# =========================================================
     S2 — STATS BAR: Credibilidad con números
     ========================================================= #}
  {% if stats.total_articles > 0 or stats.total_categories > 0 %}
    <section class="blog-stats animate-on-scroll" data-delay="100" aria-label="{% trans %}Blog statistics{% endtrans %}">
      <div class="blog-stats__container">
        <div class="blog-stats__grid">
          <div class="blog-stats__card">
            <div class="blog-stats__icon" aria-hidden="true">
              {{ jaraba_icon('ui', 'file-text', { size: '24px' }) }}
            </div>
            <span class="blog-stats__value">{{ stats.total_articles }}</span>
            <span class="blog-stats__label">{% trans %}Articles{% endtrans %}</span>
          </div>
          <div class="blog-stats__card">
            <div class="blog-stats__icon" aria-hidden="true">
              {{ jaraba_icon('ui', 'folder', { size: '24px' }) }}
            </div>
            <span class="blog-stats__value">{{ stats.total_categories }}</span>
            <span class="blog-stats__label">{% trans %}Categories{% endtrans %}</span>
          </div>
          <div class="blog-stats__card">
            <div class="blog-stats__icon" aria-hidden="true">
              {{ jaraba_icon('ui', 'clock', { size: '24px' }) }}
            </div>
            <span class="blog-stats__value">{% trans %}Weekly{% endtrans %}</span>
            <span class="blog-stats__label">{% trans %}Fresh content{% endtrans %}</span>
          </div>
          <div class="blog-stats__card">
            <div class="blog-stats__icon" aria-hidden="true">
              {{ jaraba_icon('ui', 'star', { size: '24px' }) }}
            </div>
            <span class="blog-stats__value">{% trans %}Free{% endtrans %}</span>
            <span class="blog-stats__label">{% trans %}Always open{% endtrans %}</span>
          </div>
        </div>
      </div>
    </section>
  {% endif %}

  {# =========================================================
     S3 — CATEGORY FILTERS: Section header + pills
     ========================================================= #}
  {% if categories is not empty %}
    <section id="blog-categories" class="blog-filters animate-on-scroll" data-delay="150">
      <div class="container">
        <div class="blog-section-header">
          <span class="blog-section-header__eyebrow">{% trans %}Explore{% endtrans %}</span>
          <h2 class="blog-section-header__title">{% trans %}Browse by topic{% endtrans %}</h2>
        </div>
        {% include '@ecosistema_jaraba_theme/partials/_category-filter.html.twig' with {
          categories: categories,
          show_all_link: true,
          all_url: path('jaraba_content_hub.blog')
        } only %}
      </div>
    </section>
  {% endif %}

  {# =========================================================
     S4 — FEATURED ARTICLE: Spotlight (solo en index principal)
     En vistas filtradas por categoria se omite para mostrar grid
     ========================================================= #}
  {% if articles is not empty and not current_category %}
    {% set featured = articles|first %}
    <section class="blog-featured animate-on-scroll" data-delay="100" aria-label="{% trans %}Featured article{% endtrans %}">
      <div class="container">
        <div class="blog-section-header">
          <span class="blog-section-header__eyebrow">
            {{ jaraba_icon('ui', 'star', { size: '14px' }) }}
            {% trans %}Featured{% endtrans %}
          </span>
          <h2 class="blog-section-header__title">{% trans %}Editor's pick{% endtrans %}</h2>
        </div>
        <div class="blog-featured__card">
          {% if featured.featured_image %}
            <a href="{{ featured.url }}" class="blog-featured__image-link" aria-label="{{ featured.title }}">
              <img
                src="{{ featured.featured_image }}"
                {% if featured.featured_image_srcset %}
                  srcset="{{ featured.featured_image_srcset }}"
                  sizes="(max-width: 640px) 100vw, 60vw"
                {% endif %}
                alt="{{ featured.title }}"
                loading="eager"
                class="blog-featured__image"
              >
            </a>
          {% endif %}
          <div class="blog-featured__content">
            {% if featured.category_name %}
              <a href="{{ featured.category_url }}" class="blog-featured__category"
                 style="--category-color: {{ featured.category_color|default('#233D63') }}">
                {{ featured.category_name }}
              </a>
            {% endif %}
            <h3 class="blog-featured__title">
              <a href="{{ featured.url }}">{{ featured.title }}</a>
            </h3>
            {% if featured.excerpt %}
              <p class="blog-featured__excerpt">{{ featured.excerpt|striptags }}</p>
            {% endif %}
            <div class="blog-featured__meta">
              <time datetime="{{ featured.publish_date }}" class="blog-featured__date">
                {{ featured.publish_date|date('d M Y') }}
              </time>
              {% if show_reading_time and featured.reading_time %}
                <span class="blog-featured__reading-time">
                  {{ jaraba_icon('ui', 'clock', { size: '14px' }) }}
                  {{ featured.reading_time }} {% trans %}min read{% endtrans %}
                </span>
              {% endif %}
            </div>
            <a href="{{ featured.url }}" class="blog-featured__read-more">
              {% trans %}Read article{% endtrans %}
              {{ jaraba_icon('ui', 'arrow-right', { size: '16px' }) }}
            </a>
          </div>
        </div>
      </div>
    </section>
  {% endif %}

  {# =========================================================
     S5 — ARTICLES GRID + SIDEBAR
     ========================================================= #}
  <section id="blog-articles" class="blog-content">
    <div class="container">
      {% set grid_articles = current_category ? articles : (articles|length > 1 ? articles|slice(1) : []) %}
      {% if grid_articles is not empty %}
        <div class="blog-section-header animate-on-scroll" data-delay="100">
          <span class="blog-section-header__eyebrow">{% trans %}Latest{% endtrans %}</span>
          <h2 class="blog-section-header__title">
            {% if current_category %}
              {% trans %}Articles in {{ current_category.name }}{% endtrans %}
            {% else %}
              {% trans %}Recent articles{% endtrans %}
            {% endif %}
          </h2>
        </div>
      {% endif %}

      <div class="blog-grid">
        {# --- Main: Articles grid --- #}
        <div class="blog-grid__main">
          {% if grid_articles is not empty %}
            <div class="articles-grid">
              {% for article in grid_articles %}
                <div class="animate-on-scroll" data-delay="{{ loop.index0 * 80 }}">
                  {% include '@ecosistema_jaraba_theme/partials/_article-card.html.twig' with {
                    article: article,
                    show_reading_time: show_reading_time,
                    variant: 'standard'
                  } only %}
                </div>
              {% endfor %}
            </div>

            {# Paginación #}
            {% if pager %}
              <nav class="blog-pagination" aria-label="{% trans %}Blog pagination{% endtrans %}">
                {% if pager.has_previous %}
                  <a href="{{ pager.previous_url }}" class="blog-pagination__link blog-pagination__link--prev"
                     aria-label="{% trans %}Previous page{% endtrans %}">
                    {{ jaraba_icon('ui', 'chevron-left', { size: '16px' }) }}
                    {% trans %}Previous{% endtrans %}
                  </a>
                {% endif %}

                <ol class="blog-pagination__pages">
                  {% for page in pager.pages %}
                    <li>
                      {% if page.is_current %}
                        <span class="blog-pagination__link blog-pagination__link--current"
                              aria-current="page">{{ page.number }}</span>
                      {% else %}
                        <a href="{{ page.url }}" class="blog-pagination__link">{{ page.number }}</a>
                      {% endif %}
                    </li>
                  {% endfor %}
                </ol>

                {% if pager.has_next %}
                  <a href="{{ pager.next_url }}" class="blog-pagination__link blog-pagination__link--next"
                     aria-label="{% trans %}Next page{% endtrans %}">
                    {% trans %}Next{% endtrans %}
                    {{ jaraba_icon('ui', 'chevron-right', { size: '16px' }) }}
                  </a>
                {% endif %}
              </nav>
            {% endif %}

          {% elseif articles is empty %}
            {# Empty state premium #}
            <div class="blog-empty blog-empty--premium">
              <div class="blog-empty__visual" aria-hidden="true">
                <div class="blog-empty__circle">
                  {{ jaraba_icon('ui', 'edit', { variant: 'duotone', size: '48px' }) }}
                </div>
              </div>
              <h2 class="blog-empty__title">
                {% trans %}Content is brewing{% endtrans %}
              </h2>
              <p class="blog-empty__text">
                {% trans %}Our team is crafting expert articles to help you grow. Subscribe below and be the first to know when we publish.{% endtrans %}
              </p>
              <a href="#blog-newsletter" class="blog-empty__cta">
                {{ jaraba_icon('ui', 'bell', { size: '16px' }) }}
                {% trans %}Get notified{% endtrans %}
              </a>
            </div>
          {% endif %}
        </div>

        {# --- Sidebar: Trending + Categories quick links --- #}
        <aside class="blog-grid__sidebar" aria-label="{% trans %}Blog sidebar{% endtrans %}">

          {# Trending widget #}
          {% if trending is not empty %}
            <div class="sidebar-widget sidebar-widget--trending animate-on-scroll" data-delay="200">
              <h2 class="sidebar-widget__title">
                {{ jaraba_icon('ui', 'fire', { size: '18px' }) }}
                {% trans %}Trending now{% endtrans %}
              </h2>
              <ol class="trending-list">
                {% for item in trending %}
                  <li class="trending-list__item">
                    <a href="{{ item.url }}">{{ item.title }}</a>
                  </li>
                {% endfor %}
              </ol>
            </div>
          {% endif %}

          {# Categories sidebar widget #}
          {% if categories is not empty %}
            <div class="sidebar-widget animate-on-scroll" data-delay="250">
              <h2 class="sidebar-widget__title">
                {{ jaraba_icon('ui', 'folder', { size: '18px' }) }}
                {% trans %}Categories{% endtrans %}
              </h2>
              <ul class="sidebar-categories">
                {% for category in categories %}
                  <li class="sidebar-categories__item">
                    <a href="{{ category.url }}" class="sidebar-categories__link">
                      <span class="sidebar-categories__dot" style="background: {{ category.color|default('#233D63') }}"></span>
                      <span class="sidebar-categories__name">{{ category.name }}</span>
                      {% if category.count %}
                        <span class="sidebar-categories__count">{{ category.count }}</span>
                      {% endif %}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}

        </aside>
      </div>
    </div>
  </section>

  {# =========================================================
     S6 — NEWSLETTER CTA: Full-width conversion section
     Inspired by AEI CTA Final pattern
     ========================================================= #}
  <section id="blog-newsletter" class="blog-newsletter-section animate-on-scroll" data-delay="100"
           aria-label="{% trans %}Subscribe to newsletter{% endtrans %}">
    <div class="blog-newsletter-section__container">
      <div class="blog-newsletter-section__content">
        <span class="blog-newsletter-section__eyebrow">
          {{ jaraba_icon('ui', 'mail', { size: '16px' }) }}
          {% trans %}Stay in the loop{% endtrans %}
        </span>
        <h2 class="blog-newsletter-section__title">
          {% trans %}Get expert insights delivered weekly{% endtrans %}
        </h2>
        <p class="blog-newsletter-section__subtitle">
          {% trans %}Join our community of professionals. No spam, just valuable content.{% endtrans %}
        </p>
        <form class="blog-newsletter-section__form newsletter-form" data-newsletter-form method="post"
              action="{{ path('jaraba_content_hub.api.newsletter.subscribe') }}">
          <div class="blog-newsletter-section__input-group">
            <label for="newsletter-email-cta" class="visually-hidden">
              {% trans %}Email address{% endtrans %}
            </label>
            <input
              type="email"
              id="newsletter-email-cta"
              name="email"
              class="blog-newsletter-section__input"
              placeholder="{% trans %}Enter your email{% endtrans %}"
              required
              autocomplete="email"
            >
            <button type="submit" class="blog-newsletter-section__button">
              {% trans %}Subscribe{% endtrans %}
              {{ jaraba_icon('ui', 'arrow-right', { size: '16px' }) }}
            </button>
          </div>
          <div class="newsletter-form__message" role="status" aria-live="polite"></div>
        </form>
        <p class="blog-newsletter-section__footer">
          {% trans %}Free forever. Unsubscribe anytime.{% endtrans %}
        </p>
      </div>
    </div>
  </section>

</div>
