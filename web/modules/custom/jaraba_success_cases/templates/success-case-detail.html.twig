{# 
/**
 * @file
 * Template for the Success Case detail page — World-Class Edition.
 *
 * Narrative structure: Challenge → Solution → Result
 * with visual timeline, gradient hero header, animated metrics,
 * premium quote section, and rich Schema.org structured data.
 *
 * Available variables (flat primitives from Controller):
 * - case.name, case.profession, case.company, case.sector, case.location
 * - case.vertical, case.program_name, case.program_funder, case.program_year
 * - case.challenge_before, case.solution_during, case.result_after
 * - case.quote_short, case.quote_long
 * - case.metrics (JSON decoded array)
 * - case.rating, case.featured
 * - case.website, case.linkedin
 * - case.meta_description
 *
 * Route: /caso-de-exito/{slug}
 *
 * @ingroup jaraba_success_cases
 */
#}

{# Breadcrumb #}
<nav class="sc-detail__breadcrumb" aria-label="{% trans %}Breadcrumb{% endtrans %}">
  <a href="{{ path('jaraba_success_cases.list') }}">{% trans %}Casos de Éxito{% endtrans %}</a>
  <span aria-hidden="true">
    {{ jaraba_icon('ui', 'chevron-right', { size: '12px', color: 'muted' }) }}
  </span>
  <span>{{ case.name }}</span>
</nav>

<article class="sc-detail" itemscope itemtype="https://schema.org/Review">

  {# ═══════════════════════════════════════════════════════════════
     HERO HEADER — Gradient background, large avatar, identity info
     ═══════════════════════════════════════════════════════════════ #}
  <header class="sc-detail__hero">
    <div class="sc-detail__hero-bg"></div>
    <div class="sc-detail__hero-content">
      {# Avatar #}
      <div class="sc-detail__avatar-container">
        {% if case.image_url %}
          <img class="sc-detail__avatar sc-detail__avatar--photo"
               src="{{ case.image_url }}"
               alt="{{ case.name }}"
               loading="eager" width="110" height="110">
        {% else %}
          <div class="sc-detail__avatar sc-detail__avatar--placeholder" aria-hidden="true">
            {{ case.name|first|upper }}
          </div>
        {% endif %}
        {% if case.featured %}
          <span class="sc-detail__featured-badge" title="{% trans %}Caso Destacado{% endtrans %}">
            {{ jaraba_icon('general', 'trophy', { variant: 'duotone', size: '20px', color: 'warning' }) }}
          </span>
        {% endif %}
      </div>

      {# Identity #}
      <div class="sc-detail__identity">
        <h1 class="sc-detail__name" itemprop="author" itemscope itemtype="https://schema.org/Person">
          <span itemprop="name">{{ case.name }}</span>
        </h1>
        {% if case.profession %}
          <p class="sc-detail__profession" itemprop="jobTitle">{{ case.profession }}</p>
        {% endif %}

        <div class="sc-detail__meta-row">
          {% if case.company %}
            <span class="sc-detail__meta-item">
              {{ jaraba_icon('business', 'building', { size: '14px', color: 'impulse' }) }}
              <span>{{ case.company }}</span>
              {% if case.sector %}
                <span class="sc-detail__meta-separator">·</span>
                <span>{{ case.sector }}</span>
              {% endif %}
            </span>
          {% endif %}
          {% if case.location %}
            <span class="sc-detail__meta-item">
              {{ jaraba_icon('general', 'map-pin', { size: '14px', color: 'muted' }) }}
              <span>{{ case.location }}</span>
            </span>
          {% endif %}
        </div>

        {# Badges #}
        <div class="sc-detail__badges">
          {% if case.vertical %}
            <span class="sc-badge sc-badge--{{ case.vertical }}">
              {{ case.vertical|replace({'_': ' '})|capitalize }}
            </span>
          {% endif %}
          {% if case.program_name %}
            <span class="sc-badge sc-badge--program">
              {{ jaraba_icon('general', 'book-open', { size: '12px' }) }}
              {{ case.program_name }}
            </span>
          {% endif %}
        </div>

        {# Rating #}
        {% if case.rating %}
          <div class="sc-detail__rating" aria-label="{{ case.rating }} {% trans %}de 5 estrellas{% endtrans %}">
            {% for i in 1..5 %}
              <span class="sc-star {{ i <= case.rating ? 'sc-star--filled' : '' }}">
                {{ jaraba_icon('general', 'star', { variant: i <= case.rating ? 'duotone' : 'outline', size: '18px', color: i <= case.rating ? 'warning' : 'muted' }) }}
              </span>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  </header>

  {# ═══════════════════════════════════════════════════════════════
     TRANSFORMATION JOURNEY — Visual timeline with 3 premium sections
     ═══════════════════════════════════════════════════════════════ #}
  <section class="sc-journey" aria-label="{% trans %}Recorrido de transformación{% endtrans %}">
    <h2 class="sc-journey__surtitle">{% trans %}Recorrido de Transformación{% endtrans %}</h2>

    <div class="sc-journey__timeline">

      {# ─── El Reto ─── #}
      {% if case.challenge_before %}
        <div class="sc-journey__step sc-journey__step--challenge">
          <div class="sc-journey__connector">
            <div class="sc-journey__dot sc-journey__dot--challenge">
              {{ jaraba_icon('business', 'mountain-peak', { variant: 'duotone', size: '24px', color: 'danger' }) }}
            </div>
          </div>
          <div class="sc-journey__card">
            <span class="sc-journey__step-number">01</span>
            <h3 class="sc-journey__title">{% trans %}El Reto{% endtrans %}</h3>
            <p class="sc-journey__subtitle">{% trans %}La situación antes del programa{% endtrans %}</p>
            <div class="sc-journey__body">{{ case.challenge_before|raw }}</div>
          </div>
        </div>
      {% endif %}

      {# ─── La Solución ─── #}
      {% if case.solution_during %}
        <div class="sc-journey__step sc-journey__step--solution">
          <div class="sc-journey__connector">
            <div class="sc-journey__dot sc-journey__dot--solution">
              {{ jaraba_icon('business', 'lightbulb-spark', { variant: 'duotone', size: '24px', color: 'innovation' }) }}
            </div>
          </div>
          <div class="sc-journey__card">
            <span class="sc-journey__step-number">02</span>
            <h3 class="sc-journey__title">{% trans %}La Solución{% endtrans %}</h3>
            <p class="sc-journey__subtitle">{% trans %}Cómo lo conseguimos juntos{% endtrans %}</p>
            <div class="sc-journey__body">{{ case.solution_during|raw }}</div>
          </div>
        </div>
      {% endif %}

      {# ─── El Resultado ─── #}
      {% if case.result_after %}
        <div class="sc-journey__step sc-journey__step--result">
          <div class="sc-journey__connector">
            <div class="sc-journey__dot sc-journey__dot--result">
              {{ jaraba_icon('business', 'rocket-launch', { variant: 'duotone', size: '24px', color: 'success' }) }}
            </div>
          </div>
          <div class="sc-journey__card">
            <span class="sc-journey__step-number">03</span>
            <h3 class="sc-journey__title">{% trans %}El Resultado{% endtrans %}</h3>
            <p class="sc-journey__subtitle">{% trans %}Impacto real y medible{% endtrans %}</p>
            <div class="sc-journey__body">{{ case.result_after|raw }}</div>
          </div>
        </div>
      {% endif %}

    </div>
  </section>

  {# ═══════════════════════════════════════════════════════════════
     IMPACT METRICS — Animated counter bar with gradient background
     ═══════════════════════════════════════════════════════════════ #}
  {% if case.metrics %}
    <section class="sc-impact" aria-label="{% trans %}Métricas de impacto{% endtrans %}">
      <div class="sc-impact__header">
        {{ jaraba_icon('analytics', 'chart', { variant: 'duotone', size: '28px', color: 'white' }) }}
        <h2 class="sc-impact__title">{% trans %}Impacto en Números{% endtrans %}</h2>
      </div>
      <div class="sc-impact__grid">
        {% for key, value in case.metrics %}
          <div class="sc-impact__card">
            <span class="sc-impact__value" data-counter="{{ value }}">{{ value }}</span>
            <span class="sc-impact__label">{{ key|replace({'_': ' '})|capitalize }}</span>
          </div>
        {% endfor %}
      </div>
    </section>
  {% endif %}

  {# ═══════════════════════════════════════════════════════════════
     TESTIMONIAL QUOTE — Large premium quote block
     ═══════════════════════════════════════════════════════════════ #}
  {% set quote_text = case.quote_long ?? case.quote_short ?? null %}
  {% if quote_text %}
    <section class="sc-testimonial" itemprop="reviewBody">
      <div class="sc-testimonial__decoration" aria-hidden="true">
        <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 8H6v12h8l-4 12h4l4-12V8zm16 0H22v12h8l-4 12h4l4-12V8z" fill="currentColor"/>
        </svg>
      </div>
      <blockquote class="sc-testimonial__text">
        {{ quote_text }}
      </blockquote>
      <cite class="sc-testimonial__author">
        <span class="sc-testimonial__author-avatar" aria-hidden="true">
          {{ case.name|first|upper }}
        </span>
        <span class="sc-testimonial__author-info">
          <strong>{{ case.name }}</strong>
          {% if case.profession %}
            <span>{{ case.profession }}</span>
          {% endif %}
        </span>
      </cite>
    </section>
  {% endif %}

  {# ═══════════════════════════════════════════════════════════════
     PROGRAM CONTEXT — Contextual info card
     ═══════════════════════════════════════════════════════════════ #}
  {% if case.program_funder or case.program_year %}
    <aside class="sc-context">
      <div class="sc-context__icon">
        {{ jaraba_icon('general', 'book-open', { variant: 'duotone', size: '24px', color: 'corporate' }) }}
      </div>
      <div class="sc-context__content">
        <h3 class="sc-context__title">{% trans %}Contexto del Programa{% endtrans %}</h3>
        <div class="sc-context__chips">
          {% if case.program_name %}
            <span class="sc-context__chip">
              {{ jaraba_icon('general', 'book-open', { size: '14px' }) }}
              {{ case.program_name }}
            </span>
          {% endif %}
          {% if case.program_funder %}
            <span class="sc-context__chip">
              {{ jaraba_icon('business', 'building', { size: '14px' }) }}
              {{ case.program_funder }}
            </span>
          {% endif %}
          {% if case.program_year %}
            <span class="sc-context__chip">
              {{ jaraba_icon('actions', 'clock', { size: '14px' }) }}
              {{ case.program_year }}
            </span>
          {% endif %}
        </div>
      </div>
    </aside>
  {% endif %}

  {# ═══════════════════════════════════════════════════════════════
     SHARE BUTTONS — G3
     ═══════════════════════════════════════════════════════════════ #}
  {% set share_url = url('jaraba_success_cases.detail', {slug: case.slug})|render %}
  {% set share_text = case.name ~ ' — ' ~ ('Caso de Éxito'|t) %}
  <div class="sc-detail__share">
    <span class="sc-detail__share-label">{% trans %}Share{% endtrans %}:</span>

    <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ share_url|url_encode }}"
       target="_blank" rel="noopener noreferrer"
       class="sc-detail__share-btn sc-detail__share-btn--linkedin"
       aria-label="{% trans %}Share on LinkedIn{% endtrans %}">
      {{ jaraba_icon('social', 'linkedin', { size: '18px' }) }}
    </a>

    <a href="https://twitter.com/intent/tweet?url={{ share_url|url_encode }}&text={{ share_text|url_encode }}"
       target="_blank" rel="noopener noreferrer"
       class="sc-detail__share-btn sc-detail__share-btn--twitter"
       aria-label="{% trans %}Share on Twitter{% endtrans %}">
      {{ jaraba_icon('social', 'twitter', { size: '18px' }) }}
    </a>

    <a href="https://www.facebook.com/sharer/sharer.php?u={{ share_url|url_encode }}"
       target="_blank" rel="noopener noreferrer"
       class="sc-detail__share-btn sc-detail__share-btn--facebook"
       aria-label="{% trans %}Share on Facebook{% endtrans %}">
      {{ jaraba_icon('social', 'facebook', { size: '18px' }) }}
    </a>

    <a href="https://api.whatsapp.com/send?text={{ share_text|url_encode }}%20{{ share_url|url_encode }}"
       target="_blank" rel="noopener noreferrer"
       class="sc-detail__share-btn sc-detail__share-btn--whatsapp"
       aria-label="{% trans %}Share on WhatsApp{% endtrans %}">
      {{ jaraba_icon('social', 'whatsapp', { size: '18px' }) }}
    </a>
  </div>

  {# ═══════════════════════════════════════════════════════════════
     CONVERSION CTA — G4
     ═══════════════════════════════════════════════════════════════ #}
  <section class="sc-cta" aria-label="{% trans %}Call to action{% endtrans %}">
    <div class="sc-cta__content">
      <h2 class="sc-cta__title">{% trans %}Want results like these?{% endtrans %}</h2>
      <p class="sc-cta__text">{% trans %}Discover how we can help you transform your business or career with our ecosystem of digital tools and programmes.{% endtrans %}</p>
      <div class="sc-cta__buttons">
        <a href="/demo" class="sc-cta__btn sc-cta__btn--primary">
          {{ jaraba_icon('ui', 'play', { size: '16px' }) }}
          {% trans %}Try the Demo{% endtrans %}
        </a>
        <a href="/contacto" class="sc-cta__btn sc-cta__btn--secondary">
          {{ jaraba_icon('ui', 'chat', { size: '16px' }) }}
          {% trans %}Contact Us{% endtrans %}
        </a>
      </div>
    </div>
  </section>

  {# ═══════════════════════════════════════════════════════════════
     RELATED CASES — G5
     ═══════════════════════════════════════════════════════════════ #}
  {% if related_cases is not empty %}
    <section class="sc-related" aria-label="{% trans %}Related success cases{% endtrans %}">
      <h2 class="sc-related__title">
        {% trans %}More stories in{% endtrans %}
        {% if case.vertical %}
          {{ case.vertical|replace({'_': ' '})|capitalize }}
        {% else %}
          {% trans %}our ecosystem{% endtrans %}
        {% endif %}
      </h2>
      <div class="sc-related__grid">
        {% for related in related_cases %}
          {% include '@jaraba_success_cases/success-case-card.html.twig' with { 'case': related } only %}
        {% endfor %}
      </div>
    </section>
  {% endif %}

  {# ═══════════════════════════════════════════════════════════════
     LINKS — Footer actions
     ═══════════════════════════════════════════════════════════════ #}
  <footer class="sc-detail__actions">
    {% if case.website or case.linkedin %}
      <div class="sc-detail__links">
        {% if case.website %}
          <a href="{{ case.website }}" target="_blank" rel="noopener" class="sc-detail__link sc-detail__link--primary">
            {{ jaraba_icon('general', 'globe', { size: '16px' }) }}
            {% trans %}Visit website{% endtrans %}
          </a>
        {% endif %}
        {% if case.linkedin %}
          <a href="{{ case.linkedin }}" target="_blank" rel="noopener" class="sc-detail__link sc-detail__link--linkedin">
            {{ jaraba_icon('ui', 'briefcase', { size: '16px' }) }}
            LinkedIn
          </a>
        {% endif %}
      </div>
    {% endif %}

    <a href="{{ path('jaraba_success_cases.list') }}" class="sc-detail__back-link">
      {{ jaraba_icon('ui', 'chevron-left', { size: '16px' }) }}
      {% trans %}View all Success Stories{% endtrans %}
    </a>
  </footer>

  {# Schema.org JSON-LD — G6: Article (not Review) #}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "{{ case.name|e('js') }} — {{ 'Caso de Éxito'|t|e('js') }}",
    "author": {
      "@type": "Person",
      "name": "{{ case.name|e('js') }}"
      {% if case.profession %}, "jobTitle": "{{ case.profession|e('js') }}"{% endif %}
      {% if case.location %}, "address": "{{ case.location|e('js') }}"{% endif %}
    },
    "description": "{{ (case.meta_description ?? case.quote_short ?? '')|e('js') }}"
    {% if case.image_url %}, "image": "{{ case.image_url|e('js') }}"{% endif %}
    {% if case.vertical %}, "about": "{{ case.vertical|replace({'_': ' '})|capitalize|e('js') }}"{% endif %}
    {% if case.program_name %}, "isPartOf": {
      "@type": "CreativeWork",
      "name": "{{ case.program_name|e('js') }}"
    }{% endif %}
    {% if case.rating %}, "review": {
      "@type": "Review",
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "{{ case.rating }}",
        "bestRating": "5"
      }
    }{% endif %}
  }
  </script>
</article>
