<?php

/**
 * @file
 * Módulo Jaraba A/B Testing: Framework unificado de experimentación.
 *
 * ESTRUCTURA:
 * Implementa hooks para registro de templates (hook_theme) y
 * body classes para páginas del dashboard (hook_preprocess_html).
 *
 * RELACIONES:
 * - jaraba_ab_testing.module -> templates/ (define templates)
 * - jaraba_ab_testing.module -> ABTestingDashboardController (consumido por)
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function jaraba_ab_testing_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    case 'help.page.jaraba_ab_testing':
      $output = '<h3>' . t('About Jaraba A/B Testing') . '</h3>';
      $output .= '<p>' . t('Unified A/B testing framework with statistical engine, weighted variant assignment, and centralized experiment dashboard.') . '</p>';
      return $output;
  }
}

/**
 * Implements hook_theme().
 */
function jaraba_ab_testing_theme($existing, $type, $theme, $path) {
  return [
    // Dashboard principal de A/B testing
    'jaraba_ab_testing_dashboard' => [
      'variables' => [
        'kpis' => [],
        'active_experiments' => [],
        'completed_experiments' => [],
        'all_experiments' => [],
      ],
      'template' => 'ab-testing-dashboard',
      'path' => $path . '/templates',
    ],

    // Detalle de experimento individual
    'jaraba_ab_testing_experiment_detail' => [
      'variables' => [
        'experiment' => [],
        'variants' => [],
        'analysis' => [],
        'funnel' => [],
      ],
      'template' => 'ab-testing-experiment-detail',
      'path' => $path . '/templates',
    ],
  ];
}

/**
 * Implements hook_preprocess_html().
 *
 * Añade body classes para las páginas del dashboard de A/B testing.
 */
function jaraba_ab_testing_preprocess_html(array &$variables): void {
  $route_match = \Drupal::routeMatch();
  $route_name = $route_match->getRouteName();

  if (!$route_name) {
    return;
  }

  $route_classes = [
    'jaraba_ab_testing.dashboard' => ['page--ab-testing', 'page--ab-testing-dashboard'],
    'jaraba_ab_testing.experiment_detail' => ['page--ab-testing', 'page--ab-testing-detail'],
  ];

  if (isset($route_classes[$route_name])) {
    foreach ($route_classes[$route_name] as $class) {
      $variables['attributes']['class'][] = $class;
    }
  }
}
