<?php

/**
 * @file
 * Jaraba Interactive AI-Powered.
 *
 * Sistema de contenido interactivo world-class con IA generativa.
 * Competidor de Coursera, LinkedIn Learning y Duolingo.
 */

declare(strict_types=1);

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function jaraba_interactive_help(string $route_name, RouteMatchInterface $route_match): string {
  if ($route_name === 'help.page.jaraba_interactive') {
    return '<p>' . t('Sistema de contenido interactivo AI-Powered para formaciones y certificaciones. Permite crear cuestionarios, videos interactivos, escenarios ramificados y más.') . '</p>';
  }
  return '';
}

/**
 * Implements hook_theme().
 */
function jaraba_interactive_theme(): array {
  return [
    'interactive_player' => [
      'variables' => [
        'content' => NULL,
        'settings' => [],
        'xapi_endpoint' => '/api/v1/interactive/xapi',
        'enrollment_id' => NULL,
      ],
      'template' => 'interactive-player',
    ],
    'interactive_dashboard' => [
      'variables' => [
        'contents' => [],
        'stats' => [],
      ],
      'template' => 'interactive-dashboard',
    ],
    'interactive_question_set' => [
      'variables' => [
        'questions' => [],
        'settings' => [],
      ],
      'template' => 'interactive-question-set',
    ],
    // =========================================================================
    // Editor de contenido interactivo (Sprint 3 — INT-003)
    // =========================================================================
    'interactive_editor' => [
      'variables' => [
        'content' => NULL,
      ],
      'template' => 'interactive-editor',
    ],
    // =========================================================================
    // Templates de tipos interactivos (Sprint 3 — INT-001)
    // =========================================================================
    'interactive_video' => [
      'variables' => [
        'video_url' => '',
        'poster_url' => '',
        'chapters' => [],
        'checkpoints' => [],
        'settings' => [],
      ],
      'template' => 'types/interactive-video',
    ],
    'interactive_course_presentation' => [
      'variables' => [
        'slides' => [],
        'settings' => [],
      ],
      'template' => 'types/course-presentation',
    ],
    'interactive_branching_scenario' => [
      'variables' => [
        'start_node' => '',
        'nodes' => [],
        'settings' => [],
      ],
      'template' => 'types/branching-scenario',
    ],
    'interactive_drag_and_drop' => [
      'variables' => [
        'drop_zones' => [],
        'draggables' => [],
        'background_image' => '',
        'settings' => [],
      ],
      'template' => 'types/drag-and-drop',
    ],
    'interactive_essay' => [
      'variables' => [
        'prompt' => '',
        'instructions' => '',
        'rubric' => [],
        'settings' => [],
      ],
      'template' => 'types/essay',
    ],
  ];
}

/**
 * Implements hook_preprocess_html().
 *
 * Añade clases al body para páginas del módulo (estándar del proyecto).
 */
function jaraba_interactive_preprocess_html(array &$variables): void {
  $route = \Drupal::routeMatch()->getRouteName();

  if (!$route) {
    return;
  }

  // Rutas de frontend (limpio).
  $frontend_routes = [
    'jaraba_interactive.dashboard',
    'jaraba_interactive.player',
    'jaraba_interactive.editor',
  ];

  if (in_array($route, $frontend_routes, TRUE)) {
    $variables['attributes']['class'][] = 'page-interactive';
    $variables['attributes']['class'][] = 'full-width-layout';
    $variables['attributes']['class'][] = 'premium-portal';
  }

  // Ruta específica del player.
  if ($route === 'jaraba_interactive.player') {
    $variables['attributes']['class'][] = 'page-interactive-player';
  }

  // Ruta específica del dashboard.
  if ($route === 'jaraba_interactive.dashboard') {
    $variables['attributes']['class'][] = 'page-interactive-dashboard';
  }

  // Ruta específica del editor.
  if ($route === 'jaraba_interactive.editor') {
    $variables['attributes']['class'][] = 'page-interactive-editor';
    $variables['attributes']['class'][] = 'zero-region-layout';
  }
}
