# ============================================================================
# RUTAS DEL MÓDULO ECOSISTEMA JARABA CORE
# ============================================================================
# Este archivo define todas las rutas disponibles en el módulo.
# Las rutas están organizadas por funcionalidad:
#   - Dashboard de Tenant Admin
#   - Gestión de entidades (Vertical, SaasPlan, Tenant)
#   - API REST para firma digital (AutoFirma)
#   - Onboarding de nuevos tenants
#   - Webhooks para integraciones externas
# ============================================================================

# ---------------------------------------------------------------------------
# DASHBOARD DEL TENANT ADMIN
# ---------------------------------------------------------------------------

# Panel principal para administradores de tenant
# Muestra estado de suscripción, métricas de uso y acciones rápidas
ecosistema_jaraba_core.tenant.dashboard:
  path: '/tenant/dashboard'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\TenantDashboardController::dashboard'
    _title_callback: '\Drupal\ecosistema_jaraba_core\Controller\TenantDashboardController::getTitle'
  requirements:
    _role: 'tenant_admin+administrator'
  options:
    _admin_route: FALSE

# Página para cambiar de plan (upgrade/downgrade)
# Muestra planes disponibles y permite al tenant cambiar su suscripción
ecosistema_jaraba_core.tenant.change_plan:
  path: '/tenant/change-plan'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\TenantDashboardController::changePlan'
    _title: 'Cambiar Plan'
  requirements:
    _role: 'tenant_admin+administrator'
  options:
    _admin_route: FALSE

# ---------------------------------------------------------------------------
# RUTAS DE ADMINISTRACIÓN - VERTICALES
# ---------------------------------------------------------------------------

# Lista de verticales en el backend de administración
entity.vertical.collection:
  path: '/admin/structure/verticales'
  defaults:
    _entity_list: 'vertical'
    _title: 'Verticales de Negocio'
  requirements:
    _permission: 'administer verticals'

# Formulario para crear una nueva vertical
entity.vertical.add_form:
  path: '/admin/structure/verticales/add'
  defaults:
    _entity_form: 'vertical.add'
    _title: 'Añadir Vertical'
  requirements:
    _permission: 'administer verticals'

# Formulario de edición de vertical existente
entity.vertical.edit_form:
  path: '/admin/structure/verticales/{vertical}/edit'
  defaults:
    _entity_form: 'vertical.edit'
    _title: 'Editar Vertical'
  requirements:
    _permission: 'administer verticals'
  options:
    parameters:
      vertical:
        type: entity:vertical

# Vista canónica de una vertical
entity.vertical.canonical:
  path: '/admin/structure/verticales/{vertical}'
  defaults:
    _entity_view: 'vertical'
    _title_callback: '\Drupal\Core\Entity\Controller\EntityController::title'
  requirements:
    _permission: 'view published verticals'
  options:
    parameters:
      vertical:
        type: entity:vertical

# Formulario de confirmación de eliminación
entity.vertical.delete_form:
  path: '/admin/structure/verticales/{vertical}/delete'
  defaults:
    _entity_form: 'vertical.delete'
    _title: 'Eliminar Vertical'
  requirements:
    _permission: 'administer verticals'
  options:
    parameters:
      vertical:
        type: entity:vertical

# ---------------------------------------------------------------------------
# RUTAS DE ADMINISTRACIÓN - PLANES SAAS
# ---------------------------------------------------------------------------

# Lista de planes de suscripción
entity.saas_plan.collection:
  path: '/admin/structure/saas-plans'
  defaults:
    _entity_list: 'saas_plan'
    _title: 'Planes de Suscripción'
  requirements:
    _permission: 'administer saas plans'

# Crear nuevo plan SaaS
entity.saas_plan.add_form:
  path: '/admin/structure/saas-plans/add'
  defaults:
    _entity_form: 'saas_plan.add'
    _title: 'Añadir Plan SaaS'
  requirements:
    _permission: 'administer saas plans'

# Editar plan SaaS existente
entity.saas_plan.edit_form:
  path: '/admin/structure/saas-plans/{saas_plan}/edit'
  defaults:
    _entity_form: 'saas_plan.edit'
    _title: 'Editar Plan SaaS'
  requirements:
    _permission: 'administer saas plans'
  options:
    parameters:
      saas_plan:
        type: entity:saas_plan

# Vista pública del plan (para páginas de precios)
entity.saas_plan.canonical:
  path: '/planes/{saas_plan}'
  defaults:
    _entity_view: 'saas_plan'
    _title_callback: '\Drupal\Core\Entity\Controller\EntityController::title'
  requirements:
    _permission: 'view published saas plans'
  options:
    parameters:
      saas_plan:
        type: entity:saas_plan

# ---------------------------------------------------------------------------
# RUTAS DE ADMINISTRACIÓN - TENANTS
# ---------------------------------------------------------------------------

# Lista de todos los tenants de la plataforma
entity.tenant.collection:
  path: '/admin/structure/tenants'
  defaults:
    _entity_list: 'tenant'
    _title: 'Tenants de la Plataforma'
  requirements:
    _permission: 'administer tenants'

# Crear nuevo tenant manualmente
entity.tenant.add_form:
  path: '/admin/structure/tenants/add'
  defaults:
    _entity_form: 'tenant.add'
    _title: 'Crear Nuevo Tenant'
  requirements:
    _permission: 'administer tenants'

# Editar tenant existente
entity.tenant.edit_form:
  path: '/admin/structure/tenants/{tenant}/edit'
  defaults:
    _entity_form: 'tenant.edit'
    _title: 'Editar Tenant'
  requirements:
    _permission: 'administer tenants'
  options:
    parameters:
      tenant:
        type: entity:tenant

# Vista detallada de un tenant (dashboard de administración)
entity.tenant.canonical:
  path: '/admin/structure/tenants/{tenant}'
  defaults:
    _entity_view: 'tenant.full'
    _title_callback: '\Drupal\Core\Entity\Controller\EntityController::title'
  requirements:
    _permission: 'view any tenant'
  options:
    parameters:
      tenant:
        type: entity:tenant

# ---------------------------------------------------------------------------
# API REST - AUTOFIRMA / FIRMA DIGITAL
# ---------------------------------------------------------------------------

# Obtener documento en Base64 para firmar con AutoFirma
ecosistema_jaraba_core.autofirma.get_documento:
  path: '/api/v1/autofirma/documento/{document_id}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AutoFirmaController::getDocumento'
  methods: [GET]
  requirements:
    _permission: 'use digital signature' # AUDIT-SEC-002

# Endpoint para recibir el documento firmado desde AutoFirma
ecosistema_jaraba_core.autofirma.recibir_firma:
  path: '/api/v1/autofirma/firmar'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AutoFirmaController::recibirFirma'
  methods: [POST]
  requirements:
    _permission: 'use digital signature' # AUDIT-SEC-002
  options:
    _auth: ['basic_auth', 'cookie']

# Consultar estado de firma de un documento
ecosistema_jaraba_core.autofirma.get_estado:
  path: '/api/v1/autofirma/estado/{document_id}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AutoFirmaController::getEstado'
  methods: [GET]
  requirements:
    _permission: 'use digital signature' # AUDIT-SEC-002

# Verificar disponibilidad de AutoFirma (endpoint público)
ecosistema_jaraba_core.autofirma.check:
  path: '/api/v1/autofirma/check'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AutoFirmaController::checkAutoFirma'
  methods: [GET]
  requirements:
    _access: 'TRUE'

# Generar nuevo documento PDF para firma
ecosistema_jaraba_core.autofirma.generar:
  path: '/api/v1/autofirma/generar'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AutoFirmaController::generarDocumento'
  methods: [POST]
  requirements:
    _permission: 'use digital signature' # AUDIT-SEC-002

# ---------------------------------------------------------------------------
# ONBOARDING DE TENANTS - FLUJO DE REGISTRO
# ---------------------------------------------------------------------------

# Página pública de registro para una vertical específica
ecosistema_jaraba_core.onboarding.register:
  path: '/registro/{vertical}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\OnboardingController::registerForm'
    _title: 'Registra tu Organización'
  requirements:
    _access: 'TRUE'
  options:
    parameters:
      vertical:
        type: entity:vertical

# Procesar formulario de registro (POST)
ecosistema_jaraba_core.onboarding.process:
  path: '/registro/procesar'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\OnboardingController::processRegistration'
  requirements:
    _csrf_token: 'TRUE'
  methods: [POST]

# Paso 2: Selección de plan de suscripción
ecosistema_jaraba_core.onboarding.select_plan:
  path: '/onboarding/seleccionar-plan'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\OnboardingController::selectPlan'
    _title: 'Selecciona tu Plan'
  requirements:
    _permission: 'access content' # AUDIT-SEC-002

# Paso 3: Configurar método de pago con Stripe
ecosistema_jaraba_core.onboarding.setup_payment:
  path: '/onboarding/configurar-pago'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\OnboardingController::setupPayment'
    _title: 'Configurar Método de Pago'
  requirements:
    _permission: 'access content' # AUDIT-SEC-002

# Paso 4: Página de bienvenida post-onboarding
ecosistema_jaraba_core.onboarding.welcome:
  path: '/onboarding/bienvenida'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\OnboardingController::welcome'
    _title: '¡Bienvenido!'
  requirements:
    _permission: 'access content' # AUDIT-SEC-002

# ---------------------------------------------------------------------------
# WEBHOOKS PARA INTEGRACIONES EXTERNAS
# ---------------------------------------------------------------------------

# Webhook de Stripe para eventos de suscripción y pagos
ecosistema_jaraba_core.webhook.stripe:
  path: '/webhook/stripe'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\WebhookController::stripeWebhook'
  requirements:
    _access: 'TRUE'
  methods: [POST]

# Webhook genérico para integraciones personalizadas por tenant
ecosistema_jaraba_core.webhook.custom:
  path: '/webhook/{integration_id}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\WebhookController::customWebhook'
  requirements:
    _access: 'TRUE'
  methods: [POST]

# ---------------------------------------------------------------------------
# API PÚBLICA - PLANES Y PRECIOS
# ---------------------------------------------------------------------------

# Obtener lista de precios para una vertical (para páginas de pricing)
ecosistema_jaraba_core.api.pricing:
  path: '/api/v1/pricing/{vertical}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\PricingController::getPricing'
  requirements:
    _access: 'TRUE'
  methods: [GET]
  options:
    parameters:
      vertical:
        type: entity:vertical

# ---------------------------------------------------------------------------
# API DE STRIPE - SUSCRIPCIONES Y PAGOS
# ---------------------------------------------------------------------------

# Crear suscripción con método de pago de Stripe Elements
ecosistema_jaraba_core.api.stripe.create_subscription:
  path: '/api/v1/stripe/create-subscription'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StripeController::createSubscription'
  requirements:
    _permission: 'manage subscriptions' # AUDIT-SEC-002
  methods: [POST]

# Confirmar suscripción después de 3D Secure
ecosistema_jaraba_core.api.stripe.confirm_subscription:
  path: '/api/v1/stripe/confirm-subscription'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StripeController::confirmSubscription'
  requirements:
    _permission: 'manage subscriptions' # AUDIT-SEC-002
  methods: [POST]

# Crear sesión del portal de clientes de Stripe
ecosistema_jaraba_core.api.stripe.portal:
  path: '/api/v1/stripe/portal-session'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StripeController::createPortalSession'
  requirements:
    _permission: 'manage subscriptions' # AUDIT-SEC-002
  methods: [POST]

# ---------------------------------------------------------------------------
# STRIPE CONNECT - MARKETPLACE SPLIT PAYMENTS
# ---------------------------------------------------------------------------

# Iniciar onboarding de cuenta Connect (crear cuenta Express y redirigir a Stripe)
ecosistema_jaraba_core.api.stripe.connect.onboard:
  path: '/api/v1/stripe/connect/onboard'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StripeController::startConnectOnboarding'
  requirements:
    _permission: 'edit own tenant' # AUDIT-SEC-002
  methods: [POST]

# Callback tras completar onboarding de Stripe Connect
ecosistema_jaraba_core.stripe.connect.return:
  path: '/stripe/connect/return'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StripeController::connectOnboardingReturn'
    _title: 'Configuración de Pagos Completada'
  requirements:
    _permission: 'edit own tenant' # AUDIT-SEC-002

# Página para reintentar onboarding si expira el link
ecosistema_jaraba_core.stripe.connect.refresh:
  path: '/stripe/connect/refresh'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StripeController::connectOnboardingRefresh'
    _title: 'Reintentar Configuración de Pagos'
  requirements:
    _permission: 'edit own tenant' # AUDIT-SEC-002

# Obtener estado de cuenta Connect del tenant actual
ecosistema_jaraba_core.api.stripe.connect.status:
  path: '/api/v1/stripe/connect/status'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StripeController::getConnectStatus'
  requirements:
    _permission: 'edit own tenant' # AUDIT-SEC-002
  methods: [GET]

# Acceder al dashboard de Stripe Express del tenant
ecosistema_jaraba_core.api.stripe.connect.dashboard:
  path: '/api/v1/stripe/connect/dashboard'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StripeController::getConnectDashboard'
  requirements:
    _permission: 'edit own tenant' # AUDIT-SEC-002
  methods: [GET]

# ---------------------------------------------------------------------------
# GEO - GENERATIVE ENGINE OPTIMIZATION
# ---------------------------------------------------------------------------

# Archivo llms.txt para descubrimiento por LLMs (ChatGPT, Perplexity, Claude)
# Similar a robots.txt pero específico para crawlers de IA generativa.
# Estándar: https://llmstxt.org
ecosistema_jaraba_core.llms_txt:
  path: '/llms.txt'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LlmsTxtController::generate'
  requirements:
    _access: 'TRUE'
  methods: [GET]

# ---------------------------------------------------------------------------
# HEALTH DASHBOARD - OBSERVABILIDAD
# ---------------------------------------------------------------------------

# Dashboard principal de salud de la plataforma
ecosistema_jaraba_core.health.dashboard:
  path: '/admin/health'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\HealthDashboardController::dashboard'
    _title: 'Platform Health Dashboard'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: TRUE

# API para obtener estado de salud en tiempo real
ecosistema_jaraba_core.health.api:
  path: '/admin/health/api'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\HealthDashboardController::healthApi'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

# ---------------------------------------------------------------------------
# FINOPS DASHBOARD - COST OPTIMIZATION
# ---------------------------------------------------------------------------

# Dashboard principal de FinOps
ecosistema_jaraba_core.finops.dashboard:
  path: '/admin/finops'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\FinOpsDashboardController::dashboard'
    _title: 'FinOps Dashboard'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: TRUE

# API para obtener datos de FinOps en tiempo real
ecosistema_jaraba_core.finops.api:
  path: '/admin/finops/api'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\FinOpsDashboardController::finopsApi'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

# Configuración de precios FinOps
ecosistema_jaraba_core.finops.settings:
  path: '/admin/config/finops'
  defaults:
    _form: '\Drupal\ecosistema_jaraba_core\Form\FinOpsSettingsForm'
    _title: 'FinOps Settings'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: TRUE

# ---------------------------------------------------------------------------
# TENANT SELF-SERVICE PORTAL
# ---------------------------------------------------------------------------

# Dashboard Self-Service para tenants
# Permite a los tenants ver sus propias métricas sin acceso admin
ecosistema_jaraba_core.tenant_self_service.dashboard:
  path: '/my-dashboard'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\TenantSelfServiceController::dashboard'
    _title: 'Mi Dashboard'
  requirements:
    _permission: 'edit own tenant' # AUDIT-SEC-002
  options:
    _admin_route: FALSE

# Configuración Self-Service del tenant
ecosistema_jaraba_core.tenant_self_service.settings:
  path: '/my-settings'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\TenantSelfServiceController::settings'
    _title: 'Configuración'
  requirements:
    _permission: 'edit own tenant' # AUDIT-SEC-002
  options:
    _admin_route: FALSE

# ---------------------------------------------------------------------------
# TENANT ANALYTICS API - GRÁFICOS DE TENDENCIAS
# ---------------------------------------------------------------------------

# API para datos de tendencias de ventas
ecosistema_jaraba_core.api.tenant_analytics.sales:
  path: '/api/v1/tenant/analytics/sales'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\TenantAnalyticsController::salesTrend'
  requirements:
    _permission: 'view tenant analytics' # AUDIT-SEC-002
  methods: [GET]

# API para datos de MRR
ecosistema_jaraba_core.api.tenant_analytics.mrr:
  path: '/api/v1/tenant/analytics/mrr'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\TenantAnalyticsController::mrrTrend'
  requirements:
    _permission: 'view tenant analytics' # AUDIT-SEC-002
  methods: [GET]

# API para datos de clientes
ecosistema_jaraba_core.api.tenant_analytics.customers:
  path: '/api/v1/tenant/analytics/customers'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\TenantAnalyticsController::customersTrend'
  requirements:
    _permission: 'view tenant analytics' # AUDIT-SEC-002
  methods: [GET]

# API para productos top
ecosistema_jaraba_core.api.tenant_analytics.products:
  path: '/api/v1/tenant/analytics/products'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\TenantAnalyticsController::topProducts'
  requirements:
    _permission: 'view tenant analytics' # AUDIT-SEC-002
  methods: [GET]

# S2-04: Per-tenant analytics HTML dashboard
ecosistema_jaraba_core.tenant_analytics.page:
  path: '/tenant/analytics'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\TenantAnalyticsController::analyticsPage'
    _title: 'Analytics'
  requirements:
    _permission: 'view tenant analytics'
  options:
    _admin_route: FALSE

# ---------------------------------------------------------------------------
# TENANT SELF-SERVICE - CONFIGURACIÓN
# ---------------------------------------------------------------------------

# Formulario de configuración de dominio personalizado
ecosistema_jaraba_core.tenant_self_service.domain:
  path: '/my-settings/domain'
  defaults:
    _form: '\Drupal\ecosistema_jaraba_core\Form\TenantDomainSettingsForm'
    _title: 'Dominio Personalizado'
  requirements:
    _permission: 'edit own tenant' # AUDIT-SEC-002
  options:
    _admin_route: FALSE

# Formulario de gestión de API Keys
ecosistema_jaraba_core.tenant_self_service.api_keys:
  path: '/my-settings/api-keys'
  defaults:
    _form: '\Drupal\ecosistema_jaraba_core\Form\TenantApiKeysForm'
    _title: 'API Keys'
  requirements:
    _permission: 'edit own tenant' # AUDIT-SEC-002
  options:
    _admin_route: FALSE

# Formulario de configuración de Webhooks
ecosistema_jaraba_core.tenant_self_service.webhooks:
  path: '/my-settings/webhooks'
  defaults:
    _form: '\Drupal\ecosistema_jaraba_core\Form\TenantWebhooksForm'
    _title: 'Webhooks'
  requirements:
    _permission: 'manage webhooks' # AUDIT-SEC-002
  options:
    _admin_route: FALSE

# ---------------------------------------------------------------------------
# MARKETPLACE - PHASE 13: CROSS-TENANT VISIBILITY
# ---------------------------------------------------------------------------

# Landing page del Marketplace
ecosistema_jaraba_core.marketplace.landing:
  path: '/marketplace'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\MarketplaceController::landing'
    _title: 'Marketplace'
  requirements:
    _access: 'TRUE'

# Búsqueda en del Marketplace
ecosistema_jaraba_core.marketplace.search:
  path: '/marketplace/search'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\MarketplaceController::search'
    _title: 'Buscar Productos'
  requirements:
    _access: 'TRUE'

# Vista de producto individual en Marketplace
ecosistema_jaraba_core.marketplace.product:
  path: '/marketplace/product/{id}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\MarketplaceController::viewProduct'
    _title: 'Producto'
  requirements:
    _access: 'TRUE'
    id: '\d+'

# ---------------------------------------------------------------------------
# STRIPE SETTINGS
# ---------------------------------------------------------------------------

# Configuración de claves y parámetros de Stripe
ecosistema_jaraba_core.stripe_settings:
  path: '/admin/config/ecosistema-jaraba/stripe'
  defaults:
    _form: '\Drupal\ecosistema_jaraba_core\Form\StripeSettingsForm'
    _title: 'Configuración de Stripe'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: TRUE

# ---------------------------------------------------------------------------
# PHASE 12: ALERTING CONFIGURATION
# ---------------------------------------------------------------------------

# Configuración de alertas Slack/Teams
ecosistema_jaraba_core.alerting_settings:
  path: '/admin/config/system/alerting'
  defaults:
    _form: '\Drupal\ecosistema_jaraba_core\Form\AlertingSettingsForm'
    _title: 'Configuración de Alertas'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: TRUE

# ---------------------------------------------------------------------------
# PHASE 13: AI PROTECTION SETTINGS
# ---------------------------------------------------------------------------

# Configuración de Rate Limiting y protección AI
ecosistema_jaraba_core.rate_limit_settings:
  path: '/admin/config/system/rate-limits'
  defaults:
    _form: '\Drupal\ecosistema_jaraba_core\Form\RateLimitSettingsForm'
    _title: 'Rate Limiting y Protección AI'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: TRUE

# SEC-08: Configuración de headers de seguridad (CORS, CSP, HSTS)
ecosistema_jaraba_core.security_headers_settings:
  path: '/admin/config/system/security-headers'
  defaults:
    _form: '\Drupal\ecosistema_jaraba_core\Form\SecurityHeadersSettingsForm'
    _title: 'Headers de Seguridad'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: TRUE

# ---------------------------------------------------------------------------
# Q1 2027: DEMO INTERACTIVA - TIME-TO-VALUE < 60s
# ---------------------------------------------------------------------------

# Landing de selección de perfil de demo (PÚBLICA)
ecosistema_jaraba_core.demo_landing:
  path: '/demo'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DemoController::demoLanding'
    _title: 'Prueba la Plataforma'
  requirements:
    _access: 'TRUE'

# Iniciar demo con perfil específico (PÚBLICA)
ecosistema_jaraba_core.demo_start:
  path: '/demo/start/{profileId}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DemoController::startDemo'
    _title: 'Demo Interactiva'
  requirements:
    _access: 'TRUE'
    profileId: '[a-z_]+'

# Dashboard de demo con sesión activa
ecosistema_jaraba_core.demo_dashboard:
  path: '/demo/dashboard/{sessionId}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DemoController::demoDashboard'
    _title: 'Dashboard Demo'
  requirements:
    _access: 'TRUE'
    sessionId: '[a-zA-Z0-9_-]+'

# Demo de storytelling con IA
ecosistema_jaraba_core.demo_storytelling:
  path: '/demo/ai/storytelling/{sessionId}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DemoController::demoAiStorytelling'
    _title: 'Genera tu Historia'
  requirements:
    _access: 'TRUE'
    sessionId: '[a-zA-Z0-9_-]+'

# API: Regenerar historia storytelling (POST, CSRF obligatorio)
ecosistema_jaraba_core.demo_api_regenerate_story:
  path: '/api/v1/demo/{sessionId}/regenerate-story'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DemoController::regenerateStory'
  requirements:
    _access: 'TRUE'
    _csrf_request_header_token: 'TRUE'
    sessionId: '[a-zA-Z0-9_-]+'
  methods: [POST]

# API: Track demo action (CSRF obligatorio — S1-03)
ecosistema_jaraba_core.demo_api_track:
  path: '/api/v1/demo/track'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DemoController::trackAction'
  requirements:
    _access: 'TRUE'
    _csrf_request_header_token: 'TRUE'
  methods: [POST]

# API: Get session data
ecosistema_jaraba_core.demo_api_session:
  path: '/api/v1/demo/session/{sessionId}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DemoController::getSessionData'
  requirements:
    _access: 'TRUE'
    sessionId: '[a-zA-Z0-9_-]+'
  methods: [GET]

# API: Convert demo to real account (CSRF obligatorio — S1-03)
ecosistema_jaraba_core.demo_api_convert:
  path: '/api/v1/demo/convert'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DemoController::convertToReal'
  requirements:
    _access: 'TRUE'
    _csrf_request_header_token: 'TRUE'
  methods: [POST]

# API: Dismiss nudge de conversión (S5-02, CSRF obligatorio)
ecosistema_jaraba_core.demo_api_dismiss_nudge:
  path: '/api/v1/demo/dismiss-nudge'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DemoController::dismissNudge'
  requirements:
    _access: 'TRUE'
    _csrf_request_header_token: 'TRUE'
  methods: [POST]

# GAP-AUD-008: Command Bar search API
ecosistema_jaraba_core.command_bar.search:
  path: '/api/v1/command-bar/search'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\CommandBarController::search'
  requirements:
    _user_is_logged_in: 'TRUE'
    _csrf_request_header_token: 'TRUE'
  methods: [GET]

# GAP-AUD-003: AI Playground — Public interactive AI demo
ecosistema_jaraba_core.demo_ai_playground:
  path: '/demo/ai-playground'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DemoController::aiPlayground'
    _title: 'AI Playground'
  requirements:
    _access: 'TRUE'

# ===========================================================================
# API REST V1 - API-FIRST ARCHITECTURE (Q1 2027)
# ===========================================================================
# Documentación: /api/v1/docs  (AUDIT-CONS-N07)
# Spec OpenAPI: /api/v1/openapi.yaml  (AUDIT-CONS-N07)
# ===========================================================================

# Documentación Swagger UI
ecosistema_jaraba_core.api.docs:
  path: '/api/v1/docs'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ApiController::docs'
    _title: 'API Documentation'
  requirements:
    _access: 'TRUE'

# OpenAPI Spec (YAML)
ecosistema_jaraba_core.api.openapi:
  path: '/api/v1/openapi.yaml'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ApiController::openApiSpec'
  requirements:
    _access: 'TRUE'
  methods: [GET]

# ---------------------------------------------------------------------------
# TENANTS API
# ---------------------------------------------------------------------------

# Listar tenants del usuario (requiere autenticación)
ecosistema_jaraba_core.api.v1.tenants:
  path: '/api/v1/tenants'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ApiController::listTenants'
  requirements:
    _permission: 'administer tenants' # AUDIT-SEC-002
  methods: [GET]

# Obtener tenant específico (requiere autenticación)
ecosistema_jaraba_core.api.v1.tenant:
  path: '/api/v1/tenants/{tenantId}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ApiController::getTenant'
  requirements:
    _permission: 'view any tenant' # AUDIT-SEC-002
    tenantId: \d+
  methods: [GET]

# Métricas de uso del tenant (requiere autenticación)
ecosistema_jaraba_core.api.v1.tenant.usage:
  path: '/api/v1/tenants/{tenantId}/usage'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ApiController::getTenantUsage'
  requirements:
    _permission: 'access usage api' # AUDIT-SEC-002
    tenantId: \d+
  methods: [GET]

# ---------------------------------------------------------------------------
# PLANS API
# ---------------------------------------------------------------------------

# Listar planes disponibles
ecosistema_jaraba_core.api.v1.plans:
  path: '/api/v1/plans'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ApiController::listPlans'
  requirements:
    _access: 'TRUE'
  methods: [GET]

# ---------------------------------------------------------------------------
# MARKETPLACE API
# ---------------------------------------------------------------------------

# Listar productos del marketplace
ecosistema_jaraba_core.api.v1.marketplace.products:
  path: '/api/v1/marketplace/products'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ApiController::listMarketplaceProducts'
  requirements:
    _access: 'TRUE'
  methods: [GET]

# Listar categorías del marketplace
ecosistema_jaraba_core.api.v1.marketplace.categories:
  path: '/api/v1/marketplace/categories'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ApiController::listMarketplaceCategories'
  requirements:
    _access: 'TRUE'
  methods: [GET]

# ===========================================================================
# CONTEXTUAL AI COPILOT API (Q1 2027)
# ===========================================================================

# Obtener contexto de página para copilot
ecosistema_jaraba_core.api.copilot.context:
  path: '/api/v1/copilot/context'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\CopilotController::getContext'
  requirements:
    _permission: 'use ai features' # AUDIT-SEC-002
  methods: [GET]

# Generar contenido con IA
ecosistema_jaraba_core.api.copilot.generate:
  path: '/api/v1/copilot/generate'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\CopilotController::generateContent'
  requirements:
    _permission: 'use ai features' # AUDIT-SEC-002
  methods: [POST]

# Autocompletado inteligente
ecosistema_jaraba_core.api.copilot.autocomplete:
  path: '/api/v1/copilot/autocomplete/{field}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\CopilotController::autocomplete'
  requirements:
    _permission: 'use ai features' # AUDIT-SEC-002
  methods: [GET]

# ===========================================================================
# SANDBOX API - TIME-TO-VALUE < 60s (Q1 2027)
# ===========================================================================

# Crear nuevo sandbox temporal (CSRF obligatorio — S1-03)
ecosistema_jaraba_core.api.sandbox.create:
  path: '/api/v1/sandbox/create'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\SandboxController::createSandbox'
  requirements:
    _access: 'TRUE'
    _csrf_request_header_token: 'TRUE'
  methods: [POST]

# Obtener sandbox por ID
ecosistema_jaraba_core.api.sandbox.get:
  path: '/api/v1/sandbox/{id}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\SandboxController::get'
  requirements:
    _access: 'TRUE'
  methods: [GET]

# Registrar engagement en sandbox (CSRF obligatorio — S1-03)
ecosistema_jaraba_core.api.sandbox.track:
  path: '/api/v1/sandbox/{id}/track'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\SandboxController::track'
  requirements:
    _access: 'TRUE'
    _csrf_request_header_token: 'TRUE'
  methods: [POST]

# Convertir sandbox a cuenta real (CSRF obligatorio — S1-03)
ecosistema_jaraba_core.api.sandbox.convert:
  path: '/api/v1/sandbox/{id}/convert'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\SandboxController::convert'
  requirements:
    _access: 'TRUE'
    _csrf_request_header_token: 'TRUE'
  methods: [POST]

# Listar templates disponibles
ecosistema_jaraba_core.api.sandbox.templates:
  path: '/api/v1/sandbox/templates'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\SandboxController::templates'
  requirements:
    _access: 'TRUE'
  methods: [GET]

# Estadísticas de sandboxes
ecosistema_jaraba_core.api.sandbox.stats:
  path: '/api/v1/sandbox/stats'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\SandboxController::stats'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

# ---------------------------------------------------------------------------
# DASHBOARD UNIFICADO - RUTAS ALIAS PARA AVATARES
# ---------------------------------------------------------------------------
# Estas rutas proporcionan una experiencia unificada /dashboard/{avatar}
# mientras redirigen a los dashboards específicos de cada módulo.
# Permite enlaces consistentes desde la homepage y navegación.

# Dashboard Unificado - Redirige segun avatar detectado
# Usa AvatarDetectionService con cascada Domain > Path/UTM > Group > Rol
ecosistema_jaraba_core.dashboard.auto:
  path: '/dashboard'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DashboardRedirectController::redirectByAvatar'
    _title: 'Mi Dashboard'
  requirements:
    _permission: 'access content' # AUDIT-SEC-002

# Dashboard Job Seeker - Alias → /jobseeker
ecosistema_jaraba_core.dashboard.career:
  path: '/dashboard/career'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DashboardRedirectController::redirectToCareer'
    _title: 'Mi Carrera'
  requirements:
    _permission: 'access content' # AUDIT-SEC-002

# Dashboard Recruiter - Alias → /employer
ecosistema_jaraba_core.dashboard.recruiter:
  path: '/dashboard/recruiter'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DashboardRedirectController::redirectToRecruiter'
    _title: 'Panel del Reclutador'
  requirements:
    _permission: 'access content' # AUDIT-SEC-002

# Dashboard Emprendedor - Alias → /entrepreneur/dashboard
ecosistema_jaraba_core.dashboard.entrepreneur:
  path: '/dashboard/entrepreneur'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DashboardRedirectController::redirectToEntrepreneur'
    _title: 'Mi Emprendimiento'
  requirements:
    _permission: 'access content' # AUDIT-SEC-002

# Dashboard Productor/Comercio - Alias → /my-company
ecosistema_jaraba_core.dashboard.producer:
  path: '/dashboard/producer'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DashboardRedirectController::redirectToProducer'
    _title: 'Mi Negocio'
  requirements:
    _permission: 'access content' # AUDIT-SEC-002

# Dashboard Mentor - Alias → /mentor/dashboard
ecosistema_jaraba_core.dashboard.mentor:
  path: '/dashboard/mentor'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\DashboardRedirectController::redirectToMentor'
    _title: 'Panel del Mentor'
  requirements:
    _permission: 'access content' # AUDIT-SEC-002

# ---------------------------------------------------------------------------
# LANDING PAGES PÚBLICAS - VERTICALES
# ---------------------------------------------------------------------------
# Páginas de aterrizaje desde las intention cards de la homepage.
# Cada landing presenta el valor del vertical + CTA registro/login.

# Landing Empleabilidad - Candidatos
ecosistema_jaraba_core.vertical.empleo:
  path: '/empleo'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::empleo'
    _title: 'Encuentra tu próximo empleo'
  requirements:
    _access: 'TRUE'

# Landing Empleabilidad - Empresas/Reclutadores
ecosistema_jaraba_core.vertical.talento:
  path: '/talento'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::talento'
    _title: 'Encuentra el talento que necesitas'
  requirements:
    _access: 'TRUE'

# Landing Emprendimiento
ecosistema_jaraba_core.vertical.emprender:
  path: '/emprender'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::emprender'
    _title: 'Valida tu idea con metodología'
  requirements:
    _access: 'TRUE'

# Landing Comercio/Marketplace
ecosistema_jaraba_core.vertical.comercio:
  path: '/comercio'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::comercio'
    _title: 'Vende tus productos y servicios'
  requirements:
    _access: 'TRUE'

# Landing Instituciones B2G
ecosistema_jaraba_core.vertical.instituciones:
  path: '/instituciones'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::instituciones'
    _title: 'Impulsa tu territorio'
  requirements:
    _access: 'TRUE'

# ---------------------------------------------------------------------------
# IMPERSONATION API - Login As Tenant (D.1)
# ---------------------------------------------------------------------------

# Iniciar sesión de impersonación
ecosistema_jaraba_core.api.impersonate.start:
  path: '/api/v1/admin/impersonate/start'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ImpersonationApiController::start'
  requirements:
    _permission: 'impersonate tenants'
  methods: [POST]

# Terminar sesión de impersonación
ecosistema_jaraba_core.api.impersonate.end:
  path: '/api/v1/admin/impersonate/end'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ImpersonationApiController::end'
  requirements:
    _permission: 'impersonate tenants'
  methods: [POST]

# Estado de sesión de impersonación
ecosistema_jaraba_core.api.impersonate.status:
  path: '/api/v1/admin/impersonate/status'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ImpersonationApiController::status'
  requirements:
    _permission: 'impersonate tenants'
  methods: [GET]

# Logs de impersonación
ecosistema_jaraba_core.api.impersonate.logs:
  path: '/api/v1/admin/impersonate/logs'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ImpersonationApiController::logs'
  requirements:
    _permission: 'view impersonation logs'
  methods: [GET]

# ---------------------------------------------------------------------------
# RBAC MATRIX - Gestión Visual de Permisos (D.2)
# ---------------------------------------------------------------------------

# Dashboard RBAC Matrix
ecosistema_jaraba_core.admin.rbac_matrix:
  path: '/admin/people/rbac-matrix'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\RbacMatrixController::matrix'
    _title: 'Matriz de Permisos RBAC'
  requirements:
    _permission: 'administer permissions'
  options:
    _admin_route: TRUE

# API: Obtener matriz de permisos
ecosistema_jaraba_core.api.rbac.matrix:
  path: '/api/v1/admin/rbac/matrix'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\RbacMatrixController::getMatrix'
  requirements:
    _permission: 'administer permissions'
  methods: [GET]

# API: Toggle permiso
ecosistema_jaraba_core.api.rbac.toggle:
  path: '/api/v1/admin/rbac/toggle'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\RbacMatrixController::togglePermission'
  requirements:
    _permission: 'administer permissions'
  methods: [POST]

# Export CSV
ecosistema_jaraba_core.admin.rbac_export:
  path: '/admin/people/rbac-matrix/export'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\RbacMatrixController::exportCsv'
  requirements:
    _permission: 'administer permissions'

# ---------------------------------------------------------------------------
# HEALTH CHECK PÚBLICO - CI/CD Y MONITORING EXTERNO
# ---------------------------------------------------------------------------
# Endpoint ligero sin autenticación para:
# - GitHub Actions deploy.yml smoke test
# - Load balancer health checks (Blue-Green)
# - UptimeRobot / Pingdom / monitoring externo
#
# Para el dashboard administrativo completo → /admin/health
# ---------------------------------------------------------------------------

ecosistema_jaraba_core.health.check:
  # Path changed from /health to avoid IONOS WAF blocking.
  # IONOS shared hosting blocks common monitoring endpoints like /health.
  path: '/api/v1/platform/status'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\HealthCheckController::check'
  requirements:
    _access: 'TRUE'
  methods: [GET]
  options:
    no_cache: TRUE

# ---------------------------------------------------------------------------
# USAGE DASHBOARD - SELF-SERVICE (G111 / f111)
# ---------------------------------------------------------------------------

# Dashboard de uso y facturación para tenants (frontend)
ecosistema_jaraba_core.usage.dashboard:
  path: '/mi-cuenta/uso'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\UsageDashboardController::dashboard'
    _title: 'Uso y Facturación'
  requirements:
    _permission: 'view own usage'
  options:
    _admin_route: FALSE

# API: Uso del período actual
ecosistema_jaraba_core.api.usage.current:
  path: '/api/v1/usage/current'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\UsageApiController::currentUsage'
  requirements:
    _permission: 'access usage api'
  methods: [GET]

# API: Uso histórico por meses
ecosistema_jaraba_core.api.usage.history:
  path: '/api/v1/usage/history'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\UsageApiController::historicalUsage'
  requirements:
    _permission: 'access usage api'
  methods: [GET]

# API: Factura estimada actual
ecosistema_jaraba_core.api.usage.bill:
  path: '/api/v1/usage/bill'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\UsageApiController::currentBill'
  requirements:
    _permission: 'access usage api'
  methods: [GET]

# API: Proyección de costes fin de mes
ecosistema_jaraba_core.api.usage.forecast:
  path: '/api/v1/usage/forecast'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\UsageApiController::forecast'
  requirements:
    _permission: 'access usage api'
  methods: [GET]

# API: Alertas de presupuesto activas
ecosistema_jaraba_core.api.usage.alerts:
  path: '/api/v1/usage/alerts'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\UsageApiController::budgetAlerts'
  requirements:
    _permission: 'access usage api'
  methods: [GET]

# API: Detalle de una métrica específica
ecosistema_jaraba_core.api.usage.metric_detail:
  path: '/api/v1/usage/metrics/{metric}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\UsageApiController::metricDetail'
  requirements:
    _permission: 'access usage api'
    metric: '[a-z_]+'
  methods: [GET]

# API: Reglas de precios del plan del tenant actual
ecosistema_jaraba_core.api.usage.pricing_rules:
  path: '/api/v1/usage/pricing-rules'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\UsageApiController::pricingRules'
  requirements:
    _permission: 'access usage api'
  methods: [GET]

# =============================================================================
# COMPLIANCE & AUDIT LOG (G115-1, G115-2)
# =============================================================================

# Compliance Dashboard
ecosistema_jaraba_core.compliance_dashboard:
  path: '/admin/seguridad'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ComplianceDashboardController::dashboard'
    _title: 'Compliance & Security Dashboard'
  requirements:
    _permission: 'view audit logs'
  options:
    _admin_route: TRUE

# =============================================================================
# RESELLER / PARTNER PORTAL (G117-4)
# =============================================================================

# Portal de partner/reseller con dashboard de comisiones y tenants
ecosistema_jaraba_core.reseller_portal:
  path: '/partner-portal'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ResellerPortalController::dashboard'
    _title: 'Portal de Partner'
  requirements:
    _permission: 'access partner portal'
  options:
    _admin_route: FALSE

# =============================================================================
# PUSH NOTIFICATIONS API (G109-3)
# =============================================================================

# API: Suscribirse a notificaciones push
ecosistema_jaraba_core.api.push.subscribe:
  path: '/api/v1/push/subscribe'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\PushApiController::subscribe'
  requirements:
    _permission: 'access content' # AUDIT-SEC-002
  methods: [POST]

# API: Cancelar suscripción push
ecosistema_jaraba_core.api.push.unsubscribe:
  path: '/api/v1/push/unsubscribe'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\PushApiController::unsubscribe'
  requirements:
    _permission: 'access content' # AUDIT-SEC-002
  methods: [DELETE]

# API: Enviar notificación push de prueba (solo admin)
ecosistema_jaraba_core.api.push.test:
  path: '/api/v1/push/test'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\PushApiController::test'
  requirements:
    _permission: 'administer tenants'
  methods: [POST]

# =============================================================================
# LEAD MAGNETS PUBLICOS POR VERTICAL (F3 Doc 178)
# =============================================================================
# Rutas publicas sin autenticacion para lead magnets de alto valor.
# Cada vertical tiene un lead magnet especifico que genera valor inmediato
# al visitante anonimo antes de pedir registro.

# Lead Magnet: Calculadora de Madurez Digital (Emprendimiento)
ecosistema_jaraba_core.lead_magnet.calculadora_madurez:
  path: '/emprendimiento/calculadora-madurez'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LeadMagnetController::calculadoraMadurez'
    _title: 'Calculadora de Madurez Digital'
  requirements:
    _access: 'TRUE'

# =============================================================================
# F4 LANDING PAGES VERTICALES — 9 secciones (Doc 180)
# =============================================================================
# Landing pages publicas con estructura completa de 9 secciones:
# Hero, Pain Points, Solution Steps, Features Grid, Social Proof,
# Lead Magnet, Pricing Preview, FAQ (Schema.org), Final CTA.

# Landing AgroConecta — Productores rurales
ecosistema_jaraba_core.landing.agroconecta:
  path: '/agroconecta'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::agroconecta'
    _title: 'AgroConecta - Vende sin intermediarios'
  requirements:
    _access: 'TRUE'

# Landing ComercioConecta — Comercios de proximidad
ecosistema_jaraba_core.landing.comercioconecta:
  path: '/comercioconecta'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::comercioconecta'
    _title: 'ComercioConecta - Digitaliza tu comercio'
  requirements:
    _access: 'TRUE'

# Landing ServiciosConecta — Profesionales liberales
ecosistema_jaraba_core.landing.serviciosconecta:
  path: '/serviciosconecta'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::serviciosconecta'
    _title: 'ServiciosConecta - Tu consulta digitalizada'
  requirements:
    _access: 'TRUE'

# Landing Empleabilidad — Buscadores de empleo
ecosistema_jaraba_core.landing.empleabilidad:
  path: '/empleabilidad'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::empleabilidad'
    _title: 'Empleabilidad - Reinvéntate profesionalmente'
  requirements:
    _access: 'TRUE'

# Landing Emprendimiento — Emprendedores y startups
ecosistema_jaraba_core.landing.emprendimiento:
  path: '/emprendimiento'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::emprendimientoLanding'
    _title: 'Emprendimiento - De idea a negocio rentable'
  requirements:
    _access: 'TRUE'

# Landing JarabaLex — Inteligencia Legal con IA
# Plan Elevación JarabaLex Clase Mundial v1 — Fase 0
ecosistema_jaraba_core.landing.jarabalex:
  path: '/jarabalex'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::jarabalex'
    _title: 'JarabaLex - Inteligencia legal con IA'
  requirements:
    _access: 'TRUE'

# Landing Despachos — Digitalización de despachos de abogados
# Complementa JarabaLex (investigación legal): gestión del despacho.
ecosistema_jaraba_core.landing.despachos:
  path: '/despachos'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::despachos'
    _title: 'Despachos - Digitaliza tu despacho con IA'
  requirements:
    _access: 'TRUE'

# Redirect legacy /legal → /despachos (301 permanent)
# Anteriormente alias de JarabaLex; ahora redirige al vertical Despachos.
ecosistema_jaraba_core.landing.legal:
  path: '/legal'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\VerticalLandingController::legalRedirect'
    _title: 'Redirigiendo…'
  requirements:
    _access: 'TRUE'

# =============================================================================
# /PLANES — PRICING PAGE (178_MetaSite_Remediation)
# =============================================================================
# Página pública de planes y precios con datos dinámicos de ConfigEntities.
# Los datos se leen de SaasPlanTier y SaasPlanFeatures vía MetaSitePricingService.
# DIRECTRIZ: LEGAL-ROUTE-001 (URL en español)

ecosistema_jaraba_core.pricing.page:
  path: '/planes'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\PricingController::pricingPage'
    _title: 'Planes y Precios'
  requirements:
    _access: 'TRUE'
  options:
    _admin_route: FALSE

# Lead Magnet: Guia Vende Online sin Intermediarios (AgroConecta)
ecosistema_jaraba_core.lead_magnet.guia_agroconecta:
  path: '/agroconecta/guia-vende-online'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LeadMagnetController::guiaAgroconecta'
    _title: 'Guia: Vende Online sin Intermediarios'
  requirements:
    _access: 'TRUE'

# Lead Magnet: Auditoria SEO Local (ComercioConecta)
ecosistema_jaraba_core.lead_magnet.auditoria_seo:
  path: '/comercioconecta/auditoria-seo'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LeadMagnetController::auditoriaSeo'
    _title: 'Auditoria SEO Local Gratuita'
  requirements:
    _access: 'TRUE'

# Lead Magnet: Template Propuesta Profesional (ServiciosConecta)
ecosistema_jaraba_core.lead_magnet.template_propuesta:
  path: '/serviciosconecta/template-propuesta'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LeadMagnetController::templatePropuesta'
    _title: 'Template: Propuesta Profesional'
  requirements:
    _access: 'TRUE'

# ---------------------------------------------------------------------------
# LEAD MAGNET SUBMISSION HANDLERS (F3 Doc 178 - POST)
# ---------------------------------------------------------------------------
# Endpoints API para recibir formularios de lead magnets.
# Aceptan JSON con email + name + datos especificos.
# Publicos sin autenticacion para visitantes anonimos.

# POST: Envio de resultados de Calculadora de Madurez Digital
ecosistema_jaraba_core.lead_magnet.calculadora_submit:
  path: '/api/v1/lead-magnet/calculadora-madurez'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LeadMagnetController::submitCalculadora'
  methods: [POST]
  requirements:
    _access: 'TRUE'

# POST: Envio de formulario Guia Vende Online
ecosistema_jaraba_core.lead_magnet.guia_submit:
  path: '/api/v1/lead-magnet/guia-vende-online'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LeadMagnetController::submitGuia'
  methods: [POST]
  requirements:
    _access: 'TRUE'

# POST: Envio de formulario Auditoria SEO Local
ecosistema_jaraba_core.lead_magnet.auditoria_submit:
  path: '/api/v1/lead-magnet/auditoria-seo'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LeadMagnetController::submitAuditoria'
  methods: [POST]
  requirements:
    _access: 'TRUE'

# POST: Envio de formulario Template Propuesta Profesional
ecosistema_jaraba_core.lead_magnet.propuesta_submit:
  path: '/api/v1/lead-magnet/template-propuesta'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LeadMagnetController::submitPropuesta'
  methods: [POST]
  requirements:
    _access: 'TRUE'

# ---------------------------------------------------------------------------
# LEAD MAGNET DOWNLOAD / AUDIT ENDPOINTS (F3 Doc 178 - PDF & SEO)
# ---------------------------------------------------------------------------
# Rutas para descargar documentos PDF (print-ready HTML) y ejecutar
# auditorias SEO desde los lead magnets publicos.

# GET: Descargar Guia AgroConecta como HTML print-ready (PDF via browser)
ecosistema_jaraba_core.lead_magnet.guia_pdf:
  path: '/agroconecta/guia-vende-online/descargar'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LeadMagnetController::downloadGuiaPdf'
    _title: 'Descargar Guia: Vende Online sin Intermediarios'
  methods: [GET]
  requirements:
    _access: 'TRUE'

# GET: Descargar Template Propuesta ServiciosConecta como HTML print-ready
ecosistema_jaraba_core.lead_magnet.propuesta_pdf:
  path: '/serviciosconecta/template-propuesta/descargar'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LeadMagnetController::downloadPropuestaPdf'
    _title: 'Descargar Template: Propuesta Profesional'
  methods: [GET]
  requirements:
    _access: 'TRUE'

# POST: Ejecutar auditoria SEO y devolver resultados JSON
ecosistema_jaraba_core.lead_magnet.auditoria_result:
  path: '/api/v1/lead-magnet/auditoria-seo/analizar'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LeadMagnetController::analyzeUrl'
  methods: [POST]
  requirements:
    _access: 'TRUE'

# =============================================
# F6 — Admin Center Dashboard (Doc 181)
# =============================================

ecosistema_jaraba_core.admin.center:
  path: '/admin/jaraba/center'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterController::dashboard'
    _title: 'Admin Center'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: FALSE

ecosistema_jaraba_core.admin.center.tenants:
  path: '/admin/jaraba/center/tenants'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterController::tenants'
    _title: 'Gestión de Tenants'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: FALSE

ecosistema_jaraba_core.admin.search_api:
  path: '/api/v1/admin/search'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterController::searchApi'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

# ---------------------------------------------------------------------------
# F6 — Admin Center: Tenant Management APIs (Spec f104 §FASE 2)
# ---------------------------------------------------------------------------

# NOTA: export DEBE ir antes del parámetro {group} para evitar colisión.
ecosistema_jaraba_core.admin.tenants.export:
  path: '/api/v1/admin/tenants/export'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::exportTenants'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.tenants.list:
  path: '/api/v1/admin/tenants'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::listTenants'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.tenants.detail:
  path: '/api/v1/admin/tenants/{group}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::tenantDetail'
  requirements:
    _permission: 'administer site configuration'
    group: '\d+'
  methods: [GET]

ecosistema_jaraba_core.admin.tenants.detail_panel:
  path: '/admin/jaraba/center/tenants/{group}/panel'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::tenantDetailPanel'
  requirements:
    _permission: 'administer site configuration'
    group: '\d+'
  methods: [GET]

ecosistema_jaraba_core.admin.tenants.impersonate:
  path: '/api/v1/admin/tenants/{group}/impersonate'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::impersonate'
  requirements:
    _permission: 'administer site configuration'
    group: '\d+'
  methods: [POST]

# ---------------------------------------------------------------------------
# F6 — Admin Center: User Management APIs (Spec f104 §FASE 3)
# ---------------------------------------------------------------------------

ecosistema_jaraba_core.admin.center.users:
  path: '/admin/jaraba/center/users'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterController::users'
    _title: 'Gestión de Usuarios'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: FALSE

ecosistema_jaraba_core.admin.users.list:
  path: '/api/v1/admin/users'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::listUsers'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.users.detail:
  path: '/api/v1/admin/users/{uid}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::userDetail'
  requirements:
    _permission: 'administer site configuration'
    uid: '\d+'
  methods: [GET]

ecosistema_jaraba_core.admin.users.detail_panel:
  path: '/admin/jaraba/center/users/{uid}/panel'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::userDetailPanel'
  requirements:
    _permission: 'administer site configuration'
    uid: '\d+'
  methods: [GET]

ecosistema_jaraba_core.admin.users.force_logout:
  path: '/api/v1/admin/users/{uid}/sessions'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::forceLogout'
  requirements:
    _permission: 'administer site configuration'
    uid: '\d+'
  methods: [DELETE]

# ---------------------------------------------------------------------------
# F6 — Admin Center: Finance Dashboard (Spec f104 §FASE 4)
# ---------------------------------------------------------------------------

ecosistema_jaraba_core.admin.center.finance:
  path: '/admin/jaraba/center/finance'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterController::finance'
    _title: 'Centro Financiero'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: FALSE

ecosistema_jaraba_core.admin.finance.metrics:
  path: '/api/v1/admin/finance/metrics'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::financeMetrics'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.finance.tenants:
  path: '/api/v1/admin/finance/tenants'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::financeTenantAnalytics'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

# ===========================================================================
# ADMIN CENTER — ALERTS & PLAYBOOKS (F6 Doc 181 / Spec f104 §FASE 5)
# ===========================================================================

ecosistema_jaraba_core.admin.center.alerts:
  path: '/admin/jaraba/center/alerts'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterController::alerts'
    _title: 'Alertas'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: FALSE

ecosistema_jaraba_core.admin.alerts.summary:
  path: '/api/v1/admin/alerts/summary'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::alertsSummary'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.alerts.list:
  path: '/api/v1/admin/alerts'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::listAlerts'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.alerts.state:
  path: '/api/v1/admin/alerts/{foc_alert}/state'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::updateAlertState'
  requirements:
    _permission: 'administer site configuration'
    foc_alert: '\d+'
  methods: [POST]

ecosistema_jaraba_core.admin.alerts.detail_panel:
  path: '/admin/jaraba/center/alerts/{foc_alert}/panel'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::alertDetailPanel'
  requirements:
    _permission: 'administer site configuration'
    foc_alert: '\d+'
  options:
    _admin_route: FALSE

ecosistema_jaraba_core.admin.playbooks.list:
  path: '/api/v1/admin/playbooks'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::listPlaybooks'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.playbooks.execute:
  path: '/api/v1/admin/playbooks/{cs_playbook}/execute'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::executePlaybook'
  requirements:
    _permission: 'administer site configuration'
    cs_playbook: '\d+'
  methods: [POST]

# ===========================================================================
# ADMIN CENTER — ANALYTICS & LOGS (F6 Doc 181 / Spec f104 §FASE 6)
# ===========================================================================

ecosistema_jaraba_core.admin.center.analytics:
  path: '/admin/jaraba/center/analytics'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterController::analytics'
    _title: 'Analytics'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: FALSE

ecosistema_jaraba_core.admin.center.logs:
  path: '/admin/jaraba/center/logs'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterController::logs'
    _title: 'Logs'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: FALSE

ecosistema_jaraba_core.admin.analytics.overview:
  path: '/api/v1/admin/analytics/overview'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::analyticsOverview'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.analytics.ai:
  path: '/api/v1/admin/analytics/ai'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::analyticsAi'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.logs.list:
  path: '/api/v1/admin/logs'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::listLogs'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

# ===========================================================================
# ADMIN CENTER — SETTINGS (F6 Doc 181 / Spec f104 §FASE 7)
# ===========================================================================

ecosistema_jaraba_core.admin.center.settings:
  path: '/admin/jaraba/center/settings'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterController::settings'
    _title: 'Configuración'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: FALSE

ecosistema_jaraba_core.admin.settings.overview:
  path: '/api/v1/admin/settings'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::settingsOverview'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.settings.general.save:
  path: '/api/v1/admin/settings/general'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::saveGeneralSettings'
  requirements:
    _permission: 'administer site configuration'
  methods: [POST]

ecosistema_jaraba_core.admin.settings.plans.list:
  path: '/api/v1/admin/settings/plans'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::listPlans'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.settings.integrations:
  path: '/api/v1/admin/settings/integrations'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::listIntegrations'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.settings.apikeys.list:
  path: '/api/v1/admin/settings/api-keys'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::listApiKeys'
  requirements:
    _permission: 'administer site configuration'
  methods: [GET]

ecosistema_jaraba_core.admin.settings.apikeys.create:
  path: '/api/v1/admin/settings/api-keys'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::createApiKey'
  requirements:
    _permission: 'administer site configuration'
  methods: [POST]

ecosistema_jaraba_core.admin.settings.apikeys.revoke:
  path: '/api/v1/admin/settings/api-keys/{key_id}/revoke'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AdminCenterApiController::revokeApiKey'
  requirements:
    _permission: 'administer site configuration'
  methods: [POST]

# ---------------------------------------------------------------------------
# COMPLIANCE PANEL UNIFICADO (Stack Compliance Legal N1 — FASE 12)
# ---------------------------------------------------------------------------

# Dashboard unificado de compliance legal: Privacy + Legal + DR.
ecosistema_jaraba_core.compliance.panel:
  path: '/admin/jaraba/compliance'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\CompliancePanelController::dashboard'
    _title: 'Compliance Panel'
  requirements:
    _permission: 'view platform analytics'
  options:
    _admin_route: TRUE

# API: Obtener KPIs de compliance en tiempo real.
ecosistema_jaraba_core.api.compliance.overview:
  path: '/api/v1/compliance/overview'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\CompliancePanelController::apiOverview'
  requirements:
    _permission: 'view platform analytics'
  methods: [GET]

# ---------------------------------------------------------------------------
# FISCAL COMPLIANCE DASHBOARD (FASE 11)
# ---------------------------------------------------------------------------

# Dashboard fiscal unificado — Agrega datos de VeriFactu, Facturae y E-Factura.
ecosistema_jaraba_core.fiscal.dashboard:
  path: '/admin/jaraba/fiscal'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\FiscalDashboardController::dashboard'
    _title: 'Fiscal Compliance Dashboard'
  requirements:
    _permission: 'view platform analytics'
  options:
    _admin_route: TRUE

# ---------------------------------------------------------------------------
# PÁGINAS LEGALES E INFORMATIVAS
# ---------------------------------------------------------------------------
# Páginas públicas con contenido configurable desde theme settings.
# Templates limpios (zero-region), SEO-friendly, i18n.

ecosistema_jaraba_core.privacy:
  path: '/politica-privacidad'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LegalPagesController::privacy'
    _title: 'Política de Privacidad'
  requirements:
    _access: 'TRUE'

ecosistema_jaraba_core.terms:
  path: '/terminos-uso'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LegalPagesController::terms'
    _title: 'Términos de Uso'
  requirements:
    _access: 'TRUE'

ecosistema_jaraba_core.cookies:
  path: '/politica-cookies'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\LegalPagesController::cookies'
    _title: 'Política de Cookies'
  requirements:
    _access: 'TRUE'

ecosistema_jaraba_core.about:
  path: '/sobre-nosotros'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\InfoPagesController::about'
    _title: 'Sobre Nosotros'
  requirements:
    _access: 'TRUE'

ecosistema_jaraba_core.contact:
  path: '/contacto'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\InfoPagesController::contact'
    _title: 'Contacto'
  requirements:
    _access: 'TRUE'

# POST: Envío público de formulario de contacto (Sprint 3 Remediation)
ecosistema_jaraba_core.public_contact.submit:
  path: '/api/v1/public/contact'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\PublicContactController::submit'
  methods: [POST]
  requirements:
    _access: 'TRUE'

entity.impersonation_audit_log.collection:
  path: '/admin/content/impersonation-audit-log'
  defaults:
    _entity_list: 'impersonation_audit_log'
    _title: 'Impersonation Audit Log'
  requirements:
    _permission: 'administer site configuration'

# ---------------------------------------------------------------------------
# ENTITY SETTINGS ROUTES (field_ui_base_route targets)
# ---------------------------------------------------------------------------

entity.alert_rule.settings:
  path: '/admin/structure/alert-rule/settings'
  defaults:
    _form: 'Drupal\ecosistema_jaraba_core\Form\AlertRuleSettingsForm'
    _title: 'Regla de Alerta settings'
  requirements:
    _permission: 'administer alert rules'

entity.audit_log.settings:
  path: '/admin/structure/audit-log/settings'
  defaults:
    _form: 'Drupal\ecosistema_jaraba_core\Form\AuditLogSettingsForm'
    _title: 'Audit Log settings'
  requirements:
    _permission: 'view audit logs'

entity.badge.settings:
  path: '/admin/structure/badge/settings'
  defaults:
    _form: 'Drupal\ecosistema_jaraba_core\Form\BadgeSettingsForm'
    _title: 'Insignia settings'
  requirements:
    _permission: 'administer tenants'

entity.badge_award.settings:
  path: '/admin/structure/badge-award/settings'
  defaults:
    _form: 'Drupal\ecosistema_jaraba_core\Form\BadgeAwardSettingsForm'
    _title: 'Otorgamiento de Insignia settings'
  requirements:
    _permission: 'administer tenants'

entity.compliance_assessment.settings:
  path: '/admin/structure/compliance-assessment/settings'
  defaults:
    _form: 'Drupal\ecosistema_jaraba_core\Form\ComplianceAssessmentSettingsForm'
    _title: 'Evaluación de Compliance settings'
  requirements:
    _permission: 'administer tenants'

entity.impersonation_audit_log.settings:
  path: '/admin/structure/impersonation-audit-log/settings'
  defaults:
    _form: 'Drupal\ecosistema_jaraba_core\Form\ImpersonationAuditLogSettingsForm'
    _title: 'Registro de Impersonación settings'
  requirements:
    _permission: 'administer impersonation'

entity.push_subscription.settings:
  path: '/admin/structure/push-subscription/settings'
  defaults:
    _form: 'Drupal\ecosistema_jaraba_core\Form\PushSubscriptionSettingsForm'
    _title: 'Suscripción Push settings'
  requirements:
    _permission: 'administer tenants'

entity.reseller.settings:
  path: '/admin/structure/reseller/settings'
  defaults:
    _form: 'Drupal\ecosistema_jaraba_core\Form\ResellerSettingsForm'
    _title: 'Reseller settings'
  requirements:
    _permission: 'administer tenants'

entity.scheduled_report.settings:
  path: '/admin/structure/scheduled-report/settings'
  defaults:
    _form: 'Drupal\ecosistema_jaraba_core\Form\ScheduledReportSettingsForm'
    _title: 'Reporte Programado settings'
  requirements:
    _permission: 'administer scheduled reports'

entity.security_policy.settings:
  path: '/admin/structure/security-policy/settings'
  defaults:
    _form: 'Drupal\ecosistema_jaraba_core\Form\SecurityPolicySettingsForm'
    _title: 'Política de Seguridad settings'
  requirements:
    _permission: 'administer tenants'

# ============================================================================
# PÁGINAS ESTÁTICAS — Meta-Sitio (Sprint 3)
# ============================================================================

ecosistema_jaraba_core.static.contacto:
  path: '/contacto'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StaticPageController::contacto'
    _title: 'Contacto'
  requirements:
    _access: 'TRUE'

ecosistema_jaraba_core.static.sobre_nosotros:
  path: '/sobre-nosotros'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StaticPageController::sobreNosotros'
    _title: 'Sobre nosotros'
  requirements:
    _access: 'TRUE'

ecosistema_jaraba_core.static.privacidad:
  path: '/politica-privacidad'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StaticPageController::privacidad'
    _title: 'Política de privacidad'
  requirements:
    _access: 'TRUE'

ecosistema_jaraba_core.static.terminos:
  path: '/terminos-uso'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StaticPageController::terminos'
    _title: 'Términos de uso'
  requirements:
    _access: 'TRUE'

ecosistema_jaraba_core.static.cookies:
  path: '/politica-cookies'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StaticPageController::cookies'
    _title: 'Política de cookies'
  requirements:
    _access: 'TRUE'

# GAP-AUD-023: Design System Documentation.
ecosistema_jaraba_core.design_system:
  path: '/admin/design-system'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ComponentDocumentationController::page'
    _title: 'Design System'
  requirements:
    _permission: 'access administration pages'

# Blog placeholder — Sprint 5
ecosistema_jaraba_core.blog:
  path: '/blog'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\StaticPageController::blog'
    _title: 'Blog'
  requirements:
    _access: 'TRUE'

# ============================================
# Sprint 6: REST API Endpoints
# ============================================

# Contact Form API — public, POST only
ecosistema_jaraba_core.api_contact:
  path: '/api/v1/public/contact'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ContactApiController::submit'
  methods: [POST]
  requirements:
    _access: 'TRUE'

# Analytics Event Collection — public, POST only
ecosistema_jaraba_core.api_analytics_event:
  path: '/api/v1/analytics/event'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\AnalyticsEventController::collect'
  methods: [POST]
  requirements:
    _access: 'TRUE'

# === Reviews Display — Frontend Routes (REV-PHASE4) ===

ecosistema_jaraba_core.reviews.comercio:
  path: '/comercio/{entity_id}/reviews'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewDisplayController::reviewsPage'
    _title_callback: '\Drupal\ecosistema_jaraba_core\Controller\ReviewDisplayController::reviewsPageTitle'
    vertical: 'comercioconecta'
    entity_type: 'merchant_profile'
  requirements:
    _permission: 'access content'
    entity_id: '\d+'

ecosistema_jaraba_core.reviews.agro:
  path: '/agro/{entity_id}/reviews'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewDisplayController::reviewsPage'
    _title_callback: '\Drupal\ecosistema_jaraba_core\Controller\ReviewDisplayController::reviewsPageTitle'
    vertical: 'agroconecta'
    entity_type: 'producer_profile'
  requirements:
    _permission: 'access content'
    entity_id: '\d+'

ecosistema_jaraba_core.reviews.servicios:
  path: '/servicios/{entity_id}/reviews'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewDisplayController::reviewsPage'
    _title_callback: '\Drupal\ecosistema_jaraba_core\Controller\ReviewDisplayController::reviewsPageTitle'
    vertical: 'serviciosconecta'
    entity_type: 'provider_profile'
  requirements:
    _permission: 'access content'
    entity_id: '\d+'

ecosistema_jaraba_core.reviews.formacion:
  path: '/cursos/{entity_id}/reviews'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewDisplayController::reviewsPage'
    _title_callback: '\Drupal\ecosistema_jaraba_core\Controller\ReviewDisplayController::reviewsPageTitle'
    vertical: 'formacion'
    entity_type: 'lms_course'
  requirements:
    _permission: 'access content'
    entity_id: '\d+'

ecosistema_jaraba_core.reviews.mentoring:
  path: '/mentoring/{entity_id}/review'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewDisplayController::reviewsPage'
    _title_callback: '\Drupal\ecosistema_jaraba_core\Controller\ReviewDisplayController::reviewsPageTitle'
    vertical: 'mentoring'
    entity_type: 'mentoring_session'
  requirements:
    _permission: 'access content'
    entity_id: '\d+'

# REV-PHASE6: API de estadisticas de resenas para widget GrapesJS
ecosistema_jaraba_core.api.v1.reviews.stats:
  path: '/api/v1/reviews/stats/{target_entity_type}/{target_entity_id}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewDisplayController::apiStats'
  methods: [GET]
  requirements:
    _permission: 'access content'
    target_entity_id: '\d+'
    _csrf_request_header_token: 'TRUE'

# === B-01: Helpfulness Voting API ===
ecosistema_jaraba_core.api.v1.reviews.vote:
  path: '/api/v1/reviews/{review_type}/{review_id}/vote'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewApiController::vote'
  methods: [POST]
  requirements:
    _user_is_logged_in: 'TRUE'
    review_id: '\d+'
    _csrf_request_header_token: 'TRUE'

# === B-02: Filtered Review List API ===
ecosistema_jaraba_core.api.v1.reviews.list:
  path: '/api/v1/reviews/{review_type}/list'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewApiController::listFiltered'
  methods: [GET]
  requirements:
    _permission: 'access content'
    _csrf_request_header_token: 'TRUE'

# === B-04: Owner Response API ===
ecosistema_jaraba_core.api.v1.reviews.response:
  path: '/api/v1/reviews/{review_type}/{review_id}/response'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewApiController::ownerResponse'
  methods: [POST]
  requirements:
    _permission: 'respond to reviews'
    review_id: '\d+'
    _csrf_request_header_token: 'TRUE'

# === B-05: Review Analytics API ===
ecosistema_jaraba_core.api.v1.reviews.analytics:
  path: '/api/v1/reviews/analytics'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewApiController::analytics'
  methods: [GET]
  requirements:
    _permission: 'view review analytics'
    _csrf_request_header_token: 'TRUE'

# === B-05: Review Analytics CSV Export ===
ecosistema_jaraba_core.api.v1.reviews.analytics.export:
  path: '/api/v1/reviews/analytics/export'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewApiController::analyticsExport'
  methods: [GET]
  requirements:
    _permission: 'export review analytics'
    _csrf_request_header_token: 'TRUE'

# === B-05: Review Analytics Dashboard (Admin) ===
ecosistema_jaraba_core.admin.reviews.analytics:
  path: '/admin/reports/reviews'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewAnalyticsDashboardController::dashboard'
    _title: 'Review Analytics'
  requirements:
    _permission: 'view review analytics'
  options:
    _admin_route: TRUE

# === B-08: SEO Review Pages ===
ecosistema_jaraba_core.reviews.seo:
  path: '/reviews/{vertical}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewSeoController::verticalReviews'
    _title_callback: '\Drupal\ecosistema_jaraba_core\Controller\ReviewSeoController::verticalReviewsTitle'
  requirements:
    _permission: 'access content'
    vertical: 'comercioconecta|agroconecta|serviciosconecta|formacion|mentoring'

# === B-10: Review Tenant Settings ===
ecosistema_jaraba_core.review_tenant_settings.add:
  path: '/admin/config/reviews/settings/add'
  defaults:
    _entity_form: 'review_tenant_settings.default'
    _title: 'Add Review Settings'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: TRUE

ecosistema_jaraba_core.review_tenant_settings.edit:
  path: '/admin/config/reviews/settings/{review_tenant_settings}'
  defaults:
    _entity_form: 'review_tenant_settings.default'
    _title: 'Edit Review Settings'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: TRUE

ecosistema_jaraba_core.review_tenant_settings.collection:
  path: '/admin/config/reviews/settings'
  defaults:
    _entity_list: 'review_tenant_settings'
    _title: 'Review Settings'
  requirements:
    _permission: 'administer site configuration'
  options:
    _admin_route: TRUE

# === B-17: Public Review API ===
ecosistema_jaraba_core.api.v1.public.reviews.list:
  path: '/api/v1/public/reviews/{review_type}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewPublicApiController::listReviews'
  methods: [GET]
  requirements:
    _permission: 'access content'

ecosistema_jaraba_core.api.v1.public.reviews.get:
  path: '/api/v1/public/reviews/{review_type}/{review_id}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewPublicApiController::getReview'
  methods: [GET]
  requirements:
    _permission: 'access content'
    review_id: '\d+'

ecosistema_jaraba_core.api.v1.public.reviews.stats:
  path: '/api/v1/public/reviews/{review_type}/stats'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewPublicApiController::getStats'
  methods: [GET]
  requirements:
    _permission: 'access content'

# === Item 18: Public Review Submission ===
ecosistema_jaraba_core.reviews.submit.comercio:
  path: '/comercio/{entity_id}/reviews/escribir'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewSubmitController::submitForm'
    _title: 'Escribir resena'
    vertical: 'comercioconecta'
    review_entity_type: 'comercio_review'
    target_entity_type: 'merchant_profile'
  requirements:
    _user_is_logged_in: 'TRUE'
    entity_id: '\d+'

ecosistema_jaraba_core.reviews.submit.agro:
  path: '/agro/{entity_id}/reviews/escribir'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewSubmitController::submitForm'
    _title: 'Escribir resena'
    vertical: 'agroconecta'
    review_entity_type: 'review_agro'
    target_entity_type: 'producer_profile'
  requirements:
    _user_is_logged_in: 'TRUE'
    entity_id: '\d+'

ecosistema_jaraba_core.reviews.submit.servicios:
  path: '/servicios/{entity_id}/reviews/escribir'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewSubmitController::submitForm'
    _title: 'Escribir resena'
    vertical: 'serviciosconecta'
    review_entity_type: 'review_servicios'
    target_entity_type: 'provider_profile'
  requirements:
    _user_is_logged_in: 'TRUE'
    entity_id: '\d+'

ecosistema_jaraba_core.reviews.submit.formacion:
  path: '/cursos/{entity_id}/reviews/escribir'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewSubmitController::submitForm'
    _title: 'Escribir resena'
    vertical: 'formacion'
    review_entity_type: 'course_review'
    target_entity_type: 'lms_course'
  requirements:
    _user_is_logged_in: 'TRUE'
    entity_id: '\d+'

ecosistema_jaraba_core.reviews.submit.mentoring:
  path: '/mentoring/{entity_id}/reviews/escribir'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewSubmitController::submitForm'
    _title: 'Escribir resena'
    vertical: 'mentoring'
    review_entity_type: 'session_review'
    target_entity_type: 'mentoring_session'
  requirements:
    _user_is_logged_in: 'TRUE'
    entity_id: '\d+'

# === Item 19: Report Abuse ===
ecosistema_jaraba_core.api.v1.reviews.report:
  path: '/api/v1/reviews/{review_type}/{review_id}/report'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewApiController::reportAbuse'
  methods: [POST]
  requirements:
    _user_is_logged_in: 'TRUE'
    _csrf_request_header_token: 'TRUE'
    review_id: '\d+'

# === Item 20: Edit/Delete Reviews by Author ===
ecosistema_jaraba_core.api.v1.reviews.edit:
  path: '/api/v1/reviews/{review_type}/{review_id}'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewApiController::editReview'
  methods: [PATCH]
  requirements:
    _user_is_logged_in: 'TRUE'
    _csrf_request_header_token: 'TRUE'
    review_id: '\d+'

ecosistema_jaraba_core.api.v1.reviews.delete:
  path: '/api/v1/reviews/{review_type}/{review_id}/delete'
  defaults:
    _controller: '\Drupal\ecosistema_jaraba_core\Controller\ReviewApiController::deleteReview'
  methods: [POST]
  requirements:
    _user_is_logged_in: 'TRUE'
    _csrf_request_header_token: 'TRUE'
    review_id: '\d+'
