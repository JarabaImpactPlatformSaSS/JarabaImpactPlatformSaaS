{#
/**
 * @file
 * Health Dashboard - Premium Admin UX Template
 *
 * Variables:
 *   - services: Array of service health statuses
 *   - metrics: Overall platform metrics
 *   - recent_checks: Recent health check results
 *   - last_updated: Timestamp of last update
 *
 * Todas las etiquetas son traducibles desde /admin/config/regional/translate
 */
#}

{# Diccionario de etiquetas de status traducibles #}
{% set status_labels = {
  'healthy': 'Saludable'|t,
  'degraded': 'Degradado'|t,
  'critical': 'Cr√≠tico'|t,
  'unknown': 'Desconocido'|t,
} %}

<div class="admin-premium health-dashboard">
  {# Header Section #}
  <div class="health-header">
    <div class="health-header__content">
      <h1 class="health-header__title">
        <span class="health-header__icon">{{ jaraba_icon('ui', 'hospital', { color: 'success', size: '32px' }) }}</span>
        {% trans %}Panel de Salud de la Plataforma{% endtrans %}
      </h1>
      <p class="health-header__subtitle">{% trans %}Monitoreo en tiempo real y estado de servicios{% endtrans %}</p>
    </div>
    <div class="health-header__actions">
      <button class="btn btn-primary" id="refresh-health" title="{% trans %}Actualizar datos{% endtrans %}">
        <span class="btn__icon">{{ jaraba_icon('actions', 'refresh', { color: 'neutral', size: '18px' }) }}</span> {% trans %}Actualizar{% endtrans %}
      </button>
      <span class="health-header__updated">
        {% trans %}√öltima actualizaci√≥n{% endtrans %}: <strong id="last-updated">{{ last_updated }}</strong>
      </span>
    </div>
  </div>

  {# Metrics Overview Cards #}
  <div class="health-metrics">
    <div class="metric-card metric-card--health">
      <div class="metric-card__icon">{{ jaraba_icon('ui', 'heartbeat', { color: 'success', size: '28px' }) }}</div>
      <div class="metric-card__content">
        <span class="metric-card__value" id="overall-health">{{ metrics.overall_health }}%</span>
        <span class="metric-card__label">{% trans %}Salud General{% endtrans %}</span>
      </div>
      <div class="metric-card__indicator metric-card__indicator--{{ metrics.overall_health >= 80 ? 'good' : (metrics.overall_health >= 50 ? 'warning' : 'critical') }}"></div>
    </div>
    
    <div class="metric-card metric-card--services">
      <div class="metric-card__icon">{{ jaraba_icon('ai', 'automation', { color: 'naranja-impulso', size: '28px' }) }}</div>
      <div class="metric-card__content">
        <span class="metric-card__value">{{ metrics.services_up }}/{{ metrics.services_total }}</span>
        <span class="metric-card__label">{% trans %}Servicios Activos{% endtrans %}</span>
      </div>
    </div>
    
    <div class="metric-card metric-card--uptime">
      <div class="metric-card__icon">{{ jaraba_icon('ui', 'clock', { color: 'azul-corporativo', size: '28px' }) }}</div>
      <div class="metric-card__content">
        <span class="metric-card__value">{{ metrics.uptime }}</span>
        <span class="metric-card__label">{% trans %}Tiempo Activo{% endtrans %}</span>
      </div>
    </div>
    
    <div class="metric-card metric-card--external">
      <div class="metric-card__icon">{{ jaraba_icon('analytics', 'gauge', { color: 'azul-corporativo', size: '28px' }) }}</div>
      <div class="metric-card__content">
        <a href="http://grafana.jaraba-saas.lndo.site:3000" target="_blank" class="metric-card__link">
          {% trans %}Abrir Grafana{% endtrans %} ‚Üí
        </a>
        <span class="metric-card__label">{% trans %}M√©tricas Avanzadas{% endtrans %}</span>
      </div>
    </div>
  </div>

  {# Services Grid #}
  <div class="health-section">
    <h2 class="health-section__title">
      <span class="health-section__icon">{{ jaraba_icon('ui', 'wrench', { color: 'azul-corporativo', size: '24px' }) }}</span>
      {% trans %}Estado de Servicios{% endtrans %}
    </h2>
    <div class="services-grid" id="services-grid">
      {% for key, service in services %}
        <div class="service-card service-card--{{ service.status }}" data-service="{{ key }}">
          <div class="service-card__header">
            <span class="service-card__icon service-card__icon--{{ service.icon }}">
              {% if service.icon == 'database' %}{{ jaraba_icon('ui', 'database', { color: 'azul-corporativo', size: '24px' }) }}{% endif %}
              {% if service.icon == 'brain' %}{{ jaraba_icon('ai', 'brain', { color: 'verde-innovacion', size: '24px' }) }}{% endif %}
              {% if service.icon == 'bolt' %}{{ jaraba_icon('ai', 'automation', { color: 'naranja-impulso', size: '24px' }) }}{% endif %}
              {% if service.icon == 'globe' %}{{ jaraba_icon('ui', 'globe', { color: 'azul-verdoso', size: '24px' }) }}{% endif %}
            </span>
            <span class="service-card__status-badge service-card__status-badge--{{ service.status }}">
              {{ status_labels[service.status]|default(service.status|capitalize) }}
            </span>
          </div>
          <h3 class="service-card__name">{{ service.name }}</h3>
          <p class="service-card__message">{{ service.message }}</p>
          {% if service.latency %}
            <div class="service-card__latency">
              <span class="service-card__latency-label">{% trans %}Latencia{% endtrans %}:</span>
              <span class="service-card__latency-value">{{ service.latency }}ms</span>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>

  {# Recent Checks #}
  <div class="health-section">
    <h2 class="health-section__title">
      <span class="health-section__icon">{{ jaraba_icon('business', 'diagnostic', { color: 'azul-corporativo', size: '24px' }) }}</span>
      {% trans %}Verificaciones Recientes{% endtrans %}
    </h2>
    <div class="checks-table">
      <table class="table table--modern">
        <thead>
          <tr>
            <th>{% trans %}Hora{% endtrans %}</th>
            <th>{% trans %}Tipo{% endtrans %}</th>
            <th>{% trans %}Resultado{% endtrans %}</th>
            <th>{% trans %}Mensaje{% endtrans %}</th>
          </tr>
        </thead>
        <tbody id="recent-checks">
          {% for check in recent_checks %}
            <tr class="check-row check-row--{{ check.result }}">
              <td class="check-row__time">{{ check.time }}</td>
              <td class="check-row__type">{{ check.type }}</td>
              <td class="check-row__result">
                <span class="result-badge result-badge--{{ check.result }}">
                  {% if check.result == 'pass' %}{{ jaraba_icon('actions', 'check', { color: 'success', size: '18px' }) }}{% endif %}
                  {% if check.result == 'fail' %}‚ùå{% endif %}
                  {% if check.result == 'recovery' %}üîÑ{% endif %}
                  {{ check.result|upper }}
                </span>
              </td>
              <td class="check-row__message">{{ check.message }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {# Quick Actions #}
  <div class="health-section">
    <h2 class="health-section__title">
      <span class="health-section__icon">{{ jaraba_icon('ai', 'automation', { color: 'naranja-impulso', size: '24px' }) }}</span>
      {% trans %}Acciones R√°pidas{% endtrans %}
    </h2>
    <div class="quick-actions">
      <a href="/admin/config/development/performance" class="action-btn action-btn--primary">
        <span class="action-btn__icon">üóëÔ∏è</span>
        {% trans %}Limpiar Cach√©{% endtrans %}
      </a>
      <a href="/admin/reports/status" class="action-btn action-btn--secondary">
        <span class="action-btn__icon">{{ jaraba_icon('analytics', 'gauge', { color: 'azul-corporativo', size: '18px' }) }}</span>
        {% trans %}Informe de Estado{% endtrans %}
      </a>
      <a href="http://grafana.jaraba-saas.lndo.site:3000" target="_blank" class="action-btn action-btn--external">
        <span class="action-btn__icon">{{ jaraba_icon('analytics', 'chart-line', { color: 'verde-innovacion', size: '18px' }) }}</span>
        {% trans %}Dashboard Grafana{% endtrans %}
      </a>
      <a href="http://prometheus.jaraba-saas.lndo.site:9090" target="_blank" class="action-btn action-btn--external">
        <span class="action-btn__icon">{{ jaraba_icon('ui', 'search', { color: 'neutral', size: '18px' }) }}</span>
        Prometheus
      </a>
    </div>
  </div>
</div>
