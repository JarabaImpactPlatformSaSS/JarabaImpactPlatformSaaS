{#
/**
 * @file
 * Template para el dashboard INICIAL de demo interactiva.
 *
 * HAL-DEMO-V3-BACK-006: Este template se usa en la ruta demo_dashboard
 * (paso inicial, antes de progressive disclosure). Las métricas se renderizan
 * con claves nombradas (products_count, revenue_last_month, etc.).
 *
 * Para el dashboard con sesión activa y progressive disclosure,
 * ver demo-dashboard-view.html.twig (usa partials compartidos).
 *
 * Variables:
 * - session_id: ID de la sesión de demo.
 * - profile: Perfil de demo seleccionado (id, name, icon_category, icon_name, vertical).
 * - tenant_name: Nombre simulado del tenant.
 * - metrics: Métricas simuladas (claves nombradas: products_count, etc.).
 * - products: Productos sintéticos.
 * - sales_history: Historial de ventas para gráficos.
 * - magic_actions: Acciones de "Magic Moment".
 *
 * S2-02: Reescrito sin CSS/JS inline. CSS en _demo.scss, JS en behavior.
 * ICON-EMOJI-001: jaraba_icon() en lugar de emojis Unicode.
 * ROUTE-LANGPREFIX-001: URLs via path().
 *
 * Q1 2027 - Gap P0: Time-to-Value < 60s
 */
#}

<div class="demo-dashboard" data-session-id="{{ session_id }}" data-demo-dashboard>
  {# Banner de Demo #}
  <div class="demo-banner">
    <div class="demo-banner__content">
      <span class="demo-banner__badge">
        {{ jaraba_icon('navigation', 'play', { size: '14px', color: 'blanco' }) }}
        {{ 'MODO DEMO'|t }}
      </span>
      <span class="demo-banner__tenant-name">{{ tenant_name }}</span>
      <span>
        {{ jaraba_icon(profile.icon_category, profile.icon_name, { size: '18px', color: 'blanco' }) }}
        {{ profile.name }}
      </span>
    </div>
    <div>
      <button class="demo-start-btn" data-demo-convert-open type="button">
        {{ jaraba_icon('ai', 'sparkles', { size: '16px', color: 'azul-corporativo' }) }}
        {{ 'Convertir en Cuenta Real'|t }}
      </button>
    </div>
  </div>

  {# Magic Moment Actions #}
  <section class="demo-magic-moment" data-tour-step="demo-magic-moment">
    <h2 class="demo-section-title">
      {{ jaraba_icon('business', 'target', { color: 'naranja-impulso', size: '24px' }) }}
      {{ 'Tu Primer Paso'|t }}
    </h2>
    <div class="demo-magic-actions-grid">
      {% for action in magic_actions %}
        {% set action_url = action.url %}
        {# Resolver placeholder __storytelling__ con URL real #}
        {% if action.url == '__storytelling__' %}
          {% set action_url = path('ecosistema_jaraba_core.demo_storytelling', { sessionId: session_id }) %}
        {% endif %}
        <a href="{{ action_url }}"
           class="demo-magic-action-card {{ action.highlight ? 'demo-magic-action-card--highlighted' : '' }}"
           data-action="{{ action.id }}"
           aria-label="{{ action.label }}: {{ action.description }}">
          <div class="demo-magic-action-card__icon">
            {{ jaraba_icon(action.icon_category, action.icon_name, { size: '24px', variant: 'duotone' }) }}
          </div>
          <h3 class="demo-magic-action-card__title">{{ action.label }}</h3>
          <p class="demo-magic-action-card__description">{{ action.description }}</p>
          {% if action.highlight %}
            <span class="demo-magic-action-card__recommended">
              {{ jaraba_icon('business', 'achievement', { size: '12px', color: 'blanco' }) }}
              {{ 'Recomendado'|t }}
            </span>
          {% endif %}
        </a>
      {% endfor %}
    </div>
  </section>

  {# Métricas Simuladas #}
  <section id="metrics" data-tour-step="demo-metrics">
    <h2 class="demo-section-title">
      {{ jaraba_icon('analytics', 'gauge', { color: 'azul-corporativo', size: '24px' }) }}
      {{ 'Tus Métricas'|t }}
    </h2>
    <div class="demo-metrics-grid">
      {% if metrics.products_count is defined %}
        <div class="demo-metric-card">
          <span class="demo-metric-card__value">{{ metrics.products_count }}</span>
          <span class="demo-metric-card__label">{{ 'Productos'|t }}</span>
        </div>
      {% endif %}
      {% if metrics.orders_last_month is defined %}
        <div class="demo-metric-card">
          <span class="demo-metric-card__value">{{ metrics.orders_last_month }}</span>
          <span class="demo-metric-card__label">{{ 'Pedidos (mes)'|t }}</span>
        </div>
      {% endif %}
      {% if metrics.revenue_last_month is defined %}
        <div class="demo-metric-card demo-metric-card--highlight">
          <span class="demo-metric-card__value">&euro;{{ metrics.revenue_last_month|number_format(0, ',', '.') }}</span>
          <span class="demo-metric-card__label">{{ 'Ingresos (mes)'|t }}</span>
        </div>
      {% endif %}
      {% if metrics.customers_count is defined %}
        <div class="demo-metric-card">
          <span class="demo-metric-card__value">{{ metrics.customers_count }}</span>
          <span class="demo-metric-card__label">{{ 'Clientes'|t }}</span>
        </div>
      {% endif %}
      {% if metrics.products_available is defined %}
        <div class="demo-metric-card demo-metric-card--highlight">
          <span class="demo-metric-card__value">{{ metrics.products_available }}</span>
          <span class="demo-metric-card__label">{{ 'Productos Disponibles'|t }}</span>
        </div>
      {% endif %}
      {% if metrics.tenants_active is defined %}
        <div class="demo-metric-card">
          <span class="demo-metric-card__value">{{ metrics.tenants_active }}</span>
          <span class="demo-metric-card__label">{{ 'Tiendas Activas'|t }}</span>
        </div>
      {% endif %}
      {% if metrics.categories is defined %}
        <div class="demo-metric-card">
          <span class="demo-metric-card__value">{{ metrics.categories }}</span>
          <span class="demo-metric-card__label">{{ 'Categorías'|t }}</span>
        </div>
      {% endif %}
    </div>
  </section>

  {# S6-05: Gráfico via partial compartido (DRY). #}
  {% include '@ecosistema_jaraba_core/partials/_demo-chart.html.twig' only %}

  {# Productos (solo para vendedores) #}
  {% if products %}
    <section id="products">
      <h2 class="demo-section-title">
        {{ jaraba_icon('commerce', 'products', { color: 'azul-corporativo', size: '24px' }) }}
        {{ 'Tus Productos'|t }}
      </h2>
      <div class="demo-products-grid">
        {% for product in products %}
          <article class="demo-product-card">
            <div class="demo-product-card__image">
              {{ jaraba_icon('commerce', 'product', { size: '32px', color: 'blanco' }) }}
            </div>
            <div class="demo-product-card__info">
              <h4 class="demo-product-card__name">{{ product.name }}</h4>
              <div class="demo-product-card__price">&euro;{{ product.price|number_format(2, ',', '.') }}</div>
              <div class="demo-product-card__meta">
                <span>
                  {{ jaraba_icon('business', 'achievement', { size: '14px', color: 'naranja-impulso' }) }}
                  {{ product.rating }}
                </span>
                <span>{{ product.reviews }} {{ 'reseñas'|t }}</span>
              </div>
            </div>
          </article>
        {% endfor %}
      </div>
    </section>
  {% endif %}

  {# S6-05: CTA via partial compartido (DRY). #}
  {% include '@ecosistema_jaraba_core/partials/_demo-cta.html.twig' with { vertical: profile.vertical|default('agroconecta') } only %}
</div>

{# S5-05: Modal de Conversión — extraído a partial reutilizable. #}
{% include '@ecosistema_jaraba_core/partials/_demo-convert-modal.html.twig' %}
