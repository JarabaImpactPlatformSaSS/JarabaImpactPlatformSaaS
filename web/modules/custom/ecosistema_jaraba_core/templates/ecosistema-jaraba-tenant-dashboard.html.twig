{#
/**
 * @file
 * Template para el Dashboard del Tenant Admin.
 *
 * Variables disponibles:
 * - tenant: La entidad Tenant actual
 * - plan: El plan SaaS del tenant
 * - group: El grupo asociado al tenant
 * - domain: La entidad Domain del tenant
 * - vertical: La vertical de negocio
 * - metrics: Array con métricas de uso (productores, almacenamiento, contenido)
 * - subscription_status: Estado de suscripción (trial, active, past_due, etc.)
 * - subscription_status_label: Etiqueta traducida del estado
 * - is_on_trial: Boolean indicando si está en periodo de prueba
 * - trial_days_remaining: Días restantes del trial
 * - quick_actions: Array de acciones rápidas disponibles
 */
#}

<div class="admin-premium tenant-dashboard">
  {# =========================================================================
   # CABECERA DEL DASHBOARD
   # ========================================================================= #}
  <header class="tenant-dashboard__header">
    <div class="tenant-dashboard__title-wrapper">
      <h1 class="tenant-dashboard__title">{{ tenant.name.value }}</h1>
      {% if vertical %}
        <span class="tenant-dashboard__vertical">{{ vertical.name.value }}</span>
      {% endif %}
    </div>

    <div class="tenant-dashboard__status">
      <span class="status-badge status-badge--{{ subscription_status }}">
        {{ subscription_status_label }}
      </span>
      {% if is_on_trial and trial_days_remaining > 0 %}
        <span class="trial-countdown">
          {{ trial_days_remaining }} {{ 'días restantes'|t }}
        </span>
      {% endif %}
    </div>
  </header>

  {# =========================================================================
   # GRID DE TARJETAS
   # ========================================================================= #}
  <div class="tenant-dashboard__grid">

    {# -----------------------------------------------------------------------
     # TARJETA 1: PLAN Y SUSCRIPCIÓN
     # ----------------------------------------------------------------------- #}
    <div class="dashboard-card dashboard-card--subscription">
      <div class="dashboard-card__icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
      </div>
      <h2 class="dashboard-card__title">{{ 'Plan de Suscripción'|t }}</h2>

      <div class="dashboard-card__content">
        {% if plan %}
          <div class="plan-info">
            <span class="plan-info__name">{{ plan.name.value }}</span>
            <span class="plan-info__price">
              {{ plan.monthly_price.value|number_format(2, ',', '.') }} €/{{ 'mes'|t }}
            </span>
          </div>
        {% else %}
          <p class="no-plan">{{ 'Sin plan asignado'|t }}</p>
        {% endif %}

        {% if is_on_trial %}
          <div class="trial-info">
            <div class="trial-progress">
              <div class="trial-progress__bar" style="width: {{ ((14 - trial_days_remaining) / 14 * 100)|round }}%"></div>
            </div>
            <p class="trial-info__text">
              {{ 'Tu periodo de prueba termina en @days días.'|t({'@days': trial_days_remaining}) }}
            </p>
          </div>
        {% endif %}
      </div>
    </div>

    {# -----------------------------------------------------------------------
     # TARJETA 2: MÉTRICAS DE USO - PRODUCTORES
     # ----------------------------------------------------------------------- #}
    <div class="dashboard-card dashboard-card--metrics">
      <div class="dashboard-card__icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      </div>
      <h2 class="dashboard-card__title">{{ 'Productores'|t }}</h2>

      <div class="dashboard-card__content">
        <div class="metric-display">
          <span class="metric-display__value">{{ metrics.productores.count }}</span>
          {% if metrics.productores.limit > 0 %}
            <span class="metric-display__limit">/ {{ metrics.productores.limit }}</span>
          {% endif %}
        </div>

        {% if metrics.productores.limit > 0 %}
          <div class="usage-bar">
            <div class="usage-bar__fill usage-bar__fill--{{ metrics.productores.percentage > 80 ? 'warning' : 'normal' }}"
                 style="width: {{ metrics.productores.percentage }}%"></div>
          </div>
          <span class="usage-bar__label">{{ metrics.productores.percentage }}% {{ 'usado'|t }}</span>
        {% endif %}
      </div>
    </div>

    {# -----------------------------------------------------------------------
     # TARJETA 3: MÉTRICAS DE USO - ALMACENAMIENTO
     # ----------------------------------------------------------------------- #}
    <div class="dashboard-card dashboard-card--storage">
      <div class="dashboard-card__icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
      </div>
      <h2 class="dashboard-card__title">{{ 'Almacenamiento'|t }}</h2>

      <div class="dashboard-card__content">
        <div class="metric-display">
          <span class="metric-display__value">{{ metrics.almacenamiento.used_formatted }}</span>
          <span class="metric-display__limit">/ {{ metrics.almacenamiento.limit_formatted }}</span>
        </div>

        <div class="usage-bar">
          <div class="usage-bar__fill usage-bar__fill--{{ metrics.almacenamiento.percentage > 80 ? 'warning' : 'normal' }}"
               style="width: {{ metrics.almacenamiento.percentage }}%"></div>
        </div>
        <span class="usage-bar__label">{{ metrics.almacenamiento.percentage }}% {{ 'usado'|t }}</span>
      </div>
    </div>

    {# -----------------------------------------------------------------------
     # TARJETA 4: CONTENIDO
     # ----------------------------------------------------------------------- #}
    <div class="dashboard-card dashboard-card--content">
      <div class="dashboard-card__icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
      </div>
      <h2 class="dashboard-card__title">{{ 'Contenido'|t }}</h2>

      <div class="dashboard-card__content">
        <div class="metric-display metric-display--large">
          <span class="metric-display__value">{{ metrics.contenido.count }}</span>
          <span class="metric-display__label">{{ 'elementos'|t }}</span>
        </div>
      </div>
    </div>

  </div>

  {# =========================================================================
   # SECCIÓN DE ACCIONES RÁPIDAS
   # ========================================================================= #}
  <section class="tenant-dashboard__actions">
    <h2 class="section-title">{{ 'Acciones Rápidas'|t }}</h2>

    <div class="quick-actions">
      {% for action in quick_actions %}
        {# Usar botón con JavaScript para el portal de facturación #}
        {% if action.icon == 'credit-card' %}
          <button type="button" 
                  class="quick-action" 
                  data-billing-portal 
                  data-return-url="{{ path('ecosistema_jaraba_core.tenant.dashboard') }}">
            <div class="quick-action__icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
            </div>
            <div class="quick-action__content">
              <span class="quick-action__title">{{ action.title }}</span>
              <span class="quick-action__description">{{ action.description }}</span>
            </div>
            <div class="quick-action__arrow">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
            </div>
          </button>
        {% else %}
          {# El resto de acciones son links normales #}
          <a href="{{ action.url }}" class="quick-action">
            <div class="quick-action__icon">
              {% if action.icon == 'users' %}
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              {% elseif action.icon == 'plus-circle' %}
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
              {% elseif action.icon == 'settings' %}
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
              {% else %}
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>
              {% endif %}
            </div>
            <div class="quick-action__content">
              <span class="quick-action__title">{{ action.title }}</span>
              <span class="quick-action__description">{{ action.description }}</span>
            </div>
            <div class="quick-action__arrow">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
            </div>
          </a>
        {% endif %}
      {% endfor %}
    </div>
  </section>

  {# =========================================================================
   # INFORMACIÓN TÉCNICA
   # ========================================================================= #}
  <section class="tenant-dashboard__tech-info">
    <h2 class="section-title">{{ 'Información Técnica'|t }}</h2>

    <div class="tech-info-grid">
      {% if domain %}
        <div class="tech-info-item">
          <span class="tech-info-item__label">{{ 'Dominio'|t }}</span>
          <span class="tech-info-item__value">
            <a href="https://{{ domain.getHostname() }}" target="_blank" rel="noopener">
              {{ domain.getHostname() }}
            </a>
          </span>
        </div>
      {% endif %}

      {% if group %}
        <div class="tech-info-item">
          <span class="tech-info-item__label">{{ 'ID del Grupo'|t }}</span>
          <span class="tech-info-item__value">{{ group.id() }}</span>
        </div>
      {% endif %}

      <div class="tech-info-item">
        <span class="tech-info-item__label">{{ 'ID del Tenant'|t }}</span>
        <span class="tech-info-item__value">{{ tenant.id() }}</span>
      </div>

      {% if vertical %}
        <div class="tech-info-item">
          <span class="tech-info-item__label">{{ 'Vertical'|t }}</span>
          <span class="tech-info-item__value">{{ vertical.name.value }}</span>
        </div>
      {% endif %}
    </div>
  </section>

</div>
