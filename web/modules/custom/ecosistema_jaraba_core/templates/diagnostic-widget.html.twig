{#
/**
 * @file diagnostic-widget.html.twig
 * @description Widget de DiagnÃ³stico Express TTV para Value-First Onboarding
 * 
 * PROPÃ“SITO:
 * Componente embeddable que implementa el DiagnÃ³stico Express con TTV < 60s.
 * Renderiza las 3-4 preguntas segÃºn vertical y muestra resultado instantÃ¡neo.
 * 
 * VARIABLES:
 * - vertical: 'empleabilidad' | 'emprendimiento' (obligatorio)
 * - title: TÃ­tulo personalizado (opcional)
 * - subtitle: SubtÃ­tulo (opcional)
 * - show_cta: Mostrar botÃ³n CTA tras resultado (default: true)
 * - cta_url: URL del CTA
 * - cta_text: Texto del CTA
 * 
 * USO:
 * {{ drupal_render(content.diagnostic_widget) }}
 * o directamente con include:
 * {% include '@ecosistema_jaraba_core/diagnostic-widget.html.twig' with {
 *   vertical: 'empleabilidad',
 *   title: 'Â¿CÃ³mo estÃ¡ tu empleabilidad digital?'
 * } %}
 * 
 * @version 1.0.0
 */
#}

{% set vertical = vertical|default('empleabilidad') %}
{% set show_cta = show_cta ?? true %}

<div class="diagnostic-widget" data-vertical="{{ vertical }}">
  
  {# === HEADER === #}
  <div class="diagnostic-widget__header">
    <div class="header-icon">
      {% if vertical == 'empleabilidad' %}
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
      {% else %}
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/></svg>
      {% endif %}
    </div>
    <h2>{{ title|default(vertical == 'empleabilidad' ? 'Â¿CÃ³mo estÃ¡ tu empleabilidad digital?' : 'Â¿CuÃ¡nto dinero estÃ¡s dejando de ganar?') }}</h2>
    <p>{{ subtitle|default('Responde 3 preguntas y descÃºbrelo en 30 segundos') }}</p>
  </div>
  
  {# === FORMULARIO DE PREGUNTAS === #}
  <form class="diagnostic-express-form" data-vertical="{{ vertical }}">
    
    {% if vertical == 'empleabilidad' %}
      {# Pregunta 1: LinkedIn #}
      <div class="question-group" data-question="linkedin">
        <span class="question-label">1. Â¿CÃ³mo describirÃ­as tu presencia en LinkedIn?</span>
        <div class="answer-options">
          <div class="answer-option">
            <input type="radio" id="linkedin_0" name="linkedin" value="0">
            <label for="linkedin_0">
              <span class="option-icon">âŒ</span>
              <span class="option-text">
                <span class="option-title">No tengo perfil</span>
                <span class="option-subtitle">O lo creÃ© pero nunca lo uso</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="linkedin_1" name="linkedin" value="1">
            <label for="linkedin_1">
              <span class="option-icon">ğŸ“</span>
              <span class="option-text">
                <span class="option-title">Perfil bÃ¡sico</span>
                <span class="option-subtitle">Con foto pero sin optimizar</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="linkedin_2" name="linkedin" value="2">
            <label for="linkedin_2">
              <span class="option-icon">â­</span>
              <span class="option-text">
                <span class="option-title">Perfil completo</span>
                <span class="option-subtitle">Con experiencia y habilidades</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="linkedin_3" name="linkedin" value="3">
            <label for="linkedin_3">
              <span class="option-icon">ğŸš€</span>
              <span class="option-text">
                <span class="option-title">Perfil optimizado</span>
                <span class="option-subtitle">Publico contenido y tengo red activa</span>
              </span>
            </label>
          </div>
        </div>
      </div>
      
      {# Pregunta 2: CV #}
      <div class="question-group" data-question="cv">
        <span class="question-label">2. Â¿CuÃ¡l es el estado de tu currÃ­culum?</span>
        <div class="answer-options">
          <div class="answer-option">
            <input type="radio" id="cv_0" name="cv" value="0">
            <label for="cv_0">
              <span class="option-icon">ğŸ“„</span>
              <span class="option-text">
                <span class="option-title">CV genÃ©rico</span>
                <span class="option-subtitle">Mismo CV para todas las ofertas</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="cv_1" name="cv" value="1">
            <label for="cv_1">
              <span class="option-icon">ğŸ“‹</span>
              <span class="option-text">
                <span class="option-title">CV sectorial</span>
                <span class="option-subtitle">Adaptado a mi sector objetivo</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="cv_2" name="cv" value="2">
            <label for="cv_2">
              <span class="option-icon">ğŸ¯</span>
              <span class="option-text">
                <span class="option-title">CV personalizado</span>
                <span class="option-subtitle">Lo adapto a cada oferta importante</span>
              </span>
            </label>
          </div>
        </div>
      </div>
      
      {# Pregunta 3: Estrategia de bÃºsqueda #}
      <div class="question-group" data-question="search">
        <span class="question-label">3. Â¿CÃ³mo buscas empleo actualmente?</span>
        <div class="answer-options">
          <div class="answer-option">
            <input type="radio" id="search_0" name="search" value="0">
            <label for="search_0">
              <span class="option-icon">ğŸ˜´</span>
              <span class="option-text">
                <span class="option-title">Espero que me contacten</span>
                <span class="option-subtitle">No busco activamente</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="search_1" name="search" value="1">
            <label for="search_1">
              <span class="option-icon">ğŸ”</span>
              <span class="option-text">
                <span class="option-title">Portales de empleo</span>
                <span class="option-subtitle">InfoJobs, LinkedIn, etc.</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="search_2" name="search" value="2">
            <label for="search_2">
              <span class="option-icon">ğŸ¤</span>
              <span class="option-text">
                <span class="option-title">Networking + Portales</span>
                <span class="option-subtitle">Combino contactos y ofertas</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="search_3" name="search" value="3">
            <label for="search_3">
              <span class="option-icon">ğŸ¯</span>
              <span class="option-text">
                <span class="option-title">Estrategia multicanal</span>
                <span class="option-subtitle">Marca personal + contacto directo + portales</span>
              </span>
            </label>
          </div>
        </div>
      </div>
      
    {% else %}
      {# === PREGUNTAS EMPRENDIMIENTO === #}
      
      {# Pregunta 1: Presencia digital #}
      <div class="question-group" data-question="presence">
        <span class="question-label">1. Â¿CuÃ¡l es tu presencia digital?</span>
        <div class="answer-options">
          <div class="answer-option">
            <input type="radio" id="presence_0" name="presence" value="0">
            <label for="presence_0">
              <span class="option-icon">âŒ</span>
              <span class="option-text">
                <span class="option-title">Sin presencia</span>
                <span class="option-subtitle">No tengo web ni redes sociales</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="presence_1" name="presence" value="1">
            <label for="presence_1">
              <span class="option-icon">ğŸ“±</span>
              <span class="option-text">
                <span class="option-title">Redes sociales bÃ¡sicas</span>
                <span class="option-subtitle">Facebook/Instagram sin estrategia</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="presence_2" name="presence" value="2">
            <label for="presence_2">
              <span class="option-icon">ğŸŒ</span>
              <span class="option-text">
                <span class="option-title">Web + Redes</span>
                <span class="option-subtitle">PÃ¡gina web y perfiles activos</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="presence_3" name="presence" value="3">
            <label for="presence_3">
              <span class="option-icon">ğŸš€</span>
              <span class="option-text">
                <span class="option-title">Ecosistema digital completo</span>
                <span class="option-subtitle">Web + SEO + Redes + Email Marketing</span>
              </span>
            </label>
          </div>
        </div>
      </div>
      
      {# Pregunta 2: AutomatizaciÃ³n #}
      <div class="question-group" data-question="automation">
        <span class="question-label">2. Â¿QuÃ© nivel de automatizaciÃ³n tienes?</span>
        <div class="answer-options">
          <div class="answer-option">
            <input type="radio" id="automation_0" name="automation" value="0">
            <label for="automation_0">
              <span class="option-icon">ğŸ“</span>
              <span class="option-text">
                <span class="option-title">Todo manual</span>
                <span class="option-subtitle">Facturas, emails, todo a mano</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="automation_1" name="automation" value="1">
            <label for="automation_1">
              <span class="option-icon">ğŸ“Š</span>
              <span class="option-text">
                <span class="option-title">Excel/hojas de cÃ¡lculo</span>
                <span class="option-subtitle">Uso plantillas bÃ¡sicas</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="automation_2" name="automation" value="2">
            <label for="automation_2">
              <span class="option-icon">âš™ï¸</span>
              <span class="option-text">
                <span class="option-title">Herramientas digitales</span>
                <span class="option-subtitle">CRM, facturaciÃ³n online, etc.</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="automation_3" name="automation" value="3">
            <label for="automation_3">
              <span class="option-icon">ğŸ¤–</span>
              <span class="option-text">
                <span class="option-title">AutomatizaciÃ³n avanzada</span>
                <span class="option-subtitle">Workflows, integraciones, APIs</span>
              </span>
            </label>
          </div>
        </div>
      </div>
      
      {# Pregunta 3: AdopciÃ³n IA #}
      <div class="question-group" data-question="ai_adoption">
        <span class="question-label">3. Â¿Usas inteligencia artificial en tu negocio?</span>
        <div class="answer-options">
          <div class="answer-option">
            <input type="radio" id="ai_0" name="ai_adoption" value="0">
            <label for="ai_0">
              <span class="option-icon">ğŸ¤·</span>
              <span class="option-text">
                <span class="option-title">No uso IA</span>
                <span class="option-subtitle">No sÃ© por dÃ³nde empezar</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="ai_1" name="ai_adoption" value="1">
            <label for="ai_1">
              <span class="option-icon">ğŸ’¬</span>
              <span class="option-text">
                <span class="option-title">ChatGPT ocasional</span>
                <span class="option-subtitle">Para consultas puntuales</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="ai_2" name="ai_adoption" value="2">
            <label for="ai_2">
              <span class="option-icon">ğŸ“</span>
              <span class="option-text">
                <span class="option-title">IA para contenidos</span>
                <span class="option-subtitle">Genero textos, imÃ¡genes, etc.</span>
              </span>
            </label>
          </div>
          <div class="answer-option">
            <input type="radio" id="ai_3" name="ai_adoption" value="3">
            <label for="ai_3">
              <span class="option-icon">ğŸ§ </span>
              <span class="option-text">
                <span class="option-title">IA integrada en procesos</span>
                <span class="option-subtitle">Agentes, automatizaciones, anÃ¡lisis</span>
              </span>
            </label>
          </div>
        </div>
      </div>
      
      {# Pregunta 4 (implÃ­cita): Operaciones - simplificada #}
      <input type="hidden" name="operations" value="1">
      
    {% endif %}
    
    <button type="submit" class="diagnostic-submit" style="display: none;">
      {{ 'Ver mi diagnÃ³stico'|t }}
    </button>
  </form>
  
  {# === PANTALLA DE CARGA === #}
  <div class="diagnostic-loading">
    <div class="loading-spinner"></div>
    <p class="loading-message">{{ 'Analizando tu perfil...'|t }}</p>
    <div class="progress-container">
      <div class="progress-bar-bg">
        <div class="progress-bar"></div>
      </div>
    </div>
  </div>
  
  {# === PANTALLA DE RESULTADOS === #}
  <div class="diagnostic-result">
    <div class="result-score-circle">
      <div class="score-inner">
        <span class="result-score-value">0</span>
        <span class="result-score-max">/10</span>
      </div>
    </div>
    
    <p class="result-profile-label"></p>
    
    <div class="result-card">
      <span class="card-label">{{ 'Tu brecha principal'|t }}</span>
      <span class="card-value result-primary-gap"></span>
    </div>
    
    {% if vertical == 'emprendimiento' %}
      <div class="result-economic-impact"></div>
    {% else %}
      <div class="result-impact-data"></div>
    {% endif %}
    
    <div class="result-card">
      <span class="card-label">{{ 'Tu prÃ³ximo paso'|t }}</span>
      <span class="card-value result-suggested-action"></span>
    </div>
    
    {% if show_cta %}
      <div class="result-cta">
        <a href="{{ cta_url|default('/register') }}" class="cta-button">
          {{ cta_text|default('Empieza tu transformaciÃ³n gratis') }}
        </a>
        <span class="cta-subtitle">{{ 'Sin compromiso Â· Resultados en 7 dÃ­as'|t }}</span>
      </div>
    {% endif %}
  </div>
  
</div>
