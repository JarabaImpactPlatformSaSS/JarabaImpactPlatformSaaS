# =============================================================================
# Rutas del módulo ComercioConecta - Fase 1
# Estructura: rutas de settings (Field UI), frontend y API REST
# Lógica: cada entidad tiene su ruta de settings para field_ui_base_route,
#   las rutas CRUD de entidad las genera AdminHtmlRouteProvider automáticamente
# =============================================================================

# --- Settings Routes (para Field UI de cada entidad) ---

jaraba_comercio_conecta.product_retail.settings:
  path: '/admin/structure/comercio-products'
  defaults:
    _form: '\Drupal\jaraba_comercio_conecta\Form\ProductRetailSettingsForm'
    _title: 'Configuración Productos Comercio'
  requirements:
    _permission: 'manage comercio products'

jaraba_comercio_conecta.product_variation_retail.settings:
  path: '/admin/structure/comercio-variations'
  defaults:
    _form: '\Drupal\jaraba_comercio_conecta\Form\ProductVariationRetailSettingsForm'
    _title: 'Configuración Variaciones Comercio'
  requirements:
    _permission: 'manage comercio products'

jaraba_comercio_conecta.stock_location.settings:
  path: '/admin/structure/comercio-stock-locations'
  defaults:
    _form: '\Drupal\jaraba_comercio_conecta\Form\StockLocationSettingsForm'
    _title: 'Configuración Ubicaciones Stock'
  requirements:
    _permission: 'manage comercio stock'

jaraba_comercio_conecta.merchant_profile.settings:
  path: '/admin/structure/comercio-merchants'
  defaults:
    _form: '\Drupal\jaraba_comercio_conecta\Form\MerchantProfileSettingsForm'
    _title: 'Configuración Comerciantes'
  requirements:
    _permission: 'manage comercio merchants'

# --- Rutas Frontend del Marketplace ---

jaraba_comercio_conecta.marketplace:
  path: '/comercio-local'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\MarketplaceController::marketplace'
    _title: 'Comercio Local'
  requirements:
    _permission: 'access content'

jaraba_comercio_conecta.marketplace.merchant:
  path: '/comercio-local/{merchant_slug}'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\MarketplaceController::merchantPage'
    _title: 'Comercio'
  requirements:
    _permission: 'access content'
    merchant_slug: '[a-z0-9\-]+'

jaraba_comercio_conecta.marketplace.product:
  path: '/comercio-local/producto/{product_retail}'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\MarketplaceController::productDetail'
    _title: 'Producto'
  requirements:
    _permission: 'access content'
    product_retail: '\d+'

# --- Rutas Frontend del Merchant Portal ---

jaraba_comercio_conecta.merchant_portal:
  path: '/mi-comercio'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\MerchantPortalController::dashboard'
    _title: 'Mi Comercio'
  requirements:
    _permission: 'edit own merchant profile'

jaraba_comercio_conecta.merchant_portal.products:
  path: '/mi-comercio/productos'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\MerchantPortalController::products'
    _title: 'Mis Productos'
  requirements:
    _permission: 'edit own merchant profile'

jaraba_comercio_conecta.merchant_portal.product_add:
  path: '/mi-comercio/productos/add'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\MerchantPortalController::productAdd'
    _title: 'Nuevo Producto'
  requirements:
    _permission: 'create comercio products'

jaraba_comercio_conecta.merchant_portal.stock:
  path: '/mi-comercio/stock'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\MerchantPortalController::stock'
    _title: 'Inventario'
  requirements:
    _permission: 'view comercio stock'

jaraba_comercio_conecta.merchant_portal.analytics:
  path: '/mi-comercio/analiticas'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\MerchantPortalController::analytics'
    _title: 'Analíticas'
  requirements:
    _permission: 'view merchant analytics'

jaraba_comercio_conecta.merchant_portal.profile:
  path: '/mi-comercio/perfil'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\MerchantPortalController::profile'
    _title: 'Perfil del Comercio'
  requirements:
    _permission: 'edit own merchant profile'

# --- API REST Productos ---

jaraba_comercio_conecta.api.products:
  path: '/api/v1/comercio/products'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\ProductApiController::list'
  methods: [GET]
  requirements:
    _permission: 'view comercio products'

jaraba_comercio_conecta.api.products.detail:
  path: '/api/v1/comercio/products/{product_retail}'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\ProductApiController::detail'
  methods: [GET]
  requirements:
    _permission: 'view comercio products'
    product_retail: '\d+'

jaraba_comercio_conecta.api.products.create:
  path: '/api/v1/comercio/products'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\ProductApiController::createProduct'
  methods: [POST]
  requirements:
    _permission: 'create comercio products'

jaraba_comercio_conecta.api.products.update:
  path: '/api/v1/comercio/products/{product_retail}'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\ProductApiController::update'
  methods: [PATCH]
  requirements:
    _permission: 'edit own comercio products'
    product_retail: '\d+'

jaraba_comercio_conecta.api.products.variations:
  path: '/api/v1/comercio/products/{product_retail}/variations'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\ProductApiController::variations'
  methods: [GET]
  requirements:
    _permission: 'view comercio products'
    product_retail: '\d+'

jaraba_comercio_conecta.api.stock.update:
  path: '/api/v1/comercio/stock/update'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\ProductApiController::updateStock'
  methods: [POST]
  requirements:
    _permission: 'manage comercio stock'

# --- API REST Merchants ---

jaraba_comercio_conecta.api.merchants:
  path: '/api/v1/comercio/merchants'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\ProductApiController::merchants'
  methods: [GET]
  requirements:
    _permission: 'view comercio merchants'

jaraba_comercio_conecta.api.merchants.detail:
  path: '/api/v1/comercio/merchants/{merchant_profile}'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\ProductApiController::merchantDetail'
  methods: [GET]
  requirements:
    _permission: 'view comercio merchants'
    merchant_profile: '\d+'

jaraba_comercio_conecta.api.merchants.nearby:
  path: '/api/v1/comercio/merchants/nearby'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\ProductApiController::merchantsNearby'
  methods: [GET]
  requirements:
    _permission: 'access content'

# --- Settings Routes F6: Orders, Returns, Coupons ---

jaraba_comercio_conecta.order_retail.settings:
  path: '/admin/structure/comercio-orders'
  defaults:
    _form: '\Drupal\jaraba_comercio_conecta\Form\OrderRetailSettingsForm'
    _title: 'Configuracion Pedidos Comercio'
  requirements:
    _permission: 'manage comercio orders'

jaraba_comercio_conecta.return_request.settings:
  path: '/admin/structure/comercio-returns'
  defaults:
    _form: '\Drupal\jaraba_comercio_conecta\Form\ReturnRequestSettingsForm'
    _title: 'Configuracion Devoluciones Comercio'
  requirements:
    _permission: 'manage comercio returns'

jaraba_comercio_conecta.coupon_retail.settings:
  path: '/admin/structure/comercio-coupons'
  defaults:
    _form: '\Drupal\jaraba_comercio_conecta\Form\CouponRetailSettingsForm'
    _title: 'Configuracion Cupones Comercio'
  requirements:
    _permission: 'manage comercio coupons'

# --- Rutas Frontend F6: Checkout ---

jaraba_comercio_conecta.checkout:
  path: '/comercio-local/checkout'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CheckoutController::checkoutPage'
    _title: 'Finalizar Compra'
  requirements:
    _permission: 'access content'

jaraba_comercio_conecta.checkout.process:
  path: '/comercio-local/checkout/payment'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CheckoutController::processPayment'
  methods: [POST]
  requirements:
    _permission: 'access content'

jaraba_comercio_conecta.checkout.confirmation:
  path: '/comercio-local/checkout/confirmacion/{order_id}'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CheckoutController::confirmationPage'
    _title: 'Pedido Confirmado'
  requirements:
    _permission: 'access content'
    order_id: '\d+'

jaraba_comercio_conecta.webhook.stripe:
  path: '/api/v1/comercio/webhook/stripe'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CheckoutController::webhookStripe'
  methods: [POST]
  requirements:
    _access: 'TRUE'

# --- Rutas Frontend F6: Pedidos del cliente ---

jaraba_comercio_conecta.my_orders:
  path: '/mis-pedidos'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\OrderController::myOrders'
    _title: 'Mis Pedidos'
  requirements:
    _permission: 'view own comercio orders'

jaraba_comercio_conecta.my_orders.detail:
  path: '/mis-pedidos/{order_id}'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\OrderController::orderDetail'
    _title: 'Detalle del Pedido'
  requirements:
    _permission: 'view own comercio orders'
    order_id: '\d+'

# --- API REST F6: Orders ---

jaraba_comercio_conecta.api.orders:
  path: '/api/v1/comercio/orders'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\OrderController::apiListOrders'
  methods: [GET]
  requirements:
    _permission: 'view own comercio orders'

jaraba_comercio_conecta.api.orders.detail:
  path: '/api/v1/comercio/orders/{order_id}'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\OrderController::apiGetOrder'
  methods: [GET]
  requirements:
    _permission: 'view own comercio orders'
    order_id: '\d+'

jaraba_comercio_conecta.api.orders.status:
  path: '/api/v1/comercio/orders/{order_id}/status'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\OrderController::apiUpdateStatus'
  methods: [PATCH]
  requirements:
    _permission: 'manage merchant orders'
    order_id: '\d+'

# --- API REST F6: Cart ---

jaraba_comercio_conecta.api.cart:
  path: '/api/v1/comercio/cart'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CartApiController::getCart'
  methods: [GET]
  requirements:
    _permission: 'access content'

jaraba_comercio_conecta.api.cart.add:
  path: '/api/v1/comercio/cart/add'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CartApiController::addItem'
  methods: [POST]
  requirements:
    _permission: 'access content'

jaraba_comercio_conecta.api.cart.remove:
  path: '/api/v1/comercio/cart/remove/{item_id}'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CartApiController::removeItem'
  methods: [DELETE]
  requirements:
    _permission: 'access content'
    item_id: '\d+'

jaraba_comercio_conecta.api.cart.update:
  path: '/api/v1/comercio/cart/update/{item_id}'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CartApiController::updateQuantity'
  methods: [PATCH]
  requirements:
    _permission: 'access content'
    item_id: '\d+'

jaraba_comercio_conecta.api.cart.coupon:
  path: '/api/v1/comercio/cart/coupon'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CartApiController::applyCoupon'
  methods: [POST]
  requirements:
    _permission: 'access content'

# --- Settings Route F7: Customer Profile ---

jaraba_comercio_conecta.customer_profile_retail.settings:
  path: '/admin/structure/comercio-customer-profiles'
  defaults:
    _form: '\Drupal\jaraba_comercio_conecta\Form\CustomerProfileSettingsForm'
    _title: 'Configuracion Perfiles Consumidor'
  requirements:
    _permission: 'administer customer profiles'

# --- Rutas Frontend F7: Customer Portal ---

jaraba_comercio_conecta.customer_portal:
  path: '/mi-cuenta'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CustomerPortalController::dashboard'
    _title: 'Mi Cuenta'
  requirements:
    _user_is_logged_in: 'TRUE'

jaraba_comercio_conecta.customer_portal.wishlist:
  path: '/mi-cuenta/wishlist'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CustomerPortalController::wishlist'
    _title: 'Mi Lista de Deseos'
  requirements:
    _user_is_logged_in: 'TRUE'

jaraba_comercio_conecta.customer_portal.profile:
  path: '/mi-cuenta/perfil'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CustomerPortalController::profile'
    _title: 'Mi Perfil'
  requirements:
    _user_is_logged_in: 'TRUE'

# --- Rutas Frontend F7: Merchant Portal (ampliacion) ---

jaraba_comercio_conecta.merchant_portal.orders:
  path: '/mi-comercio/pedidos'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\MerchantPortalController::merchantOrders'
    _title: 'Pedidos Recibidos'
  requirements:
    _permission: 'manage merchant orders'

jaraba_comercio_conecta.merchant_portal.payments:
  path: '/mi-comercio/pagos'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\MerchantPortalController::merchantPayments'
    _title: 'Pagos y Comisiones'
  requirements:
    _permission: 'edit own merchant profile'

jaraba_comercio_conecta.merchant_portal.settings:
  path: '/mi-comercio/configuracion'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\MerchantPortalController::merchantSettings'
    _title: 'Configuracion del Comercio'
  requirements:
    _permission: 'edit own merchant profile'

# --- API REST F7: Wishlist ---

jaraba_comercio_conecta.api.wishlist.add:
  path: '/api/v1/comercio/wishlist/add'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CustomerPortalController::apiAddToWishlist'
  methods: [POST]
  requirements:
    _user_is_logged_in: 'TRUE'

jaraba_comercio_conecta.api.wishlist.remove:
  path: '/api/v1/comercio/wishlist/remove'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CustomerPortalController::apiRemoveFromWishlist'
  methods: [DELETE]
  requirements:
    _user_is_logged_in: 'TRUE'

# --- Settings Routes F8: Search + Local SEO ---

jaraba_comercio_conecta.comercio_search_index.settings:
  path: '/admin/structure/comercio-search-index'
  defaults:
    _form: '\Drupal\jaraba_comercio_conecta\Form\SearchIndexSettingsForm'
    _title: 'Configuracion Indice Busqueda'
  requirements:
    _permission: 'administer comercio search'

jaraba_comercio_conecta.comercio_local_business.settings:
  path: '/admin/structure/comercio-local-business'
  defaults:
    _form: '\Drupal\jaraba_comercio_conecta\Form\LocalBusinessProfileSettingsForm'
    _title: 'Configuracion Perfil SEO Local'
  requirements:
    _permission: 'administer comercio local seo'

# --- Rutas Frontend F8: Busqueda ---

jaraba_comercio_conecta.search:
  path: '/comercio-local/buscar'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\SearchController::searchPage'
    _title: 'Buscar en Comercio Local'
  requirements:
    _permission: 'access content'

# --- API REST F8: Search ---

jaraba_comercio_conecta.api.search:
  path: '/api/v1/comercio/search'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\SearchController::apiSearch'
  methods: [GET]
  requirements:
    _permission: 'access content'

jaraba_comercio_conecta.api.search.autocomplete:
  path: '/api/v1/comercio/search/autocomplete'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\SearchController::apiAutocomplete'
  methods: [GET]
  requirements:
    _permission: 'access content'

# --- Settings Routes F9: Flash Offers, Reviews ---

jaraba_comercio_conecta.comercio_flash_offer.settings:
  path: '/admin/structure/comercio-flash-offers'
  defaults:
    _form: '\Drupal\jaraba_comercio_conecta\Form\FlashOfferSettingsForm'
    _title: 'Configuracion Ofertas Flash'
  requirements:
    _permission: 'manage comercio flash offers'

jaraba_comercio_conecta.comercio_review.settings:
  path: '/admin/structure/comercio-reviews'
  defaults:
    _form: '\Drupal\jaraba_comercio_conecta\Form\ReviewRetailSettingsForm'
    _title: 'Configuracion Resenas'
  requirements:
    _permission: 'manage comercio reviews'

# --- API REST F9: Flash Offers ---

jaraba_comercio_conecta.api.flash_offers:
  path: '/api/v1/comercio/flash-offers'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::listActiveOffers'
  methods: [GET]
  requirements:
    _permission: 'access content'

jaraba_comercio_conecta.api.flash_offers.claim:
  path: '/api/v1/comercio/flash-offers/{offer_id}/claim'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::claimOffer'
  methods: [POST]
  requirements:
    _user_is_logged_in: 'TRUE'
    offer_id: '\d+'

jaraba_comercio_conecta.api.flash_offers.redeem:
  path: '/api/v1/comercio/flash-offers/redeem'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::redeemClaim'
  methods: [POST]
  requirements:
    _permission: 'manage comercio flash offers'

jaraba_comercio_conecta.api.flash_offers.stats:
  path: '/api/v1/comercio/flash-offers/{offer_id}/stats'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::offerStats'
  methods: [GET]
  requirements:
    _permission: 'manage comercio flash offers'
    offer_id: '\d+'

# --- API REST F9: QR ---

jaraba_comercio_conecta.api.qr.resolve:
  path: '/qr/{short_code}'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::resolveQr'
  requirements:
    _permission: 'access content'
    short_code: '[a-zA-Z0-9]+'

jaraba_comercio_conecta.api.qr.lead:
  path: '/api/v1/comercio/qr/{qr_code_id}/lead'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::captureQrLead'
  methods: [POST]
  requirements:
    _permission: 'access content'
    qr_code_id: '\d+'

jaraba_comercio_conecta.api.qr.stats:
  path: '/api/v1/comercio/qr/{qr_code_id}/stats'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::qrStats'
  methods: [GET]
  requirements:
    _permission: 'manage comercio qr codes'
    qr_code_id: '\d+'

# --- API REST F9: Reviews ---

jaraba_comercio_conecta.api.reviews:
  path: '/api/v1/comercio/reviews/{entity_type}/{entity_id}'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::listReviews'
  methods: [GET]
  requirements:
    _permission: 'access content'
    entity_type: '[a-z_]+'
    entity_id: '\d+'

jaraba_comercio_conecta.api.reviews.create:
  path: '/api/v1/comercio/reviews'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::createReview'
  methods: [POST]
  requirements:
    _permission: 'submit comercio reviews'

jaraba_comercio_conecta.api.reviews.helpful:
  path: '/api/v1/comercio/reviews/{review_id}/helpful'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::markReviewHelpful'
  methods: [POST]
  requirements:
    _permission: 'access content'
    review_id: '\d+'

# --- API REST F9: Notifications ---

jaraba_comercio_conecta.api.notifications:
  path: '/api/v1/comercio/notifications'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::notificationHistory'
  methods: [GET]
  requirements:
    _user_is_logged_in: 'TRUE'

jaraba_comercio_conecta.api.notifications.read:
  path: '/api/v1/comercio/notifications/{log_id}/read'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::markNotificationRead'
  methods: [POST]
  requirements:
    _user_is_logged_in: 'TRUE'
    log_id: '\d+'

jaraba_comercio_conecta.api.notifications.preferences:
  path: '/api/v1/comercio/notifications/preferences'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::getPreferences'
  methods: [GET]
  requirements:
    _user_is_logged_in: 'TRUE'

jaraba_comercio_conecta.api.notifications.preferences.update:
  path: '/api/v1/comercio/notifications/preferences'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\FlashOfferApiController::updatePreference'
  methods: [POST]
  requirements:
    _user_is_logged_in: 'TRUE'

# --- API REST: Copilot Proactive Actions ---
# GET: check pending proactive action, POST: dismiss action

jaraba_comercio_conecta.copilot.proactive:
  path: '/api/v1/copilot/comercio/proactive'
  defaults:
    _controller: '\Drupal\jaraba_comercio_conecta\Controller\CopilotApiController::proactive'
  requirements:
    _permission: 'access content'
  methods: [GET, POST]
  options:
    _format: json
