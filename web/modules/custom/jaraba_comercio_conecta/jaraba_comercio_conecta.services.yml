services:
  # =====================================================================
  # Canal de log dedicado para ComercioConecta
  # Permite filtrar mensajes del vertical en los logs de Drupal
  # =====================================================================
  logger.channel.jaraba_comercio_conecta:
    parent: logger.channel_base
    arguments: ['jaraba_comercio_conecta']

  # =====================================================================
  # MarketplaceService: Lógica del marketplace público
  # Responsabilidad: listado de productos, comercios, búsqueda, filtros
  # Relaciones: consume ProductRetail, MerchantProfile, taxonomías
  # =====================================================================
  jaraba_comercio_conecta.marketplace:
    class: Drupal\jaraba_comercio_conecta\Service\MarketplaceService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@logger.channel.jaraba_comercio_conecta'
      - '@ecosistema_jaraba_core.comercioconecta_feature_gate'

  # =====================================================================
  # ProductRetailService: CRUD y lógica de productos retail
  # Responsabilidad: crear, actualizar, importar/exportar productos,
  #   gestión de variaciones y stock multi-ubicación
  # Relaciones: consume MerchantProfile, StockLocation
  # =====================================================================
  jaraba_comercio_conecta.product_retail:
    class: Drupal\jaraba_comercio_conecta\Service\ProductRetailService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@logger.channel.jaraba_comercio_conecta'
      - '@ecosistema_jaraba_core.comercioconecta_feature_gate'

  # =====================================================================
  # MerchantDashboardService: KPIs y datos del dashboard del comerciante
  # Responsabilidad: ventas, pedidos pendientes, alertas stock, rating
  # Relaciones: consume OrderRetail, ProductRetail, ReviewRetail
  # =====================================================================
  jaraba_comercio_conecta.merchant_dashboard:
    class: Drupal\jaraba_comercio_conecta\Service\MerchantDashboardService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@database'
      - '@logger.channel.jaraba_comercio_conecta'

  # =====================================================================
  # ComercioConectaCopilotBridgeService: Contexto para copiloto IA
  # Plan Elevacion ComercioConecta Clase Mundial v1 — Fase 13
  # =====================================================================
  # =====================================================================
  # OrderRetailService: CRUD y logica de pedidos retail
  # Responsabilidad: crear, actualizar, cambiar estado de pedidos,
  #   listar pedidos de usuario/comerciante, estadisticas
  # =====================================================================
  jaraba_comercio_conecta.order_retail:
    class: Drupal\jaraba_comercio_conecta\Service\OrderRetailService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@logger.channel.jaraba_comercio_conecta'

  # =====================================================================
  # CartService: Gestion de carrito de compras
  # Responsabilidad: crear/obtener carrito, agregar/quitar items,
  #   aplicar cupones, recalcular totales
  # =====================================================================
  jaraba_comercio_conecta.cart:
    class: Drupal\jaraba_comercio_conecta\Service\CartService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@logger.channel.jaraba_comercio_conecta'
      - '@ecosistema_jaraba_core.tenant_context'

  # =====================================================================
  # CheckoutService: Flujo de checkout multi-step
  # Responsabilidad: validar stock, crear pedido desde carrito,
  #   crear sub-pedidos por comerciante, registrar cupones
  # =====================================================================
  jaraba_comercio_conecta.checkout:
    class: Drupal\jaraba_comercio_conecta\Service\CheckoutService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@jaraba_comercio_conecta.cart'
      - '@logger.channel.jaraba_comercio_conecta'

  # =====================================================================
  # StripePaymentRetailService: Pagos Stripe Connect con split
  # Responsabilidad: crear payment intents, confirmar pagos,
  #   procesar reembolsos, transferencias a comerciantes
  # =====================================================================
  jaraba_comercio_conecta.stripe_payment:
    class: Drupal\jaraba_comercio_conecta\Service\StripePaymentRetailService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@logger.channel.jaraba_comercio_conecta'

  # =====================================================================
  # CartRecoveryService: Deteccion y recuperacion de carritos abandonados
  # Responsabilidad: detectar carritos inactivos, enviar emails de
  #   recuperacion, estadisticas de conversion
  # =====================================================================
  jaraba_comercio_conecta.cart_recovery:
    class: Drupal\jaraba_comercio_conecta\Service\CartRecoveryService
    arguments:
      - '@entity_type.manager'
      - '@logger.channel.jaraba_comercio_conecta'

  # =====================================================================
  # CustomerProfileService: Gestion de perfiles de consumidor
  # Responsabilidad: crear/obtener perfil, favoritos, puntos fidelidad
  # =====================================================================
  jaraba_comercio_conecta.customer_profile:
    class: Drupal\jaraba_comercio_conecta\Service\CustomerProfileService
    arguments:
      - '@entity_type.manager'
      - '@current_route_match'

  # =====================================================================
  # WishlistService: Gestion de listas de deseos
  # Responsabilidad: CRUD wishlists, agregar/quitar items, verificar
  # =====================================================================
  jaraba_comercio_conecta.wishlist:
    class: Drupal\jaraba_comercio_conecta\Service\WishlistService
    arguments:
      - '@entity_type.manager'
      - '@current_user'

  # =====================================================================
  # MerchantPayoutService: Historial de pagos y comisiones del comerciante
  # Responsabilidad: resumen de payouts, ingresos mensuales, pendientes
  # =====================================================================
  jaraba_comercio_conecta.merchant_payout:
    class: Drupal\jaraba_comercio_conecta\Service\MerchantPayoutService
    arguments:
      - '@entity_type.manager'
      - '@logger.factory'

  # =====================================================================
  # F8: ComercioSearchService — Busqueda con facetas y geolocalizacion
  # =====================================================================
  jaraba_comercio_conecta.comercio_search:
    class: Drupal\jaraba_comercio_conecta\Service\ComercioSearchService
    arguments:
      - '@entity_type.manager'
      - '@database'
      - '@logger.factory'

  # =====================================================================
  # F8: LocalSeoService — Schema.org, sitemap, Google Business Profile
  # =====================================================================
  jaraba_comercio_conecta.local_seo:
    class: Drupal\jaraba_comercio_conecta\Service\LocalSeoService
    arguments:
      - '@entity_type.manager'
      - '@logger.factory'

  # =====================================================================
  # F9: FlashOfferService — Ofertas relampago geolocalizadas
  # =====================================================================
  jaraba_comercio_conecta.flash_offer:
    class: Drupal\jaraba_comercio_conecta\Service\FlashOfferService
    arguments:
      - '@entity_type.manager'
      - '@logger.factory'

  # =====================================================================
  # F9: QrRetailService — QR dinamicos con A/B testing
  # =====================================================================
  jaraba_comercio_conecta.qr_retail:
    class: Drupal\jaraba_comercio_conecta\Service\QrRetailService
    arguments:
      - '@entity_type.manager'
      - '@logger.factory'

  # =====================================================================
  # F9: ReviewRetailService — Resenas y valoraciones
  # =====================================================================
  jaraba_comercio_conecta.review_retail:
    class: Drupal\jaraba_comercio_conecta\Service\ReviewRetailService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@logger.factory'

  # =====================================================================
  # F9: NotificationService — Notificaciones multi-canal
  # =====================================================================
  jaraba_comercio_conecta.notification:
    class: Drupal\jaraba_comercio_conecta\Service\NotificationService
    arguments:
      - '@entity_type.manager'
      - '@plugin.manager.mail'
      - '@logger.factory'

  # =====================================================================
  # F10a: ShippingRetailService — Tarifas, tracking, carriers
  # =====================================================================
  jaraba_comercio_conecta.shipping_retail:
    class: Drupal\jaraba_comercio_conecta\Service\ShippingRetailService
    arguments:
      - '@entity_type.manager'
      - '@logger.factory'

  # =====================================================================
  # F10a: ClickCollectService — Reserva en tienda, horarios
  # =====================================================================
  jaraba_comercio_conecta.click_collect:
    class: Drupal\jaraba_comercio_conecta\Service\ClickCollectService
    arguments:
      - '@entity_type.manager'
      - '@logger.factory'

  # =====================================================================
  # F10b: PosIntegrationService — Sincronizacion bidireccional TPV
  # =====================================================================
  jaraba_comercio_conecta.pos_integration:
    class: Drupal\jaraba_comercio_conecta\Service\PosIntegrationService
    arguments:
      - '@entity_type.manager'
      - '@logger.factory'

  # =====================================================================
  # F10c: ComercioAdminService — Panel admin del marketplace
  # =====================================================================
  jaraba_comercio_conecta.comercio_admin:
    class: Drupal\jaraba_comercio_conecta\Service\ComercioAdminService
    arguments:
      - '@entity_type.manager'
      - '@database'
      - '@logger.factory'

  # =====================================================================
  # F10c: ModerationService — Moderacion de contenido
  # =====================================================================
  jaraba_comercio_conecta.moderation:
    class: Drupal\jaraba_comercio_conecta\Service\ModerationService
    arguments:
      - '@entity_type.manager'
      - '@logger.factory'

  # =====================================================================
  # F10d: ComercioAnalyticsService — KPIs del marketplace
  # =====================================================================
  jaraba_comercio_conecta.comercio_analytics:
    class: Drupal\jaraba_comercio_conecta\Service\ComercioAnalyticsService
    arguments:
      - '@entity_type.manager'
      - '@database'
      - '@logger.factory'

  # =====================================================================
  # F10d: MerchantAnalyticsService — Analytics por comerciante
  # =====================================================================
  jaraba_comercio_conecta.merchant_analytics:
    class: Drupal\jaraba_comercio_conecta\Service\MerchantAnalyticsService
    arguments:
      - '@entity_type.manager'
      - '@database'
      - '@logger.factory'

  jaraba_comercio_conecta.copilot_bridge:
    class: Drupal\jaraba_comercio_conecta\Service\ComercioConectaCopilotBridgeService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@logger.channel.jaraba_comercio_conecta'

  # FIX-017: Service layer for MerchantCopilotAgent API.
  jaraba_comercio_conecta.merchant_copilot:
    class: Drupal\jaraba_comercio_conecta\Service\MerchantCopilotService
    arguments:
      - '@entity_type.manager'
      - '@logger.channel.jaraba_comercio_conecta'
      - '@?jaraba_ai_agents.merchant_copilot_agent'

  # =====================================================================
  # Breadcrumb builder for ComercioConecta routes
  # Priority 100 ensures it takes precedence over default breadcrumb builders
  # =====================================================================
  jaraba_comercio_conecta.breadcrumb:
    class: Drupal\jaraba_comercio_conecta\Breadcrumb\ComercioConectaBreadcrumbBuilder
    arguments:
      - '@current_route_match'
    tags:
      - { name: breadcrumb_builder, priority: 100 }
