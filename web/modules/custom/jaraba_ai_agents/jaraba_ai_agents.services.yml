services:
  # Logger channel
  logger.channel.jaraba_ai_agents:
    parent: logger.channel_base
    arguments: ['jaraba_ai_agents']

  # Servicio de Brand Voice por tenant
  jaraba_ai_agents.tenant_brand_voice:
    class: Drupal\jaraba_ai_agents\Service\TenantBrandVoiceService
    arguments:
      - '@config.factory'
      - '@group.membership_loader'
      - '@current_user'

  # Model Router - Routing inteligente por complejidad
  jaraba_ai_agents.model_router:
    class: Drupal\jaraba_ai_agents\Service\ModelRouterService
    arguments:
      - '@ai.provider'
      - '@config.factory'
      - '@logger.channel.jaraba_ai_agents'

  # AI Observability - Tracking y métricas
  jaraba_ai_agents.observability:
    class: Drupal\jaraba_ai_agents\Service\AIObservabilityService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@logger.channel.jaraba_ai_agents'

  # Workflow Executor - Ejecución de flujos
  jaraba_ai_agents.workflow_executor:
    class: Drupal\jaraba_ai_agents\Service\WorkflowExecutorService
    arguments:
      - '@entity_type.manager'
      - '@jaraba_ai_agents.orchestrator'
      - '@jaraba_ai_agents.observability'
      - '@logger.channel.jaraba_ai_agents'
      - '@jaraba_ai_agents.tool_registry'
      - '@jaraba_ai_agents.pending_approval'

  # Quality Evaluator - LLM-as-Judge
  jaraba_ai_agents.quality_evaluator:
    class: Drupal\jaraba_ai_agents\Service\QualityEvaluatorService
    arguments:
      - '@ai.provider'
      - '@config.factory'
      - '@jaraba_ai_agents.observability'
      - '@logger.channel.jaraba_ai_agents'

  # Orquestador de agentes
  jaraba_ai_agents.orchestrator:
    class: Drupal\jaraba_ai_agents\Service\AgentOrchestrator
    arguments:
      - '@ai.provider'
      - '@config.factory'
      - '@logger.channel.jaraba_ai_agents'
      - '@jaraba_ai_agents.tenant_brand_voice'
      - '@entity_type.manager'

  # Marketing Agent
  jaraba_ai_agents.marketing_agent:
    class: Drupal\jaraba_ai_agents\Agent\MarketingAgent
    arguments:
      - '@ai.provider'
      - '@config.factory'
      - '@logger.channel.jaraba_ai_agents'
      - '@jaraba_ai_agents.tenant_brand_voice'
      - '@jaraba_ai_agents.observability'
      - '@ecosistema_jaraba_core.unified_prompt_builder'

  # Smart Marketing Agent (con Model Routing)
  jaraba_ai_agents.smart_marketing_agent:
    class: Drupal\jaraba_ai_agents\Agent\SmartMarketingAgent
    arguments:
      - '@ai.provider'
      - '@config.factory'
      - '@logger.channel.jaraba_ai_agents'
      - '@jaraba_ai_agents.tenant_brand_voice'
      - '@jaraba_ai_agents.observability'
      - '@jaraba_ai_agents.model_router'
      - '@ecosistema_jaraba_core.unified_prompt_builder'

  # Storytelling Agent
  jaraba_ai_agents.storytelling_agent:
    class: Drupal\jaraba_ai_agents\Agent\StorytellingAgent
    arguments:
      - '@ai.provider'
      - '@config.factory'
      - '@logger.channel.jaraba_ai_agents'
      - '@jaraba_ai_agents.tenant_brand_voice'
      - '@jaraba_ai_agents.observability'
      - '@ecosistema_jaraba_core.unified_prompt_builder'

  # Customer Experience Agent
  jaraba_ai_agents.customer_experience_agent:
    class: Drupal\jaraba_ai_agents\Agent\CustomerExperienceAgent
    arguments:
      - '@ai.provider'
      - '@config.factory'
      - '@logger.channel.jaraba_ai_agents'
      - '@jaraba_ai_agents.tenant_brand_voice'
      - '@jaraba_ai_agents.observability'
      - '@ecosistema_jaraba_core.unified_prompt_builder'

  # Support Agent
  jaraba_ai_agents.support_agent:
    class: Drupal\jaraba_ai_agents\Agent\SupportAgent
    arguments:
      - '@ai.provider'
      - '@config.factory'
      - '@logger.channel.jaraba_ai_agents'
      - '@jaraba_ai_agents.tenant_brand_voice'
      - '@jaraba_ai_agents.observability'
      - '@ecosistema_jaraba_core.unified_prompt_builder'

  # Producer Copilot Agent (AgroConecta - con Model Routing)
  jaraba_ai_agents.producer_copilot_agent:
    class: Drupal\jaraba_ai_agents\Agent\ProducerCopilotAgent
    arguments:
      - '@ai.provider'
      - '@config.factory'
      - '@logger.channel.jaraba_ai_agents'
      - '@jaraba_ai_agents.tenant_brand_voice'
      - '@jaraba_ai_agents.observability'
      - '@jaraba_ai_agents.model_router'
      - '@ecosistema_jaraba_core.unified_prompt_builder'


  # ========================================
  # Tool Registry - Herramientas Agentic
  # ========================================

  # Registro central de herramientas
  jaraba_ai_agents.tool_registry:
    class: Drupal\jaraba_ai_agents\Tool\ToolRegistry
    arguments:
      - '@logger.channel.jaraba_ai_agents'

  # SendEmailTool - Envío de emails
  jaraba_ai_agents.tool.send_email:
    class: Drupal\jaraba_ai_agents\Tool\SendEmailTool
    arguments:
      - '@logger.channel.jaraba_ai_agents'
      - '@plugin.manager.mail'
    tags:
      - { name: jaraba_ai_agents.tool }

  # CreateEntityTool - Creación de entidades
  jaraba_ai_agents.tool.create_entity:
    class: Drupal\jaraba_ai_agents\Tool\CreateEntityTool
    arguments:
      - '@logger.channel.jaraba_ai_agents'
      - '@entity_type.manager'
    tags:
      - { name: jaraba_ai_agents.tool }

  # SearchKnowledgeTool - Búsqueda RAG
  jaraba_ai_agents.tool.search_knowledge:
    class: Drupal\jaraba_ai_agents\Tool\SearchKnowledgeTool
    arguments:
      - '@logger.channel.jaraba_ai_agents'
      - '@jaraba_tenant_knowledge.indexer'
    tags:
      - { name: jaraba_ai_agents.tool }

  # PendingApprovalService - Cola de aprobaciones
  jaraba_ai_agents.pending_approval:
    class: Drupal\jaraba_ai_agents\Service\PendingApprovalService
    arguments:
      - '@entity_type.manager'
      - '@jaraba_ai_agents.tool_registry'
      - '@current_user'
      - '@logger.channel.jaraba_ai_agents'

