{#
 # Template: ServiciosConecta - Perfil Destacado del Profesional
 # Category: serviciosconecta
 # Type: provider_spotlight
 #
 # Featured provider profile con credenciales, rating y servicios
 # Premium: animations, jaraba_icon system, Schema.org ProfessionalService + AggregateRating
 # - Usa jaraba_icon(category, name, { variant, size, color }) para iconos
 #}
<section class="pb-section pb-section--provider-spotlight pb-section--serviciosconecta jaraba-block jaraba-block--premium jaraba-block--serviciosconecta-provider-spotlight"
         aria-label="{{ title|default('Profesional Destacado')|t }}"
         data-effect="fade-up"
         {% if background_image %}style="background-image: url('{{ background_image }}')"{% endif %}>

  {# Schema.org JSON-LD: ProfessionalService with AggregateRating #}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ProfessionalService",
    "name": "{{ provider_name|default('Profesional Destacado')|e('js') }}",
    "description": "{{ provider_title|default('')|e('js') }}",
    {% if provider_image|default('') %}
    "image": "{{ provider_image|e('js') }}",
    {% endif %}
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "{{ rating|default('4.9')|e('js') }}",
      "reviewCount": "{{ review_count|default('0')|e('js') }}",
      "bestRating": "5"
    },
    "url": "{{ cta_url|default('#')|e('js') }}"
  }
  </script>

  <div class="pb-section__container">
    <div class="pb-section__header">
      <span class="pb-section__eyebrow">{{ eyebrow|default('Profesional Destacado')|t }}</span>
      <h2 class="pb-section__title">{{ title|default('Conoce a nuestro experto destacado')|t }}</h2>
      <p class="pb-section__subtitle">{{ subtitle|default('Profesionales verificados con trayectoria demostrada.')|t }}</p>
    </div>

    <div class="pb-section__spotlight-layout">
      {# Provider photo and identity #}
      <div class="pb-section__spotlight-profile" data-effect="fade-up" data-delay="100">
        <div class="pb-section__spotlight-avatar">
          {% if provider_image|default('') %}
            <img src="{{ provider_image }}" alt="{{ provider_name|default('')|striptags }}" loading="lazy" />
          {% else %}
            <div class="pb-section__spotlight-avatar-placeholder" aria-hidden="true">
              {{ jaraba_icon('user', 'users', { variant: 'duotone', size: '64px', color: 'primary' }) }}
            </div>
          {% endif %}
        </div>
        <h3 class="pb-section__spotlight-name">{{ provider_name|default('Nombre del Profesional')|t }}</h3>
        <p class="pb-section__spotlight-title">{{ provider_title|default('Especialista Profesional')|t }}</p>

        {# Rating #}
        <div class="pb-section__spotlight-rating" aria-label="{% trans %}Valoración{% endtrans %}: {{ rating|default('4.9') }} {% trans %}de 5{% endtrans %}">
          <div class="pb-section__spotlight-stars">
            {% for i in 1..5 %}
              <span class="pb-section__spotlight-star{{ i <= (rating|default('4.9')|round) ? ' pb-section__spotlight-star--filled' : '' }}" aria-hidden="true">
                {{ jaraba_icon('ui', 'star', { variant: 'duotone', size: '20px', color: i <= (rating|default('4.9')|round) ? 'warning' : 'muted' }) }}
              </span>
            {% endfor %}
          </div>
          <span class="pb-section__spotlight-rating-value">{{ rating|default('4.9') }}</span>
          <span class="pb-section__spotlight-review-count">({{ review_count|default('0') }} {% trans %}valoraciones{% endtrans %})</span>
        </div>

        {# Experience badge #}
        {% if years_experience|default('') %}
          <div class="pb-section__spotlight-experience">
            {{ jaraba_icon('business', 'achievement', { variant: 'duotone', size: '18px', color: 'primary' }) }}
            <span>{{ years_experience }} {% trans %}años de experiencia{% endtrans %}</span>
          </div>
        {% endif %}
      </div>

      {# Details panel #}
      <div class="pb-section__spotlight-details">
        {# Bio #}
        {% if provider_bio|default('') %}
          <div class="pb-section__spotlight-bio" data-effect="fade-up" data-delay="200">
            <h4>{% trans %}Sobre el profesional{% endtrans %}</h4>
            <div>{{ provider_bio|safe_html }}</div>
          </div>
        {% endif %}

        {# Credentials #}
        {% set default_credentials = [
          { label: 'Colegiado activo' },
          { label: 'Certificación ISO 27001' },
          { label: 'Master en Dirección Financiera' },
          { label: 'Miembro EFPA España' }
        ] %}
        {% set cred_items = credentials|default(default_credentials) %}
        <div class="pb-section__spotlight-credentials" data-effect="fade-up" data-delay="300">
          <h4>{% trans %}Credenciales{% endtrans %}</h4>
          <ul class="pb-section__spotlight-credentials-list">
            {% for credential in cred_items %}
              <li>
                <span aria-hidden="true">{{ jaraba_icon('actions', 'check', { variant: 'duotone', size: '16px', color: 'success' }) }}</span>
                {{ credential.label|default('Credencial')|t }}
              </li>
            {% endfor %}
          </ul>
        </div>

        {# Services offered #}
        {% set default_services = [
          { name: 'Consultoría financiera' },
          { name: 'Planificación fiscal' },
          { name: 'Auditoría interna' },
          { name: 'Asesoría de inversiones' }
        ] %}
        {% set service_items = services_offered|default(default_services) %}
        <div class="pb-section__spotlight-services" data-effect="fade-up" data-delay="400">
          <h4>{% trans %}Servicios ofrecidos{% endtrans %}</h4>
          <div class="pb-section__spotlight-services-tags">
            {% for service in service_items %}
              <span class="pb-section__spotlight-service-tag">{{ service.name|default('Servicio')|t }}</span>
            {% endfor %}
          </div>
        </div>

        {# CTA #}
        <div class="pb-section__actions" data-effect="fade-up" data-delay="500">
          <a href="{{ cta_url|default('#') }}" class="pb-section__cta pb-section__cta--primary">
            {{ cta_text|default('Solicitar consulta')|t }}
          </a>
        </div>
      </div>
    </div>
  </div>
</section>
