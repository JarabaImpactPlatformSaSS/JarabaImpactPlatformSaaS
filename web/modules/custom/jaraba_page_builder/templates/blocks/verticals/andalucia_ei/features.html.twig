{#
 # Template: Andalucia +ei - Pilares del Programa
 # Category: andalucia_ei
 # Type: features
 #
 # Header centrado + grid de 3 feature cards (icono + titulo + descripcion)
 # Premium: staggered animations, jaraba_icon system, configurable columns
 # - Icon resolved from icon_category/icon fields OR icon_map fallback
 # - Usa jaraba_icon(category, name, { variant, size, color }) para iconos
 #}
<section class="pb-section pb-section--features pb-section--andalucia_ei jaraba-block jaraba-block--premium"
         data-block-type="andalucia_ei_features"
         aria-label="{{ title|default('Pilares del Programa')|t }}"
         data-effect="fade-up"
         {% if background_image %}style="background-image: url('{{ background_image }}')"{% endif %}>
  <div class="pb-section__container">
    <div class="pb-section__header">
      <span class="pb-section__eyebrow">{{ eyebrow|default('Qué ofrecemos')|t }}</span>
      <h2 class="pb-section__title">{{ title|default('Un programa diseñado para transformar tu futuro profesional')|t }}</h2>
      <p class="pb-section__subtitle">{{ subtitle|default('Tres ejes fundamentales que combinan tecnología, formación y oportunidades reales.')|t }}</p>
    </div>
    <div class="pb-section__features-grid pb-section__features-grid--{{ columns|default(3) }}-cols">
      {% set default_features = [
        { icon: 'copilot', icon_category: 'ai', title: 'Mentoría IA', desc: 'Acompañamiento personalizado con inteligencia artificial que analiza tu perfil, identifica oportunidades y genera planes de acción adaptados a tu sector.' },
        { icon: 'graduation-cap', icon_category: 'education', title: 'Formación Certificada', desc: 'Módulos formativos avalados por la Junta de Andalucía en competencias digitales, emprendimiento y herramientas de IA aplicadas al negocio.' },
        { icon: 'briefcase', icon_category: 'business', title: 'Inserción Laboral', desc: 'Red de empresas colaboradoras y bolsa de empleo exclusiva con más de 200 ofertas activas en sectores estratégicos de Andalucía.' }
      ] %}
      {% set items = features|default(default_features) %}
      {# Fallback icon map for legacy icon keys #}
      {% set legacy_icon_map = {
        'ai-brain': { category: 'ai', name: 'brain' },
        'graduation': { category: 'education', name: 'graduation-cap' }
      } %}
      {% for feature in items %}
        <div class="pb-section__feature-card"
             data-effect="fade-up"
             data-delay="{{ loop.index0 * 120 }}">
          <div class="pb-section__feature-icon" aria-hidden="true">
            {# Resolve icon: prefer icon_category/icon from config, then legacy map, then default #}
            {% if feature.icon_category|default('') and feature.icon|default('') %}
              {{ jaraba_icon(feature.icon_category, feature.icon, { variant: 'duotone', size: '32px', color: 'impulse' }) }}
            {% elseif legacy_icon_map[feature.icon|default('')]|default(false) %}
              {% set ic = legacy_icon_map[feature.icon] %}
              {{ jaraba_icon(ic.category, ic.name, { variant: 'duotone', size: '32px', color: 'impulse' }) }}
            {% else %}
              {{ jaraba_icon('ui', 'rocket', { variant: 'duotone', size: '32px', color: 'impulse' }) }}
            {% endif %}
          </div>
          <h3 class="pb-section__feature-title">{{ feature.title|default('Característica')|t }}</h3>
          <p class="pb-section__feature-desc">{{ feature.desc|default('Descripción de la característica.')|t }}</p>
        </div>
      {% endfor %}
    </div>
  </div>
</section>
