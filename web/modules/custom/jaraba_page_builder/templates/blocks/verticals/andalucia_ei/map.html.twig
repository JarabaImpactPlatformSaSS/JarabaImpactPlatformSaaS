{#
 # Template: Andalucia +ei - Cobertura Provincial y Contacto
 # Category: andalucia_ei
 # Type: map
 #
 # Grid 2 cols: mapa placeholder con provincias + info de contacto lateral
 # Premium: animations, jaraba_icon system, province list
 # - Accepts provinces as strings or objects {name, address, active}
 # - Accepts contact_phone/contact_email/contact_whatsapp AND phone/email/whatsapp
 # - Usa jaraba_icon(category, name, { variant, size, color }) para iconos
 #}
<section class="pb-section pb-section--map pb-section--andalucia_ei jaraba-block jaraba-block--premium"
         data-block-type="andalucia_ei_map"
         aria-label="{{ title|default('Cobertura y Contacto')|t }}"
         data-effect="fade-up">
  <div class="pb-section__container">
    <div class="pb-section__map-embed">
      {% if map_embed|default('') %}
        {{ map_embed|striptags('<iframe>')|raw }}
      {% else %}
        <div class="pb-section__map-placeholder" aria-label="{{ 'Mapa de Andalucía'|t }}">
          <div class="pb-section__map-placeholder-icon" aria-hidden="true">
            {{ jaraba_icon('ui', 'map-pin', { variant: 'duotone', size: '48px', color: 'impulse' }) }}
          </div>
          <span>{{ 'Mapa de Andalucía — Cobertura en las 8 provincias'|t }}</span>
        </div>
      {% endif %}

      <div class="pb-section__provinces">
        <h3 class="pb-section__provinces-title">{{ provinces_title|default('Provincias participantes')|t }}</h3>
        {% set default_provinces = [
          { name: 'Almería' }, { name: 'Cádiz' }, { name: 'Córdoba' }, { name: 'Granada' },
          { name: 'Huelva' }, { name: 'Jaén' }, { name: 'Málaga' }, { name: 'Sevilla' }
        ] %}
        {% set province_items = provinces|default(default_provinces) %}
        <ul class="pb-section__provinces-list">
          {% for province in province_items %}
            <li class="pb-section__province"
                data-effect="fade-up"
                data-delay="{{ loop.index0 * 50 }}">
              <span class="pb-section__province-icon" aria-hidden="true">
                {{ jaraba_icon('ui', 'map-pin', { variant: 'duotone', size: '16px', color: 'impulse' }) }}
              </span>
              {# Support both string provinces and object provinces {name, address} #}
              {% if province.name is defined %}
                <span>{{ province.name|t }}</span>
              {% else %}
                <span>{{ province|t }}</span>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="pb-section__contact-info">
      <h2 class="pb-section__title">{{ title|default('Presente en las 8 provincias andaluzas')|t }}</h2>
      <p class="pb-section__subtitle">{{ subtitle|default('Formación presencial y online en toda la comunidad autónoma.')|t }}</p>

      {# Accept both contact_phone and phone #}
      {% set phone_val = contact_phone|default(phone|default('+34 955 000 123')) %}
      <div class="pb-section__contact-item" data-effect="fade-up" data-delay="100">
        <div class="pb-section__contact-icon" aria-hidden="true">
          {{ jaraba_icon('ui', 'phone', { variant: 'duotone', size: '24px', color: 'impulse' }) }}
        </div>
        <div>
          <div class="pb-section__contact-label">{{ 'Teléfono'|t }}</div>
          <div class="pb-section__contact-value">
            <a href="tel:{{ phone_val }}">{{ phone_val }}</a>
          </div>
        </div>
      </div>

      {% set email_val = contact_email|default(email|default('info@andalucia-ei.es')) %}
      <div class="pb-section__contact-item" data-effect="fade-up" data-delay="200">
        <div class="pb-section__contact-icon" aria-hidden="true">
          {{ jaraba_icon('ui', 'mail', { variant: 'duotone', size: '24px', color: 'impulse' }) }}
        </div>
        <div>
          <div class="pb-section__contact-label">{{ 'Email'|t }}</div>
          <div class="pb-section__contact-value">
            <a href="mailto:{{ email_val }}">{{ email_val }}</a>
          </div>
        </div>
      </div>

      {% set wa_val = contact_whatsapp|default(whatsapp|default('+34 600 123 456')) %}
      <div class="pb-section__contact-item" data-effect="fade-up" data-delay="300">
        <div class="pb-section__contact-icon" aria-hidden="true">
          {{ jaraba_icon('ui', 'chat', { variant: 'duotone', size: '24px', color: 'impulse' }) }}
        </div>
        <div>
          <div class="pb-section__contact-label">{{ 'WhatsApp'|t }}</div>
          <div class="pb-section__contact-value">
            <a href="https://wa.me/{{ wa_val|replace({'+': '', ' ': ''}) }}" target="_blank" rel="noopener noreferrer">{{ wa_val }}</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
