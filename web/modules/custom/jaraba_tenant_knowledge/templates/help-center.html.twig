{#
/**
 * @file
 * help-center.html.twig — Landing del Centro de Ayuda público.
 *
 * PROPÓSITO: Página pública /ayuda con barra de búsqueda, categorías
 * de FAQs, artículos populares, quick links, CTA y trust signals.
 *
 * Variables:
 * - categories: Array de categorías con keys: key, label, icon, count, faqs[].
 * - top_faqs: Array de las 6 FAQs más populares.
 * - total_articles: Total de artículos publicados.
 * - quick_links: Array de enlaces rápidos (label, url, icon, description).
 * - contact_channels: Array de canales de contacto (label, url, type).
 * - kb_articles_count: Número de artículos en Knowledge Base.
 * - kb_url: URL de la Knowledge Base (vía Url::fromRoute).
 * - has_content: Boolean — si hay FAQs disponibles.
 * - faq_bot_tenant_id: ID del tenant para el bot.
 * - faq_bot_tenant_name: Nombre del negocio.
 * - faq_bot_suggestions: Sugerencias iniciales del bot.
 */
#}

<div class="help-center">
  {# Hero con barra de búsqueda y trust signals #}
  <section class="help-center__hero">
    <div class="help-center__hero-content">
      <h1 class="help-center__title">{% trans %}Centro de Ayuda{% endtrans %}</h1>
      <p class="help-center__subtitle">
        {% trans %}¿En qué podemos ayudarte? Busca entre nuestros artículos o explora las categorías.{% endtrans %}
      </p>

      <form class="help-center__search-form" action="{{ path('jaraba_tenant_knowledge.help.search') }}" method="get">
        <div class="help-center__search-wrapper">
          <svg class="help-center__search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
          <input
            type="search"
            name="q"
            class="help-center__search-input"
            placeholder="{{ 'Buscar artículos de ayuda...'|trans }}"
            autocomplete="off"
            data-help-search
          >
          <button type="submit" class="help-center__search-btn">
            {% trans %}Buscar{% endtrans %}
          </button>
        </div>
        {# Resultados de autocompletado #}
        <div class="help-center__autocomplete" data-help-autocomplete hidden></div>
      </form>

      {# Trust signals — siempre visibles #}
      <div class="help-center__trust-signals">
        <span class="help-center__trust-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          {% trans %}Respuestas instantáneas{% endtrans %}
        </span>
        <span class="help-center__trust-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          {% trans %}Soporte 24/7{% endtrans %}
        </span>
        <span class="help-center__trust-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>
          {% trans %}IA integrada{% endtrans %}
        </span>
      </div>

      {# Contador inteligente — no muestra "0 artículos" #}
      {% if has_content %}
        <p class="help-center__article-count">
          {{ total_articles }} {% trans %}artículos disponibles{% endtrans %}
        </p>
      {% endif %}
    </div>
  </section>

  {# Quick Links — acciones rápidas siempre visibles #}
  {% if quick_links is not empty %}
    <section class="help-center__quick-links" data-animate="fade-in-up">
      <div class="help-center__quick-links-grid">
        {% for link in quick_links %}
          <a href="{{ link.url }}" class="help-quick-link">
            <div class="help-quick-link__icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                {% if link.icon == 'plus-circle' %}
                  <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/>
                {% elseif link.icon == 'mail' %}
                  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/>
                {% elseif link.icon == 'book-open' %}
                  <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                {% elseif link.icon == 'edit-3' %}
                  <path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                {% endif %}
              </svg>
            </div>
            <div class="help-quick-link__text">
              <span class="help-quick-link__label">{{ link.label }}</span>
              <span class="help-quick-link__description">{{ link.description }}</span>
            </div>
          </a>
        {% endfor %}
      </div>
    </section>
  {% endif %}

  {# Grid de categorías #}
  {% if categories is not empty %}
    <section class="help-center__categories" data-animate="fade-in-up">
      <h2 class="help-center__section-title">{% trans %}Explorar por Categoría{% endtrans %}</h2>
      <div class="help-center__categories-grid">
        {% for category in categories %}
          <a href="#category-{{ category.key }}" class="help-category-card" data-category="{{ category.key }}">
            <div class="help-category-card__icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                {% if category.icon == 'play-circle' %}
                  <circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/>
                {% elseif category.icon == 'user' %}
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                {% elseif category.icon == 'zap' %}
                  <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                {% elseif category.icon == 'credit-card' %}
                  <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/>
                {% elseif category.icon == 'cpu' %}
                  <rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/>
                {% elseif category.icon == 'link' %}
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                {% elseif category.icon == 'shield' %}
                  <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                {% elseif category.icon == 'tool' %}
                  <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                {% else %}
                  <circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                {% endif %}
              </svg>
            </div>
            <h3 class="help-category-card__title">{{ category.label }}</h3>
            <span class="help-category-card__count">
              {{ category.count }} {{ category.count == 1 ? 'artículo'|trans : 'artículos'|trans }}
            </span>
          </a>
        {% endfor %}
      </div>
    </section>
  {% endif %}

  {# Artículos populares #}
  {% if top_faqs is not empty %}
    <section class="help-center__popular" data-animate="fade-in-up">
      <h2 class="help-center__section-title">{% trans %}Artículos Populares{% endtrans %}</h2>
      <div class="help-center__popular-grid">
        {% for faq in top_faqs %}
          <a href="{{ path('jaraba_tenant_knowledge.help.article', { faq_id: faq.id }) }}" class="help-article-card">
            <span class="help-article-card__category">{{ faq.category_label }}</span>
            <h3 class="help-article-card__title">{{ faq.question }}</h3>
            <p class="help-article-card__preview">{{ faq.answer_preview }}</p>
            <span class="help-article-card__link">
              {% trans %}Leer más{% endtrans %} →
            </span>
          </a>
        {% endfor %}
      </div>
    </section>
  {% endif %}

  {# Cross-link a Knowledge Base #}
  {% if kb_articles_count > 0 %}
    <section class="help-center__kb-promo" data-animate="fade-in-up">
      <div class="help-center__kb-promo-content">
        <div class="help-center__kb-promo-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
          </svg>
        </div>
        <div class="help-center__kb-promo-text">
          <h3>{% trans %}Base de Conocimiento{% endtrans %}</h3>
          <p>
            {% trans %}Explora guías detalladas y tutoriales paso a paso.{% endtrans %}
            {{ kb_articles_count }} {% trans %}artículos disponibles.{% endtrans %}
          </p>
        </div>
        <a href="{{ kb_url }}" class="help-center__kb-promo-btn">
          {% trans %}Explorar KB{% endtrans %} →
        </a>
      </div>
    </section>
  {% endif %}

  {# Listado de FAQs por categoría (expandible) #}
  {% if categories is not empty %}
    <section class="help-center__faq-list">
      {% for category in categories %}
        <div class="help-faq-section" id="category-{{ category.key }}" data-animate="fade-in-up">
          <h2 class="help-faq-section__title">{{ category.label }}</h2>
          <div class="help-faq-section__items">
            {% for faq in category.faqs %}
              <a href="{{ path('jaraba_tenant_knowledge.help.article', { faq_id: faq.id }) }}" class="help-faq-item">
                <span class="help-faq-item__question">{{ faq.question }}</span>
                <svg class="help-faq-item__arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6"/>
                </svg>
              </a>
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </section>
  {% endif %}

  {# CTA de contacto con botones accionables #}
  <section class="help-center__contact" data-animate="fade-in-up">
    <h2 class="help-center__contact-title">{% trans %}¿No encuentras lo que buscas?{% endtrans %}</h2>
    <p class="help-center__contact-text">
      {% trans %}Nuestro equipo de soporte está disponible para ayudarte.{% endtrans %}
    </p>
    {% if contact_channels is not empty %}
      <div class="help-center__contact-buttons">
        {% for channel in contact_channels %}
          <a href="{{ channel.url }}" class="help-center__contact-btn help-center__contact-btn--{{ channel.type }}">
            {{ channel.label }}
          </a>
        {% endfor %}
      </div>
    {% endif %}
  </section>
</div>

{# FAQ Bot Widget (G114-4) #}
{% include '@jaraba_tenant_knowledge/faq-bot-widget.html.twig' with {
  tenant_id: faq_bot_tenant_id,
  tenant_name: faq_bot_tenant_name,
  suggestions: faq_bot_suggestions,
} only %}
