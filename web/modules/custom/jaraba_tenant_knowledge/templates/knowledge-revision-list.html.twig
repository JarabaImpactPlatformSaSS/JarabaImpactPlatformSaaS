{#
 # Template: Lista de Revisiones de Conocimiento
 #
 # Variables:
 #   - entity: Entidad (TenantFaq o TenantPolicy)
 #   - entity_type: 'tenant_faq' o 'tenant_policy'
 #   - revisions: Array de metadatos [id, created, user, log, is_current]
 #   - back_route: Ruta de vuelta al listado
 #   - compare_route: Ruta para comparar revisiones
 #   - entity_label: Etiqueta legible de la entidad
 #
 # G114-2: Versionado de artículos con diff visual
 # Reutiliza los estilos de _revision-diff.scss del core
 #}

<div class="revision-list knowledge-revision-list" data-entity-id="{{ entity.id() }}" data-entity-type="{{ entity_type }}">

  {# Header #}
  <header class="revision-list__header">
    <div class="revision-list__nav">
      <a href="{{ path(back_route) }}" class="revision-list__back btn btn--outline btn--sm">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        {% trans %}Volver{% endtrans %}
      </a>
    </div>
    <div class="revision-list__title-group">
      <h1 class="revision-list__title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--ej-color-corporate, #233D63)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        {% trans %}Historial de Revisiones{% endtrans %}
      </h1>
      <p class="revision-list__subtitle">{{ entity_label }}</p>
    </div>
  </header>

  {# Instrucciones #}
  <div class="revision-list__instructions">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--ej-color-innovation, #00A9A5)" stroke-width="2">
      <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
    </svg>
    <p>{% trans %}Selecciona dos revisiones para comparar los cambios. La revisión actual está marcada.{% endtrans %}</p>
  </div>

  {# Lista de revisiones #}
  {% if revisions|length > 1 %}
    <form class="revision-list__form" id="knowledge-revision-compare-form" method="get"
          data-compare-route="{{ path(compare_route, (entity_type == 'tenant_faq') ? {tenant_faq: entity.id(), older: '__OLDER__', newer: '__NEWER__'} : {tenant_policy: entity.id(), older: '__OLDER__', newer: '__NEWER__'}) }}">
      <table class="revision-list__table data-table">
        <thead>
          <tr>
            <th class="revision-list__th revision-list__th--check">{% trans %}Antigua{% endtrans %}</th>
            <th class="revision-list__th revision-list__th--check">{% trans %}Nueva{% endtrans %}</th>
            <th class="revision-list__th">{% trans %}Fecha{% endtrans %}</th>
            <th class="revision-list__th">{% trans %}Usuario{% endtrans %}</th>
            <th class="revision-list__th">{% trans %}Mensaje{% endtrans %}</th>
            <th class="revision-list__th">{% trans %}Estado{% endtrans %}</th>
          </tr>
        </thead>
        <tbody>
          {% for revision in revisions %}
            <tr class="revision-list__row{% if revision.is_current %} revision-list__row--current{% endif %}">
              <td class="revision-list__cell revision-list__cell--radio">
                <input type="radio" name="older" value="{{ revision.id }}"
                       id="older-{{ revision.id }}"
                       {% if loop.index == 2 %}checked{% endif %}>
              </td>
              <td class="revision-list__cell revision-list__cell--radio">
                <input type="radio" name="newer" value="{{ revision.id }}"
                       id="newer-{{ revision.id }}"
                       {% if loop.first %}checked{% endif %}>
              </td>
              <td class="revision-list__cell revision-list__cell--date">
                {{ revision.created|date('d/m/Y H:i') }}
              </td>
              <td class="revision-list__cell revision-list__cell--user">
                {{ revision.user }}
              </td>
              <td class="revision-list__cell revision-list__cell--log">
                {% if revision.log %}
                  {{ revision.log|length > 80 ? revision.log|slice(0, 80) ~ '...' : revision.log }}
                {% else %}
                  <span class="text-muted">{% trans %}Sin mensaje{% endtrans %}</span>
                {% endif %}
              </td>
              <td class="revision-list__cell revision-list__cell--status">
                {% if revision.is_current %}
                  <span class="badge badge--success">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                      <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                    {% trans %}Actual{% endtrans %}
                  </span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="revision-list__actions">
        <button type="submit" class="btn btn--primary" id="knowledge-compare-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/>
          </svg>
          {% trans %}Comparar revisiones{% endtrans %}
        </button>
      </div>
    </form>
  {% elseif revisions|length == 1 %}
    <div class="revision-list__empty">
      <div class="empty-state">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--ej-color-neutral-400, #9CA3AF)" stroke-width="1.5">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
        </svg>
        <h3>{% trans %}Sin historial{% endtrans %}</h3>
        <p>{% trans %}Solo existe una revisión. Edita el contenido para crear más versiones.{% endtrans %}</p>
      </div>
    </div>
  {% else %}
    <div class="revision-list__empty">
      <div class="empty-state">
        <h3>{% trans %}No hay revisiones{% endtrans %}</h3>
      </div>
    </div>
  {% endif %}
</div>
