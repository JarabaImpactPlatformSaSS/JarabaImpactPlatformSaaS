<?php

/**
 * @file
 * Módulo Jaraba Ads: Dashboard de publicidad pagada multi-tenant.
 *
 * ESTRUCTURA:
 * Implementa hooks de Drupal para: registro de templates (hook_theme),
 * body classes para páginas de ads (hook_preprocess_html),
 * y texto de ayuda (hook_help).
 *
 * LÓGICA:
 * - hook_theme: Registra la plantilla Twig del dashboard de ads.
 * - hook_preprocess_html: Añade clases CSS al <body> para identificar
 *   páginas de ads y permitir estilos específicos desde SCSS.
 *
 * RELACIONES:
 * - jaraba_ads.module -> templates/ (define templates)
 * - jaraba_ads.module -> AdsDashboardController (templates consumidos por)
 * - jaraba_ads.module <- Drupal core (invocado por)
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function jaraba_ads_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    case 'help.page.jaraba_ads':
      $output = '<h3>' . t('About Jaraba Ads') . '</h3>';
      $output .= '<p>' . t('Provides a multi-tenant paid advertising dashboard for managing campaigns across Google Ads, Meta Ads, LinkedIn Ads, and TikTok Ads with performance metrics and spend analytics.') . '</p>';
      $output .= '<h4>' . t('Features') . '</h4>';
      $output .= '<ul>';
      $output .= '<li>' . t('Campaign management with status workflow (draft, active, paused, completed)') . '</li>';
      $output .= '<li>' . t('Multi-platform support: Google Ads, Meta Ads, LinkedIn Ads, TikTok Ads') . '</li>';
      $output .= '<li>' . t('Budget tracking with daily and total budgets') . '</li>';
      $output .= '<li>' . t('Performance metrics: impressions, clicks, conversions, CTR, CPC, ROAS') . '</li>';
      $output .= '<li>' . t('Spend analytics by platform') . '</li>';
      $output .= '<li>' . t('REST API for programmatic integration') . '</li>';
      $output .= '<li>' . t('Multi-tenant isolation with tenant-scoped metrics') . '</li>';
      $output .= '</ul>';
      return $output;
  }
}

/**
 * Implements hook_theme().
 *
 * Registra las plantillas Twig del módulo de ads.
 * El dashboard muestra métricas consolidadas de campañas publicitarias
 * y distribución de gasto por plataforma.
 */
function jaraba_ads_theme($existing, $type, $theme, $path) {
  return [
    // Dashboard de campañas publicitarias (/admin/ads)
    'jaraba_ads_dashboard' => [
      'variables' => [
        'campaigns' => [],
        'metrics' => [],
        'spend_by_platform' => [],
        'active_campaigns' => 0,
        'total_spend' => 0,
      ],
      'template' => 'ads-dashboard',
      'path' => $path . '/templates',
    ],
  ];
}

/**
 * Implements hook_preprocess_html().
 *
 * LÓGICA:
 * Añade clases CSS al <body> cuando el usuario navega por páginas de ads.
 * Estas clases permiten aplicar estilos específicos desde SCSS sin
 * necesidad de modificar las plantillas del tema. Las clases siguen
 * el patrón page--ads, page--ads-dashboard, etc.
 *
 * Patrón: body classes via hook_preprocess_html() ÚNICAMENTE.
 * NO se usa attributes.addClass() en templates Twig.
 */
function jaraba_ads_preprocess_html(array &$variables): void {
  $route_match = \Drupal::routeMatch();
  $route_name = $route_match->getRouteName();

  if (!$route_name) {
    return;
  }

  // Mapeo de rutas a clases CSS del body.
  $route_classes = [
    'jaraba_ads.dashboard' => ['page--ads', 'page--ads-dashboard'],
  ];

  if (isset($route_classes[$route_name])) {
    foreach ($route_classes[$route_name] as $class) {
      $variables['attributes']['class'][] = $class;
    }
  }
}
