services:
  # Servicio de criptografía Ed25519
  jaraba_credentials.cryptography:
    class: Drupal\jaraba_credentials\Service\CryptographyService
    arguments: ['@logger.factory']

  # Constructor de Open Badge 3.0 JSON-LD
  jaraba_credentials.badge_builder:
    class: Drupal\jaraba_credentials\Service\OpenBadgeBuilder
    arguments: ['@request_stack', '@datetime.time']

  # Orquestador de emisión de credenciales
  # P1-04: Inyeccion de event_dispatcher para despachar CredentialIssuedEvent.
  jaraba_credentials.issuer:
    class: Drupal\jaraba_credentials\Service\CredentialIssuer
    arguments:
      - '@entity_type.manager'
      - '@jaraba_credentials.cryptography'
      - '@jaraba_credentials.badge_builder'
      - '@logger.factory'
      - '@event_dispatcher'

  # Verificador público de credenciales
  jaraba_credentials.verifier:
    class: Drupal\jaraba_credentials\Service\CredentialVerifier
    arguments:
      - '@entity_type.manager'
      - '@jaraba_credentials.cryptography'
      - '@logger.factory'

  # Generador de códigos QR
  jaraba_credentials.qr_generator:
    class: Drupal\jaraba_credentials\Service\QrCodeGenerator
    arguments: ['@request_stack']

  # ==========================================================================
  # INTEGRACIÓN LMS - Sprint E-COMPLETE-2
  # Puente entre jaraba_lms (cursos) y jaraba_credentials (emisión automática)
  # ==========================================================================

  jaraba_credentials.lms_integration:
    class: Drupal\jaraba_credentials\Service\LmsCredentialsIntegration
    arguments:
      - '@entity_type.manager'
      - '@jaraba_credentials.issuer'
      - '@logger.factory'
      - '@queue'

  # Servicio de revocación con audit trail
  jaraba_credentials.revocation:
    class: Drupal\jaraba_credentials\Service\RevocationService
    arguments:
      - '@entity_type.manager'
      - '@logger.factory'

  # Evaluador de stacks de credenciales
  jaraba_credentials.stack_evaluation:
    class: Drupal\jaraba_credentials\Service\StackEvaluationService
    arguments:
      - '@entity_type.manager'
      - '@jaraba_credentials.issuer'
      - '@logger.factory'

  # Tracker de progreso de stacks
  jaraba_credentials.stack_progress:
    class: Drupal\jaraba_credentials\Service\StackProgressTracker
    arguments:
      - '@entity_type.manager'
      - '@logger.factory'

  # Auditoría de accesibilidad WCAG 2.1 AA
  jaraba_credentials.accessibility_audit:
    class: Drupal\jaraba_credentials\Service\AccessibilityAuditService
    arguments:
      - '@entity_type.manager'
      - '@logger.factory'

  # Generador de PDFs para credenciales
  jaraba_credentials.pdf_generator:
    class: Drupal\jaraba_credentials\Service\CredentialPdfService
    arguments:
      - '@file_system'
      - '@entity_type.manager'

  # Logger channel para credentials
  logger.channel.jaraba_credentials:
    parent: logger.channel_base
    arguments: ['jaraba_credentials']

  # ==========================================================================
  # EVENT SUBSCRIBERS — P1-04 Triggers automaticos
  # ==========================================================================

  # Suscriptor reactivo para eventos de emision de credenciales.
  # P1-04: Notificaciones en tiempo real, webhooks y metricas.
  jaraba_credentials.credential_trigger_subscriber:
    class: Drupal\jaraba_credentials\EventSubscriber\CredentialTriggerSubscriber
    arguments:
      - '@entity_type.manager'
      - '@plugin.manager.mail'
      - '@logger.channel.jaraba_credentials'
    tags:
      - { name: event_subscriber }

