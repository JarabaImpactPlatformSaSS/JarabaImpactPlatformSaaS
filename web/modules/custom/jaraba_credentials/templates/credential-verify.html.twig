{#
/**
 * @file
 * Template para página de verificación pública de credencial.
 *
 * Variables disponibles:
 * - credential: IssuedCredential entity o NULL
 * - issuer: IssuerProfile entity o NULL
 * - template: CredentialTemplate entity o NULL
 * - is_valid: boolean
 * - verification_message: string traducido
 * - qr_code: HTML del código QR
 *
 * @ingroup themeable
 */
#}

<div class="credential-verify-page" role="main" aria-label="{% trans %}Verificación de Credencial{% endtrans %}">
  <div class="credential-verify-container">

    {# Estado de verificación #}
    <div class="verification-status {{ is_valid ? 'verification-status--valid' : 'verification-status--invalid' }}"
         role="alert"
         aria-live="polite">
      <div class="verification-status__icon" aria-hidden="true">
        {% if is_valid %}
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="48" height="48" role="img" aria-label="{% trans %}Verificada{% endtrans %}">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
        {% else %}
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="48" height="48" role="img" aria-label="{% trans %}No válida{% endtrans %}">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
          </svg>
        {% endif %}
      </div>
      <p class="verification-status__message">{{ verification_message }}</p>
    </div>

    {% if credential and template %}
      {# Información de la credencial #}
      <div class="credential-card" role="region" aria-label="{% trans %}Detalles de la credencial{% endtrans %}">
        
        {# Badge/Imagen #}
        {% if template.image.entity %}
          <div class="credential-card__image">
            <img src="{{ file_url(template.image.entity.uri.value) }}" 
                 alt="{{ template.name.value }}" 
                 class="credential-badge-image" />
          </div>
        {% endif %}

        {# Contenido #}
        <div class="credential-card__content">
          <h2 class="credential-card__title">{{ template.name.value }}</h2>
          
          
          {% if template.description[0].value is defined %}
            <p class="credential-card__description">{{ template.description[0].value }}</p>
          {% endif %}

          {# Información del receptor #}
          <div class="credential-card__recipient">
            <span class="credential-card__label">{% trans %}Otorgado a{% endtrans %}</span>
            <span class="credential-card__value">{{ credential.recipient_name.value }}</span>
          </div>

          {# Fecha de emisión #}
          <div class="credential-card__date">
            <span class="credential-card__label">{% trans %}Fecha de emisión{% endtrans %}</span>
            <span class="credential-card__value">{{ credential.issued_on.value|date('d/m/Y') }}</span>
          </div>

          {# Fecha de expiración #}
          {% if credential.expires_on.value %}
            <div class="credential-card__expiry">
              <span class="credential-card__label">{% trans %}Válido hasta{% endtrans %}</span>
              <span class="credential-card__value">{{ credential.expires_on.value|date('d/m/Y') }}</span>
            </div>
          {% else %}
            <div class="credential-card__expiry">
              <span class="credential-card__label">{% trans %}Validez{% endtrans %}</span>
              <span class="credential-card__value credential-card__value--permanent">{% trans %}Sin expiración{% endtrans %}</span>
            </div>
          {% endif %}

          {# Estado #}
          <div class="credential-card__status">
            <span class="credential-card__label">{% trans %}Estado{% endtrans %}</span>
            <span class="credential-card__value credential-card__value--status credential-card__value--{{ credential.status.value }}">
              {% if credential.status.value == 'active' %}
                {% trans %}Activa{% endtrans %}
              {% elseif credential.status.value == 'revoked' %}
                {% trans %}Revocada{% endtrans %}
              {% elseif credential.status.value == 'expired' %}
                {% trans %}Expirada{% endtrans %}
              {% elseif credential.status.value == 'suspended' %}
                {% trans %}Suspendida{% endtrans %}
              {% endif %}
            </span>
          </div>
        </div>

        {# Código QR #}
        {% if qr_code %}
          <div class="credential-card__qr" role="img" aria-label="{% trans %}Código QR de verificación{% endtrans %}">
            {{ qr_code|raw }}
            <p class="credential-card__qr-label">{% trans %}Escanea para verificar{% endtrans %}</p>
          </div>
        {% endif %}
      </div>

      {# Información del emisor #}
      {% if issuer %}
        <div class="issuer-info" role="region" aria-label="{% trans %}Información del emisor{% endtrans %}">
          <h3 class="issuer-info__title">{% trans %}Emitido por{% endtrans %}</h3>
          <div class="issuer-info__content">
            {% if issuer.image.entity %}
              <img src="{{ file_url(issuer.image.entity.uri.value) }}" 
                   alt="{{ issuer.name.value }}" 
                   class="issuer-info__logo" />
            {% endif %}
            <div class="issuer-info__details">
              <p class="issuer-info__name">{{ issuer.name.value }}</p>
              {% if issuer.url.value %}
                <a href="{{ issuer.url.value }}" 
                   target="_blank" 
                   rel="noopener noreferrer" 
                   class="issuer-info__url">
                  {{ issuer.url.value }}
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endif %}

      {# Enlace a JSON-LD #}
      <div class="credential-json-link">
        <a href="{{ path('jaraba_credentials.verify_json', {'uuid': credential.uuid.value}) }}" 
           class="credential-json-link__button"
           target="_blank">
          {% trans %}Ver datos Open Badge 3.0 (JSON-LD){% endtrans %}
        </a>
      </div>

    {% else %}
      {# Credencial no encontrada #}
      <div class="credential-not-found">
        <p>{% trans %}No se encontró ninguna credencial con este identificador.{% endtrans %}</p>
        <p>{% trans %}Por favor, verifica que la URL sea correcta o contacta con el emisor.{% endtrans %}</p>
      </div>
    {% endif %}

  </div>
</div>
