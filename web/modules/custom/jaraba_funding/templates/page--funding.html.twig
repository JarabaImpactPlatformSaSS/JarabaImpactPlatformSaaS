{#
 # Pagina zero-region del dashboard de Fondos y Subvenciones.
 #
 # Estructura: Template limpio sin regiones ni bloques de Drupal.
 #   Incluye parciales del tema para header/footer y parciales
 #   propios del modulo para cards de convocatorias y solicitudes.
 #
 # Variables (inyectadas via hook_preprocess_page):
 #   - opportunities: array de datos de convocatorias.
 #   - applications: array de datos de solicitudes.
 #   - stats: estadisticas del dashboard.
 #   - copilot_context: contexto para el copilot IA (nullable).
 #}
{% include '@ecosistema_jaraba_theme/partials/_header.html.twig' %}

<main class="funding-dashboard" role="main">
  <div class="funding-dashboard__container">

    {# Cabecera del dashboard #}
    <header class="funding-dashboard__header">
      <h1 class="funding-dashboard__title">{{ 'Fondos y Subvenciones'|t }}</h1>
      <div class="funding-dashboard__actions">
        <a href="/admin/content/funding-opportunities/add"
           class="use-ajax funding-dashboard__btn funding-dashboard__btn--primary"
           data-dialog-type="modal"
           data-dialog-options='{"width": 800, "title": "{{ 'Crear convocatoria'|t }}"}'>
          {{ 'Nueva convocatoria'|t }}
        </a>
        <a href="/admin/content/funding-applications/add"
           class="use-ajax funding-dashboard__btn funding-dashboard__btn--secondary"
           data-dialog-type="modal"
           data-dialog-options='{"width": 800, "title": "{{ 'Crear solicitud'|t }}"}'>
          {{ 'Nueva solicitud'|t }}
        </a>
      </div>
    </header>

    {# KPIs #}
    {% if stats %}
    <section class="funding-dashboard__stats">
      <div class="funding-stats__grid">
        <div class="funding-stats__card">
          <span class="funding-stats__value">{{ stats.total_applications|default(0) }}</span>
          <span class="funding-stats__label">{{ 'Solicitudes totales'|t }}</span>
        </div>
        <div class="funding-stats__card">
          <span class="funding-stats__value">{{ stats.by_status.approved|default(0) }}</span>
          <span class="funding-stats__label">{{ 'Aprobadas'|t }}</span>
        </div>
        <div class="funding-stats__card">
          <span class="funding-stats__value">{{ stats.by_status.submitted|default(0) }}</span>
          <span class="funding-stats__label">{{ 'Presentadas'|t }}</span>
        </div>
        <div class="funding-stats__card">
          <span class="funding-stats__value">{{ stats.by_status.draft|default(0) }}</span>
          <span class="funding-stats__label">{{ 'En borrador'|t }}</span>
        </div>
      </div>
    </section>
    {% endif %}

    {# Convocatorias activas #}
    <section class="funding-dashboard__opportunities">
      <h2 class="funding-dashboard__section-title">{{ 'Convocatorias abiertas'|t }}</h2>
      {% if opportunities is not empty %}
        <div class="funding-dashboard__grid">
          {% for opportunity in opportunities %}
            {% include '@jaraba_funding/partials/opportunity-card.html.twig' with {
              opportunity: opportunity,
            } only %}
          {% endfor %}
        </div>
      {% else %}
        <p class="funding-dashboard__empty">{{ 'No hay convocatorias abiertas en este momento.'|t }}</p>
      {% endif %}
    </section>

    {# Solicitudes recientes #}
    <section class="funding-dashboard__applications">
      <h2 class="funding-dashboard__section-title">{{ 'Solicitudes recientes'|t }}</h2>
      {% if applications is not empty %}
        <div class="funding-dashboard__list">
          {% for application in applications %}
            {% include '@jaraba_funding/partials/application-status.html.twig' with {
              application: application,
            } only %}
          {% endfor %}
        </div>
      {% else %}
        <p class="funding-dashboard__empty">{{ 'No hay solicitudes registradas.'|t }}</p>
      {% endif %}
    </section>

  </div>
</main>

{% if copilot_context %}
  {% include '@ecosistema_jaraba_theme/partials/_copilot-fab.html.twig' with {
    context: copilot_context,
  } only %}
{% endif %}

{% include '@ecosistema_jaraba_theme/partials/_footer.html.twig' %}
