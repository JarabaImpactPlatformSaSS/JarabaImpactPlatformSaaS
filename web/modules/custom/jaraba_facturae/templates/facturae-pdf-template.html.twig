{#
/**
 * @file
 * PDF representation template for Facturae documents.
 *
 * Used to generate a human-readable PDF from the Facturae data,
 * including signature info and FACe verification QR code.
 *
 * Variables:
 * - document: FacturaeDocument entity.
 * - signature_info: Array with signature data (signer_nif, signing_time).
 * - qr_data_uri: Base64 data URI for QR code image.
 *
 * Spec: Doc 180, Seccion 7.5.
 * Plan: FASE 8, entregable F8-1.
 */
#}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <style>
    body { font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 10pt; color: #333; margin: 20mm; }
    .pdf-header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 2px solid #1a237e; padding-bottom: 12pt; margin-bottom: 16pt; }
    .pdf-header__title { font-size: 18pt; font-weight: 700; color: #1a237e; }
    .pdf-header__subtitle { font-size: 9pt; color: #666; margin-top: 4pt; }
    .pdf-header__number { font-size: 14pt; font-weight: 600; text-align: right; }
    .pdf-section { margin-bottom: 14pt; }
    .pdf-section__title { font-size: 11pt; font-weight: 700; color: #1a237e; border-bottom: 1px solid #ddd; padding-bottom: 4pt; margin-bottom: 8pt; }
    .pdf-grid { display: table; width: 100%; }
    .pdf-grid__row { display: table-row; }
    .pdf-grid__label { display: table-cell; width: 35%; font-weight: 600; padding: 3pt 8pt 3pt 0; font-size: 9pt; color: #555; }
    .pdf-grid__value { display: table-cell; padding: 3pt 0; font-size: 9pt; }
    .pdf-parties { display: flex; gap: 24pt; }
    .pdf-parties__col { flex: 1; }
    .pdf-amounts { border: 1px solid #ddd; border-radius: 4pt; padding: 10pt; background: #fafafa; }
    .pdf-amounts__row { display: flex; justify-content: space-between; padding: 3pt 0; font-size: 9pt; }
    .pdf-amounts__row--total { font-weight: 700; font-size: 12pt; border-top: 2px solid #1a237e; padding-top: 6pt; margin-top: 4pt; color: #1a237e; }
    .pdf-signature { border: 1px solid #c5cae9; border-radius: 4pt; padding: 10pt; background: #e8eaf6; margin-top: 16pt; }
    .pdf-signature__title { font-size: 10pt; font-weight: 700; color: #1a237e; margin-bottom: 6pt; }
    .pdf-footer { margin-top: 20pt; border-top: 1px solid #ddd; padding-top: 8pt; font-size: 8pt; color: #999; text-align: center; }
    .pdf-qr { text-align: center; margin-top: 10pt; }
    .pdf-qr__image { width: 80px; height: 80px; }
    .pdf-qr__label { font-size: 8pt; color: #666; margin-top: 4pt; }
  </style>
</head>
<body>
  {# Header #}
  <div class="pdf-header">
    <div>
      <div class="pdf-header__title">FACTURAE</div>
      <div class="pdf-header__subtitle">{% trans %}Electronic Invoice — Facturae 3.2.2{% endtrans %}</div>
    </div>
    <div class="pdf-header__number">
      {{ document.facturae_number.value }}
    </div>
  </div>

  {# Parties #}
  <div class="pdf-parties">
    <div class="pdf-parties__col">
      <div class="pdf-section">
        <div class="pdf-section__title">{% trans %}Seller{% endtrans %}</div>
        <div class="pdf-grid">
          <div class="pdf-grid__row">
            <span class="pdf-grid__label">{% trans %}NIF{% endtrans %}</span>
            <span class="pdf-grid__value">{{ document.seller_nif.value }}</span>
          </div>
          <div class="pdf-grid__row">
            <span class="pdf-grid__label">{% trans %}Name{% endtrans %}</span>
            <span class="pdf-grid__value">{{ document.seller_name.value }}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="pdf-parties__col">
      <div class="pdf-section">
        <div class="pdf-section__title">{% trans %}Buyer{% endtrans %}</div>
        <div class="pdf-grid">
          <div class="pdf-grid__row">
            <span class="pdf-grid__label">{% trans %}NIF{% endtrans %}</span>
            <span class="pdf-grid__value">{{ document.buyer_nif.value }}</span>
          </div>
          <div class="pdf-grid__row">
            <span class="pdf-grid__label">{% trans %}Name{% endtrans %}</span>
            <span class="pdf-grid__value">{{ document.buyer_name.value }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  {# Invoice details #}
  <div class="pdf-section">
    <div class="pdf-section__title">{% trans %}Invoice Details{% endtrans %}</div>
    <div class="pdf-grid">
      <div class="pdf-grid__row">
        <span class="pdf-grid__label">{% trans %}Invoice Type{% endtrans %}</span>
        <span class="pdf-grid__value">{{ document.invoice_type.value }} ({{ document.invoice_class.value }})</span>
      </div>
      <div class="pdf-grid__row">
        <span class="pdf-grid__label">{% trans %}Issue Date{% endtrans %}</span>
        <span class="pdf-grid__value">{{ document.issue_date.value }}</span>
      </div>
      <div class="pdf-grid__row">
        <span class="pdf-grid__label">{% trans %}Series{% endtrans %}</span>
        <span class="pdf-grid__value">{{ document.facturae_series.value }}</span>
      </div>
    </div>
  </div>

  {# Amounts #}
  <div class="pdf-section">
    <div class="pdf-section__title">{% trans %}Amounts{% endtrans %}</div>
    <div class="pdf-amounts">
      <div class="pdf-amounts__row">
        <span>{% trans %}Gross Amount Before Taxes{% endtrans %}</span>
        <span>{{ document.total_gross_amount.value|default('0.00') }} &euro;</span>
      </div>
      <div class="pdf-amounts__row">
        <span>{% trans %}Tax Outputs (IVA){% endtrans %}</span>
        <span>{{ document.total_tax_outputs.value|default('0.00') }} &euro;</span>
      </div>
      <div class="pdf-amounts__row">
        <span>{% trans %}Tax Withheld (IRPF){% endtrans %}</span>
        <span>-{{ document.total_tax_withheld.value|default('0.00') }} &euro;</span>
      </div>
      <div class="pdf-amounts__row pdf-amounts__row--total">
        <span>{% trans %}TOTAL{% endtrans %}</span>
        <span>{{ document.total_invoice_amount.value|default('0.00') }} &euro;</span>
      </div>
    </div>
  </div>

  {# Signature block #}
  {% if signature_info is not empty %}
    <div class="pdf-signature">
      <div class="pdf-signature__title">{% trans %}Digital Signature — XAdES-EPES{% endtrans %}</div>
      <div class="pdf-grid">
        <div class="pdf-grid__row">
          <span class="pdf-grid__label">{% trans %}Signer NIF{% endtrans %}</span>
          <span class="pdf-grid__value">{{ signature_info.signer_nif }}</span>
        </div>
        <div class="pdf-grid__row">
          <span class="pdf-grid__label">{% trans %}Signing Time{% endtrans %}</span>
          <span class="pdf-grid__value">{{ signature_info.signing_time }}</span>
        </div>
        <div class="pdf-grid__row">
          <span class="pdf-grid__label">{% trans %}Status{% endtrans %}</span>
          <span class="pdf-grid__value">{{ signature_info.status }}</span>
        </div>
      </div>
    </div>
  {% endif %}

  {# FACe QR #}
  {% if qr_data_uri is not empty %}
    <div class="pdf-qr">
      <img src="{{ qr_data_uri }}" alt="{% trans %}FACe verification QR{% endtrans %}" class="pdf-qr__image">
      <div class="pdf-qr__label">{% trans %}FACe Registry: {{ document.face_registry_number.value }}{% endtrans %}</div>
    </div>
  {% endif %}

  {# Footer #}
  <div class="pdf-footer">
    {% trans %}Generated by Jaraba Impact Platform — Facturae 3.2.2 compliant{% endtrans %}
    &bull; {{ 'now'|date('d/m/Y H:i') }}
  </div>
</body>
</html>
