# Rutas del módulo Jaraba Analytics.

# Dashboard de Analytics.
jaraba_analytics.dashboard:
  path: '/admin/jaraba/analytics'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\AnalyticsDashboardController::dashboard'
    _title: 'Analytics Dashboard'
  requirements:
    _permission: 'access jaraba analytics'
  options:
    _admin_route: FALSE

# Configuración del módulo.
jaraba_analytics.settings:
  path: '/admin/config/jaraba/analytics'
  defaults:
    _form: '\Drupal\jaraba_analytics\Form\AnalyticsSettingsForm'
    _title: 'Configuración de Analytics'
  requirements:
    _permission: 'administer jaraba analytics'
  options:
    _admin_route: TRUE

# API: Registrar evento.
jaraba_analytics.api.event:
  path: '/api/v1/analytics/event'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\AnalyticsApiController::trackEvent'
  methods: [POST]
  requirements:
    _permission: 'access content'
    _csrf_token: 'TRUE'
  options:
    no_cache: TRUE

# API: Registrar eventos en batch.
jaraba_analytics.api.batch:
  path: '/api/v1/analytics/batch'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\AnalyticsApiController::trackBatch'
  methods: [POST]
  requirements:
    _permission: 'access content'
    _csrf_token: 'TRUE'
  options:
    no_cache: TRUE

# API: Dashboard KPIs.
jaraba_analytics.api.dashboard:
  path: '/api/v1/analytics/dashboard'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\AnalyticsApiController::getDashboard'
  methods: [GET]
  requirements:
    _permission: 'access jaraba analytics'

# API: Visitantes en tiempo real.
jaraba_analytics.api.realtime:
  path: '/api/v1/analytics/realtime'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\AnalyticsApiController::getRealtime'
  methods: [GET]
  requirements:
    _permission: 'access jaraba analytics'

# API: Funnel de conversión.
jaraba_analytics.api.funnel:
  path: '/api/v1/analytics/funnel'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\AnalyticsApiController::getFunnel'
  methods: [GET]
  requirements:
    _permission: 'access jaraba analytics'

# API: Top páginas.
jaraba_analytics.api.top_pages:
  path: '/api/v1/analytics/pages/top'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\AnalyticsApiController::getTopPages'
  methods: [GET]
  requirements:
    _permission: 'access jaraba analytics'

# API: Fuentes de tráfico.
jaraba_analytics.api.traffic_sources:
  path: '/api/v1/analytics/traffic-sources'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\AnalyticsApiController::getTrafficSources'
  methods: [GET]
  requirements:
    _permission: 'access jaraba analytics'

# ==========================================================================
# FUNNEL TRACKING API (G116-2)
# ==========================================================================

# API: Listar funnels.
jaraba_analytics.api.funnels.list:
  path: '/api/v1/analytics/funnels'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\FunnelApiController::list'
  methods: [GET]
  requirements:
    _permission: 'access jaraba analytics'

# API: Crear funnel.
jaraba_analytics.api.funnels.create:
  path: '/api/v1/analytics/funnels'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\FunnelApiController::createFunnel'
  methods: [POST]
  requirements:
    _permission: 'administer jaraba analytics'
    _csrf_token: 'TRUE'
  options:
    no_cache: TRUE

# API: Calcular funnel.
jaraba_analytics.api.funnels.calculate:
  path: '/api/v1/analytics/funnels/{funnel_id}/calculate'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\FunnelApiController::calculate'
  methods: [GET]
  requirements:
    _permission: 'access jaraba analytics'
    funnel_id: \d+

# ==========================================================================
# COHORT ANALYSIS API (G116-1)
# ==========================================================================

# API: Listar cohortes.
jaraba_analytics.api.cohorts.list:
  path: '/api/v1/analytics/cohorts'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\CohortApiController::listCohorts'
  methods: [GET]
  requirements:
    _permission: 'access jaraba analytics'

# API: Crear cohorte.
jaraba_analytics.api.cohorts.create:
  path: '/api/v1/analytics/cohorts'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\CohortApiController::createCohort'
  methods: [POST]
  requirements:
    _permission: 'administer jaraba analytics'
    _csrf_token: 'TRUE'
  options:
    no_cache: TRUE

# API: Curva de retención de cohorte.
jaraba_analytics.api.cohorts.retention:
  path: '/api/v1/analytics/cohorts/{cohort_id}/retention'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\CohortApiController::getRetentionCurve'
  methods: [GET]
  requirements:
    _permission: 'access jaraba analytics'
    cohort_id: \d+

# ==========================================================================
# CONSENT MANAGEMENT API (GDPR/RGPD)
# ==========================================================================

# API: Estado de consentimiento.
jaraba_analytics.api.consent.status:
  path: '/api/v1/consent/status'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\ConsentController::status'
  methods: [GET]
  requirements:
    _access: 'TRUE'
  options:
    no_cache: TRUE

# API: Guardar consentimiento.
jaraba_analytics.api.consent.grant:
  path: '/api/v1/consent/grant'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\ConsentController::grant'
  methods: [POST]
  requirements:
    _access: 'TRUE'
  options:
    no_cache: TRUE

# API: Revocar consentimiento.
jaraba_analytics.api.consent.revoke:
  path: '/api/v1/consent/revoke'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\ConsentController::revoke'
  methods: [POST]
  requirements:
    _access: 'TRUE'
  options:
    no_cache: TRUE

# ==========================================================================
# DATA EXPORT API (G116-5)
# ==========================================================================

# API: Exportar analytics como CSV.
jaraba_analytics.export.csv:
  path: '/api/v1/analytics/export/csv'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\AnalyticsExportController::exportCsv'
  methods: [GET]
  requirements:
    _permission: 'export analytics data'

# API: Exportar analytics como Excel.
jaraba_analytics.export.excel:
  path: '/api/v1/analytics/export/excel'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\AnalyticsExportController::exportExcel'
  methods: [GET]
  requirements:
    _permission: 'export analytics data'

# ==========================================================================
# REPORT BUILDER API (G116-3)
# ==========================================================================

# API: Listar informes personalizados.
jaraba_analytics.api.reports.list:
  path: '/api/v1/analytics/reports'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\ReportApiController::list'
  methods: [GET]
  requirements:
    _permission: 'access jaraba analytics'

# API: Ejecutar informe personalizado.
jaraba_analytics.api.reports.execute:
  path: '/api/v1/analytics/reports/{report_id}/execute'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\ReportApiController::execute'
  methods: [POST]
  requirements:
    _permission: 'administer jaraba analytics'
    _csrf_token: 'TRUE'
    report_id: \d+
  options:
    no_cache: TRUE

# ==========================================================================
# BI DASHBOARD BUILDER (G116-6)
# ==========================================================================

# Dashboard list page.
jaraba_analytics.dashboards.list:
  path: '/analytics/dashboards'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\DashboardBuilderController::listDashboards'
    _title: 'Analytics Dashboards'
  requirements:
    _permission: 'access jaraba analytics'

# View a specific dashboard.
jaraba_analytics.dashboards.view:
  path: '/analytics/dashboards/{dashboardId}'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\DashboardBuilderController::viewDashboard'
    _title: 'View Dashboard'
  requirements:
    _permission: 'access jaraba analytics'
    dashboardId: \d+

# Dashboard builder (edit mode).
jaraba_analytics.dashboards.builder:
  path: '/analytics/dashboards/{dashboardId}/builder'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\DashboardBuilderController::builderPage'
    _title: 'Dashboard Builder'
  requirements:
    _permission: 'manage analytics dashboards'
    dashboardId: \d+

# ==========================================================================
# DASHBOARD WIDGET API (G116-6)
# ==========================================================================

# API: List widgets for a dashboard.
jaraba_analytics.api.widgets.list:
  path: '/api/v1/analytics/dashboards/{dashboardId}/widgets'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\DashboardWidgetApiController::listWidgets'
  methods: [GET]
  requirements:
    _permission: 'access jaraba analytics'
    dashboardId: \d+

# API: Create widget for a dashboard.
jaraba_analytics.api.widgets.create:
  path: '/api/v1/analytics/dashboards/{dashboardId}/widgets'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\DashboardWidgetApiController::createWidget'
  methods: [POST]
  requirements:
    _permission: 'manage analytics dashboards'
    _csrf_token: 'TRUE'
    dashboardId: \d+
  options:
    no_cache: TRUE

# API: Update a widget.
jaraba_analytics.api.widgets.update:
  path: '/api/v1/analytics/widgets/{widgetId}'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\DashboardWidgetApiController::updateWidget'
  methods: [PATCH]
  requirements:
    _permission: 'manage analytics dashboards'
    widgetId: \d+
  options:
    no_cache: TRUE

# API: Delete a widget.
jaraba_analytics.api.widgets.delete:
  path: '/api/v1/analytics/widgets/{widgetId}'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\DashboardWidgetApiController::deleteWidget'
  methods: [DELETE]
  requirements:
    _permission: 'manage analytics dashboards'
    widgetId: \d+
  options:
    no_cache: TRUE

# API: Get widget data.
jaraba_analytics.api.widgets.data:
  path: '/api/v1/analytics/widgets/{widgetId}/data'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\DashboardWidgetApiController::getWidgetData'
  methods: [GET]
  requirements:
    _permission: 'access jaraba analytics'
    widgetId: \d+

# ==========================================================================
# SCHEDULED REPORTS (G116-7)
# ==========================================================================

# Scheduled reports list page.
jaraba_analytics.scheduled_reports.list:
  path: '/analytics/reports'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\ScheduledReportController::listReports'
    _title: 'Scheduled Reports'
  requirements:
    _permission: 'access jaraba analytics'

# API: Preview a scheduled report.
jaraba_analytics.api.scheduled_reports.preview:
  path: '/api/v1/analytics/scheduled-reports/{reportId}/preview'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\ScheduledReportController::previewReport'
  methods: [GET]
  requirements:
    _permission: 'manage scheduled reports'
    reportId: \d+

# ===========================================================================
# F7 — Program Dashboard Elena (Doc 182)
# ===========================================================================

# Dashboard institucional para Elena (entity admin).
jaraba_analytics.programa.dashboard:
  path: '/programa/dashboard'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\ProgramDashboardController::dashboard'
    _title: 'Dashboard de Programa'
  requirements:
    _permission: 'access programa dashboard'

# API: Estado actual del grant.
jaraba_analytics.api.programa.grant_status:
  path: '/api/v1/programa/grant-status'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\ProgramDashboardController::grantStatus'
  methods: [GET]
  requirements:
    _permission: 'access programa dashboard'

# API: Generar informe institucional PDF.
jaraba_analytics.api.programa.reports.generate:
  path: '/api/v1/programa/reports/generate'
  defaults:
    _controller: '\Drupal\jaraba_analytics\Controller\ProgramDashboardController::generateReport'
  methods: [POST]
  requirements:
    _permission: 'generate institutional reports'
    _csrf_token: 'TRUE'

