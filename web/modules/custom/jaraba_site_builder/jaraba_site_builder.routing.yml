# Rutas del módulo Site Builder

# ========================================================================
# Frontend Routes (Tenant Editors - NO admin theme)
# El tenant accede a /site-builder/* con layout limpio sin tema de admin
# ========================================================================

jaraba_site_builder.frontend.dashboard:
  path: '/site-builder'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteTreePageController::dashboardFrontend'
    _title: 'Constructor del Sitio'
  requirements:
    _permission: 'view site structure'
  options:
    _admin_route: FALSE

jaraba_site_builder.frontend.tree:
  path: '/site-builder/tree'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteTreePageController::treeFrontend'
    _title: 'Árbol de Páginas'
  requirements:
    _permission: 'view site structure'
  options:
    _admin_route: FALSE

jaraba_site_builder.frontend.config:
  path: '/site-builder/config'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteTreePageController::configFrontend'
    _title: 'Configuración del Sitio'
  requirements:
    _permission: 'view site config'
  options:
    _admin_route: FALSE

jaraba_site_builder.frontend.redirects:
  path: '/site-builder/redirects'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteTreePageController::redirectsFrontend'
    _title: 'Redirects'
  requirements:
    _permission: 'manage site redirects'
  options:
    _admin_route: FALSE

jaraba_site_builder.frontend.sitemap:
  path: '/site-builder/sitemap'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteTreePageController::sitemapFrontend'
    _title: 'Sitemap'
  requirements:
    _permission: 'view site structure'
  options:
    _admin_route: FALSE

# ========================================================================
# Admin Routes (Super Admins only - kept for backward compatibility)
# ========================================================================

# Página principal del Site Builder
jaraba_site_builder.dashboard:
  path: '/admin/structure/site-builder'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteTreePageController::dashboard'
    _title: 'Estructura del Sitio'
  requirements:
    _permission: 'view site structure'
  options:
    _admin_route: FALSE


# Tab: Árbol de páginas
jaraba_site_builder.tree:
  path: '/admin/structure/site-builder/tree'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteTreePageController::tree'
    _title: 'Árbol de Páginas'
  requirements:
    _permission: 'view site structure'
  options:
    _admin_route: FALSE

# Tab: Configuración
jaraba_site_builder.settings:
  path: '/admin/structure/site-builder/config'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteTreePageController::siteConfig'
    _title: 'Configuración del Sitio'
  requirements:
    _permission: 'view site config'
  options:
    _admin_route: FALSE

# Tab: Redirects
jaraba_site_builder.redirects:
  path: '/admin/structure/site-builder/redirects'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteTreePageController::redirects'
    _title: 'Redirects'
  requirements:
    _permission: 'manage site redirects'
  options:
    _admin_route: FALSE

# Formulario para añadir redirect
jaraba_site_builder.redirect_add:
  path: '/admin/structure/site-builder/redirects/add'
  defaults:
    _entity_form: 'site_redirect.add'
    _title: 'Añadir Redirect'
  requirements:
    _permission: 'manage site redirects'
  options:
    _admin_route: FALSE

# Editar redirect
jaraba_site_builder.redirect_edit:
  path: '/admin/structure/site-builder/redirects/{site_redirect}/edit'
  defaults:
    _entity_form: 'site_redirect.edit'
    _title: 'Editar Redirect'
  requirements:
    _permission: 'manage site redirects'
  options:
    _admin_route: FALSE
    parameters:
      site_redirect:
        type: entity:site_redirect

# Import/Export de redirects
jaraba_site_builder.api.redirects_import:
  path: '/api/v1/site/redirects/bulk-import'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::bulkImportRedirects'
  methods: [POST]
  requirements:
    _permission: 'manage site redirects'

jaraba_site_builder.api.redirects_export:
  path: '/api/v1/site/redirects/export'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::exportRedirects'
  methods: [GET]
  requirements:
    _permission: 'manage site redirects'

# Tab: Sitemap visual
jaraba_site_builder.sitemap:
  path: '/admin/structure/site-builder/sitemap'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteTreePageController::sitemap'
    _title: 'Sitemap'
  requirements:
    _permission: 'view site structure'
  options:
    _admin_route: FALSE

# Sitemap XML público
jaraba_site_builder.sitemap_xml:
  path: '/sitemap.xml'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SitemapController::xml'
  requirements:
    _access: 'TRUE'

# --- APIs REST ---

# Obtener árbol de páginas
jaraba_site_builder.api.tree:
  path: '/api/v1/site/tree'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::getTree'
  methods: [GET]
  requirements:
    _permission: 'view site structure'

# Sprint B1: Estadísticas del dashboard
jaraba_site_builder.api.stats:
  path: '/api/v1/site/stats'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::getStats'
  methods: [GET]
  requirements:
    _permission: 'view site structure'

# Sprint B2: Auditoría SEO por página
jaraba_site_builder.api.seo_audit:
  path: '/api/v1/site/pages/{id}/seo-audit'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::seoAudit'
  methods: [GET]
  requirements:
    _permission: 'view site structure'
    id: '\d+'

# Reordenar árbol (drag & drop)
jaraba_site_builder.api.tree_reorder:
  path: '/api/v1/site/tree/reorder'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::reorderTree'
  methods: [POST]
  requirements:
    _permission: 'administer site structure'

# Añadir página al árbol
jaraba_site_builder.api.pages_add:
  path: '/api/v1/site/pages'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::addPage'
  methods: [POST]
  requirements:
    _permission: 'administer site structure'

# Obtener páginas disponibles del Page Builder
jaraba_site_builder.api.pages_available:
  path: '/api/v1/site/pages/available'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::getAvailablePages'
  methods: [GET]
  requirements:
    _permission: 'administer site structure'

# Actualizar configuración de página
jaraba_site_builder.api.pages_update:
  path: '/api/v1/site/pages/{id}'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::updatePage'
  methods: [PATCH]
  requirements:
    _permission: 'administer site structure'
    id: '\d+'

# Eliminar página del árbol
jaraba_site_builder.api.pages_delete:
  path: '/api/v1/site/pages/{id}'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::deletePage'
  methods: [DELETE]
  requirements:
    _permission: 'administer site structure'
    id: '\d+'

# Mover página a otro padre
jaraba_site_builder.api.pages_move:
  path: '/api/v1/site/pages/{id}/move'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::movePage'
  methods: [POST]
  requirements:
    _permission: 'administer site structure'
    id: '\d+'

# Formulario de edición de nodo del árbol via AJAX (slide-panel)
jaraba_site_builder.tree_node_edit_ajax:
  path: '/admin/structure/site-builder/tree/{id}/edit-ajax'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::editNodeAjax'
    _title: 'Editar nodo del árbol'
  requirements:
    _permission: 'administer site structure'
    id: '\d+'

# Operaciones bulk en el árbol
jaraba_site_builder.api.pages_bulk_status:
  path: '/api/v1/site/pages/bulk-status'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteStructureApiController::bulkUpdateStatus'
  methods: [POST]
  requirements:
    _permission: 'administer site structure'

# Obtener configuración global
jaraba_site_builder.api.config:
  path: '/api/v1/site/config'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteConfigApiController::getConfig'
  methods: [GET]
  requirements:
    _permission: 'view site config'

# Actualizar configuración global
jaraba_site_builder.api.config_update:
  path: '/api/v1/site/config'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteConfigApiController::updateConfig'
  methods: [PUT]
  requirements:
    _permission: 'edit site config'

# Subir logo
jaraba_site_builder.api.config_logo:
  path: '/api/v1/site/config/logo'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteConfigApiController::uploadLogo'
  methods: [POST]
  requirements:
    _permission: 'edit site config'

# ========================================================================
# Canvas v2: Variantes Header/Footer
# ========================================================================

# Cambiar variante de header
jaraba_site_builder.api.header_variant:
  path: '/api/v1/site-config/header-variant'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteConfigApiController::updateHeaderVariant'
  methods: [POST]
  requirements:
    _permission: 'edit site config'

# Cambiar variante de footer
jaraba_site_builder.api.footer_variant:
  path: '/api/v1/site-config/footer-variant'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\SiteConfigApiController::updateFooterVariant'
  methods: [POST]
  requirements:
    _permission: 'edit site config'

# ========================================================================
# Fase 1 Doc 177: Sistema de Navegación Global - API REST
# ========================================================================

# --- Header API ---

jaraba_site_builder.api.header_get:
  path: '/api/v1/site/header'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::getHeader'
  methods: [GET]
  requirements:
    _user_is_logged_in: 'TRUE'

jaraba_site_builder.api.header_update:
  path: '/api/v1/site/header'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::updateHeader'
  methods: [PUT]
  requirements:
    _permission: 'edit site config'

jaraba_site_builder.api.header_logo_upload:
  path: '/api/v1/site/header/logo'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::uploadHeaderLogo'
  methods: [POST]
  requirements:
    _permission: 'edit site config'

jaraba_site_builder.api.header_logo_delete:
  path: '/api/v1/site/header/logo'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::deleteHeaderLogo'
  methods: [DELETE]
  requirements:
    _permission: 'edit site config'

# --- Footer API ---

jaraba_site_builder.api.footer_get:
  path: '/api/v1/site/footer'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::getFooter'
  methods: [GET]
  requirements:
    _user_is_logged_in: 'TRUE'

jaraba_site_builder.api.footer_update:
  path: '/api/v1/site/footer'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::updateFooter'
  methods: [PUT]
  requirements:
    _permission: 'edit site config'

jaraba_site_builder.api.footer_logo_upload:
  path: '/api/v1/site/footer/logo'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::uploadFooterLogo'
  methods: [POST]
  requirements:
    _permission: 'edit site config'

# --- Menus API ---

jaraba_site_builder.api.menus_list:
  path: '/api/v1/site/menus'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::listMenus'
  methods: [GET]
  requirements:
    _user_is_logged_in: 'TRUE'

jaraba_site_builder.api.menus_create:
  path: '/api/v1/site/menus'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::createMenu'
  methods: [POST]
  requirements:
    _permission: 'administer site structure'

jaraba_site_builder.api.menus_get:
  path: '/api/v1/site/menus/{id}'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::getMenu'
  methods: [GET]
  requirements:
    _user_is_logged_in: 'TRUE'
    id: '\d+'

jaraba_site_builder.api.menus_delete:
  path: '/api/v1/site/menus/{id}'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::deleteMenu'
  methods: [DELETE]
  requirements:
    _permission: 'administer site structure'
    id: '\d+'

jaraba_site_builder.api.menus_tree:
  path: '/api/v1/site/menus/{id}/tree'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::getMenuTree'
  methods: [GET]
  requirements:
    _user_is_logged_in: 'TRUE'
    id: '\d+'

jaraba_site_builder.api.menus_add_item:
  path: '/api/v1/site/menus/{id}/items'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::addMenuItem'
  methods: [POST]
  requirements:
    _permission: 'administer site structure'
    id: '\d+'

jaraba_site_builder.api.menus_update_item:
  path: '/api/v1/site/menus/{id}/items/{itemId}'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::updateMenuItem'
  methods: [PATCH]
  requirements:
    _permission: 'administer site structure'
    id: '\d+'
    itemId: '\d+'

jaraba_site_builder.api.menus_delete_item:
  path: '/api/v1/site/menus/{id}/items/{itemId}'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::deleteMenuItem'
  methods: [DELETE]
  requirements:
    _permission: 'administer site structure'
    id: '\d+'
    itemId: '\d+'

jaraba_site_builder.api.menus_reorder:
  path: '/api/v1/site/menus/{id}/reorder'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::reorderMenuItems'
  methods: [POST]
  requirements:
    _permission: 'administer site structure'
    id: '\d+'

# --- Breadcrumbs API ---

jaraba_site_builder.api.breadcrumbs:
  path: '/api/v1/site/breadcrumbs/{pageTreeId}'
  defaults:
    _controller: '\Drupal\jaraba_site_builder\Controller\NavigationApiController::getBreadcrumbs'
  methods: [GET]
  requirements:
    _user_is_logged_in: 'TRUE'
    pageTreeId: '\d+'
