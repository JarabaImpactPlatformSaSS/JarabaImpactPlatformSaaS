services:
  # =====================================================================
  # Canal de log dedicado para ServiciosConecta
  # Permite filtrar mensajes del vertical en los logs de Drupal
  # =====================================================================
  logger.channel.jaraba_servicios_conecta:
    parent: logger.channel_base
    arguments: ['jaraba_servicios_conecta']

  # =====================================================================
  # ProviderService: Lógica del profesional y marketplace público
  # Responsabilidad: listado de profesionales, búsqueda, filtros, perfiles
  # Relaciones: consume ProviderProfile, ServiceOffering, taxonomías
  # =====================================================================
  jaraba_servicios_conecta.provider:
    class: Drupal\jaraba_servicios_conecta\Service\ProviderService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@database'
      - '@logger.channel.jaraba_servicios_conecta'

  # =====================================================================
  # ServiceOfferingService: CRUD y lógica de servicios ofertados
  # Responsabilidad: crear, actualizar, publicar/despublicar servicios,
  #   gestión de paquetes y tarifas
  # Relaciones: consume ProviderProfile, ServicePackage
  # =====================================================================
  jaraba_servicios_conecta.service_offering:
    class: Drupal\jaraba_servicios_conecta\Service\ServiceOfferingService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@logger.channel.jaraba_servicios_conecta'

  # =====================================================================
  # AvailabilityService: Gestión de disponibilidad y slots
  # Responsabilidad: calcular slots disponibles, detectar colisiones,
  #   sincronización con calendarios externos (Fase 4)
  # Relaciones: consume AvailabilitySlot, AvailabilityException, Booking
  # =====================================================================
  jaraba_servicios_conecta.availability:
    class: Drupal\jaraba_servicios_conecta\Service\AvailabilityService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@datetime.time'
      - '@logger.channel.jaraba_servicios_conecta'

  # =====================================================================
  # ReviewService: Lógica de reseñas de profesionales
  # Responsabilidad: envío, moderación, consulta de reseñas y recálculo
  #   de ratings desnormalizados en ProviderProfile
  # Relaciones: consume ReviewServicios, Booking, ProviderProfile
  # =====================================================================
  # =====================================================================
  # Breadcrumb builder: contextual breadcrumbs for ServiciosConecta routes
  # =====================================================================
  jaraba_servicios_conecta.breadcrumb:
    class: Drupal\jaraba_servicios_conecta\Breadcrumb\ServiciosConectaBreadcrumbBuilder
    arguments:
      - '@current_route_match'
    tags:
      - { name: breadcrumb_builder, priority: 100 }

  jaraba_servicios_conecta.review:
    class: Drupal\jaraba_servicios_conecta\Service\ReviewService
    arguments:
      - '@entity_type.manager'
      - '@current_user'
      - '@logger.channel.jaraba_servicios_conecta'


  # =====================================================================
  # ServiceQuoteService: Puente entre ServiceOffering y Quote entity
  # Responsabilidad: generar presupuestos con estimacion IA opcional
  # Relaciones: consume Quote (jaraba_legal_billing), ServiceOffering
  # =====================================================================
  jaraba_servicios_conecta.service_quote:
    class: Drupal\jaraba_servicios_conecta\Service\ServiceQuoteService
    arguments:
      - '@entity_type.manager'
      - '@?jaraba_legal_billing.quote_estimator'
      - '@current_user'
      - '@logger.channel.jaraba_servicios_conecta'

  # =====================================================================
  # BookingContractService: Generacion de contratos PDF y registro firma
  # Responsabilidad: crear PDF de contrato, registrar documento_firma
  # Relaciones: consume FirmaDigitalService (ecosistema_jaraba_core)
  # =====================================================================
  jaraba_servicios_conecta.booking_contract:
    class: Drupal\jaraba_servicios_conecta\Service\BookingContractService
    arguments:
      - '@entity_type.manager'
      - '@?ecosistema_jaraba_core.firma_digital'
      - '@current_user'
      - '@logger.channel.jaraba_servicios_conecta'

  # FIX-046 + GAP-AUD-022: Service Matching — Hybrid scoring with AI re-ranking
  jaraba_servicios_conecta.service_matching:
    class: Drupal\jaraba_servicios_conecta\Service\ServiceMatchingService
    arguments:
      - '@entity_type.manager'
      - '@logger.channel.jaraba_servicios_conecta'
      - '@?jaraba_rag.embedding_service'
      - '@?jaraba_rag.qdrant_client'
      - '@?jaraba_servicios_conecta.availability'
      - '@?jaraba_ai_agents.smart_marketing_agent'
