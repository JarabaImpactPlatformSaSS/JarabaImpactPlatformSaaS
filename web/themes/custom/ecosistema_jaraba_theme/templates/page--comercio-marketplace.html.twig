{#
/**
 * @file
 * Page template limpio para rutas de ComercioConecta (marketplace, merchant, producto).
 *
 * Zero Region Policy — this template NEVER renders page.* regions directly.
 * Content is provided via clean_content (sanitised main content) and
 * clean_messages (system status messages) which are injected by the
 * preprocess layer, preventing Drupal block regions from leaking markup.
 *
 * Aplicado a:
 * - /comercio-local (Listado marketplace público)
 * - /comercio-local/{slug} (Página de comercio)
 * - /comercio-local/producto/{id} (Detalle de producto)
 * - /mi-comercio (Dashboard del comerciante)
 * - /mi-comercio/productos (Listado productos comerciante)
 * - /mi-comercio/analiticas (Analytics comerciante)
 *
 * Variables inyectadas desde hook_preprocess_page__comercio_marketplace():
 * - clean_content: Render array del controlador (system_main)
 * - clean_messages: Render array de mensajes del sistema
 * - copilot_context: Contexto del CopilotContextService
 * - theme_settings: Configuración del tema
 * - site_name, site_slogan, logo, footer_copyright
 * - avatar_nav: Navegación contextual por rol/avatar
 *
 * DIRECTRICES:
 * - Nuclear #14: Frontend Limpio (Zero Region Policy)
 * - Nuclear #11: Full-width layout
 * - P4-AI-001: Copilot FAB en toda ruta autenticada del vertical
 * - Directriz ZERO-REGION-001: No usar page.content
 * - SIN regiones sidebar (sidebar_first, sidebar_second)
 * - Layout full-width para marketplace y dashboards
 * - Mantiene header/footer via parciales
 * - Color primario: Naranja impulso (#FF8C42)
 */
#}
{% set site_name = site_name|default('Jaraba Impact Platform') %}
{% set site_slogan = site_slogan|default('Impulsando el talento y la innovación') %}

{{ attach_library('ecosistema_jaraba_theme/scroll-animations') }}

<div class="page-wrapper page-wrapper--clean page-wrapper--premium page-wrapper--comercio">

  {# =============================================
     HEADER - Incluido desde parcial reutilizable
     ============================================= #}
  {% include '@ecosistema_jaraba_theme/partials/_header.html.twig' with {
    'site_name': site_name,
    'site_slogan': site_slogan,
    'logo': logo,
    'logged_in': logged_in,
    'theme_settings': theme_settings|default({}),
    'avatar_nav': avatar_nav|default(null)
  } only %}

  {# =============================================
     CONTENIDO PRINCIPAL - Full Width
     ============================================= #}
  <main class="main-content main-content--full main-content--comercio" role="main">
    {# Mensajes del sistema (Zero Region Policy — clean_messages) #}
    {% if clean_messages %}
      <div class="highlighted container">
        {{ clean_messages }}
      </div>
    {% endif %}

    {# Contenido - Sin sidebars, full-width (Zero Region Policy — clean_content) #}
    <div class="main-content__inner main-content__inner--full">
      {% if clean_content %}
        {{ clean_content }}
      {% endif %}
    </div>
  </main>

  {# =============================================
     FOOTER - Incluido desde parcial reutilizable
     ============================================= #}
  {% include '@ecosistema_jaraba_theme/partials/_footer.html.twig' with {
    'site_name': site_name,
    'logo': logo,
    'footer_copyright': footer_copyright,
    'theme_settings': theme_settings|default({})
  } only %}

  {# =============================================
     COPILOT FAB - Asistente IA contextual
     Directriz P4-AI-001: Disponible en todas las
     rutas autenticadas del vertical ComercioConecta.
     ============================================= #}
  {% if logged_in %}
    {% include '@ecosistema_jaraba_theme/partials/_copilot-fab.html.twig' with {
      'context': copilot_context|default({})
    } only %}
  {% endif %}

</div>
