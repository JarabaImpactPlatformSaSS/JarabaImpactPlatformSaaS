{#
/**
 * @file
 * templates/partials/_copilot-fab.html.twig
 *
 * Partial reutilizable para el Copilot FAB (Floating Action Button).
 * Siguiendo Standard 5: Iconography Industrial Standard (sin emojis).
 * 
 * IMPORTANTE: Este partial recibe contexto del CopilotContextService
 * via hook_preprocess_page() para detectar automÃ¡ticamente:
 * - Avatar del usuario (por roles o ruta)
 * - Tenant, vertical, plan asociados
 * - Nombre del usuario para personalizaciÃ³n
 * 
 * Variables (desde copilot_context):
 * - context.avatar: Tipo de avatar detectado (jobseeker, recruiter, entrepreneur, etc.)
 * - context.user_name: Nombre del usuario para personalizar greeting
 * - context.vertical: Vertical del tenant
 * - context.plan: Plan contratado
 * - context.is_authenticated: Si estÃ¡ logado
 *
 * @see ecosistema_jaraba_core/src/Service/CopilotContextService.php
 * @see ecosistema_jaraba_core/scss/_contextual-copilot.scss
 */
#}
{% set avatar_type = context.avatar|default('general') %}
{% set user_name = context.user_name|default('') %}
{% set is_authenticated = context.is_authenticated|default(false) %}
{% set agent_context = 'copilot_' ~ avatar_type %}

{# Greeting dinÃ¡mico segÃºn contexto #}
{% set greeting_name = user_name ? ('Â¡Hola, ' ~ user_name ~ '!') : 'Â¡Hola! ðŸ‘‹' %}

{% set greetings = {
  'jobseeker': greeting_name ~ ' Soy tu asesor de carrera. Puedo ayudarte a mejorar tu CV, preparar entrevistas o encontrar oportunidades. Â¿QuÃ© necesitas?',
  'recruiter': greeting_name ~ ' Soy tu copiloto de selecciÃ³n. Puedo ayudarte a encontrar talento, analizar CVs o crear ofertas atractivas. Â¿CÃ³mo puedo ayudarte?',
  'entrepreneur': greeting_name ~ ' Soy tu copiloto de emprendimiento. Puedo guiarte con tu Canvas, validar hipÃ³tesis o diseÃ±ar experimentos. Â¿Por dÃ³nde empezamos?',
  'producer': greeting_name ~ ' Soy tu asistente de negocio. Puedo ayudarte a optimizar tu tienda, gestionar productos o aumentar ventas. Â¿QuÃ© necesitas?',
  'mentor': greeting_name ~ ' Soy tu asistente de mentorÃ­a. Puedo ayudarte a gestionar tus sesiones o preparar contenido. Â¿En quÃ© te ayudo?',
  'admin': greeting_name ~ ' Soy tu copiloto administrativo. Puedo ayudarte con mÃ©tricas, configuraciÃ³n o usuarios. Â¿QuÃ© necesitas revisar?',
  'general': greeting_name ~ ' Soy tu asesor de Jaraba. Puedo mostrarte demos, ayudarte a explorar la plataforma o resolver dudas. Â¿QuÃ© te trae por aquÃ­?',
} %}

{% set greeting = greetings[avatar_type]|default(greetings.general)|t %}

{# Attach the existing library that has the CSS #}
{{ attach_library('ecosistema_jaraba_core/contextual-copilot') }}

<div class="contextual-copilot" 
     data-agent="{{ agent_context }}" 
     data-avatar="{{ avatar_type }}"
     data-authenticated="{{ is_authenticated ? 'true' : 'false' }}">
  
  {# Main FAB Button #}
  <button class="copilot-fab" 
          aria-label="{{ 'Abrir asistente'|t }}"
          aria-expanded="false">
    <span class="fab-icon">
      {# Icono de burbuja de chat con puntos de IA #}
      <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M21 12 C21 16.4 16.9 20 12 20 C10.2 20 8.5 19.5 7 18.6 L3 20 L4.4 16.6 C3.5 15.3 3 13.7 3 12 C3 7.6 7.1 4 12 4 C16.9 4 21 7.6 21 12 Z"/>
        <circle cx="8" cy="11" r="1" fill="currentColor"/>
        <circle cx="12" cy="11" r="1" fill="currentColor"/>
        <circle cx="16" cy="11" r="1" fill="currentColor"/>
      </svg>
    </span>
    <span class="fab-pulse"></span>
  </button>

  {# Copilot Panel #}
  <div class="copilot-panel" aria-hidden="true">
    <header class="copilot-header">
      <div class="copilot-avatar">
        {# Icono de burbuja de chat con puntos de IA #}
        <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M21 12 C21 16.4 16.9 20 12 20 C10.2 20 8.5 19.5 7 18.6 L3 20 L4.4 16.6 C3.5 15.3 3 13.7 3 12 C3 7.6 7.1 4 12 4 C16.9 4 21 7.6 21 12 Z"/>
          <circle cx="8" cy="11" r="1" fill="currentColor"/>
          <circle cx="12" cy="11" r="1" fill="currentColor"/>
          <circle cx="16" cy="11" r="1" fill="currentColor"/>
        </svg>
      </div>
      <div class="copilot-info">
        <h3 class="copilot-name">{{ 'Asistente Jaraba'|t }}</h3>
        <span class="copilot-status">
          <span class="status-dot"></span>
          {{ 'Disponible 24/7'|t }}
        </span>
      </div>
      <button class="copilot-close" aria-label="{{ 'Cerrar'|t }}">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </header>

    <div class="copilot-body">
      <div class="copilot-greeting">
        <p>{{ greeting }}</p>
      </div>

      {# Quick Actions Grid - Premium Sales Oriented #}
      <div class="copilot-actions">
        <p class="actions-label">{{ 'Â¿CÃ³mo puedo ayudarte hoy?'|t }}</p>
        <div class="actions-grid">
          <button class="action-btn" data-action="demo_empleo" data-vertical="empleabilidad">
            <span class="action-icon">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2" fill="currentColor"/>
              </svg>
            </span>
            <span class="action-label">{{ 'Ver demo: Buscar empleo'|t }}</span>
          </button>
          <button class="action-btn" data-action="demo_emprendimiento" data-vertical="emprendimiento">
            <span class="action-icon">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/>
                <path d="M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22 22 0 0 1-4 2z"/>
              </svg>
            </span>
            <span class="action-label">{{ 'Ver demo: Validar idea'|t }}</span>
          </button>
          <button class="action-btn action-btn--highlight" data-action="register" data-vertical="registro">
            <span class="action-icon">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/>
                <line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/>
              </svg>
            </span>
            <span class="action-label">{{ 'Crear cuenta gratis'|t }}</span>
          </button>
          <button class="action-btn" data-action="demo_commerce" data-vertical="comercio">
            <span class="action-icon">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
              </svg>
            </span>
            <span class="action-label">{{ 'Ver demo: Mi tienda'|t }}</span>
          </button>
          <button class="action-btn action-btn--b2b" data-action="demo_b2b" data-vertical="b2b">
            <span class="action-icon">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 21h18"/><path d="M5 21V7l7-4 7 4v14"/><path d="M9 21v-6h6v6"/>
                <rect x="9" y="9" width="2" height="2"/><rect x="13" y="9" width="2" height="2"/>
              </svg>
            </span>
            <span class="action-label">{{ 'Soy organizaciÃ³n'|t }}</span>
          </button>
        </div>
      </div>

      {# Chat area for responses #}
      <div class="copilot-chat" aria-live="polite">
        <div class="chat-messages"></div>
      </div>
    </div>

    <div class="copilot-footer">
      <div class="copilot-input-container">
        <input type="text" 
               class="copilot-input" 
               placeholder="{{ 'Escribe tu consulta...'|t }}"
               aria-label="{{ 'Mensaje al asistente'|t }}">
        <button class="copilot-send" aria-label="{{ 'Enviar'|t }}">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>
