{#
 # Individual Review Card.
 #
 # Variables:
 # - review: {
 #     id, author_name, author_avatar_url, rating, title, body,
 #     created, verified_purchase, helpful_count, photos, response
 #   }
 #
 # REV-PHASE5: Tarjeta de resena individual.
 #}
<article class="review-card" data-review-id="{{ review.id }}">
  <header class="review-card__header">
    <div class="review-card__author">
      {% if review.author_avatar_url %}
        <img class="review-card__avatar" src="{{ review.author_avatar_url }}" alt="{{ review.author_name }}" loading="lazy" width="40" height="40">
      {% else %}
        <span class="review-card__avatar review-card__avatar--placeholder" aria-hidden="true">
          {{ review.author_name|first|upper }}
        </span>
      {% endif %}
      <div>
        <span class="review-card__author-name">{{ review.author_name }}</span>
        <time class="review-card__date" datetime="{{ review.created }}">{{ review.created|date('d/m/Y') }}</time>
      </div>
    </div>
    {% if review.verified_purchase %}
      <span class="review-card__badge review-card__badge--verified">
        {{ 'Compra verificada'|t }}
      </span>
    {% endif %}
  </header>

  {% if review.rating > 0 %}
    {% include '@ecosistema_jaraba_theme/partials/_star-rating-display.html.twig' with {
      rating: review.rating,
      size: 'sm',
      show_count: false
    } only %}
  {% endif %}

  {% if review.title %}
    <h4 class="review-card__title">{{ review.title }}</h4>
  {% endif %}

  {% if review.body %}
    <div class="review-card__body">{{ review.body }}</div>
  {% endif %}

  {% if review.photos is not empty %}
    <div class="review-card__photos">
      {% for photo in review.photos %}
        <img class="review-card__photo" src="{{ photo }}" alt="{{ 'Foto de la resena'|t }}" loading="lazy" width="120" height="120">
      {% endfor %}
    </div>
  {% endif %}

  <footer class="review-card__footer">
    <button type="button" class="review-card__helpful js-review-helpful" data-review-id="{{ review.id }}">
      <span aria-hidden="true">üëç</span>
      {{ 'Util'|t }} ({{ review.helpful_count|default(0) }})
    </button>
  </footer>

  {% if review.response %}
    <div class="review-card__response">
      <div class="review-card__response-header">
        <strong>{{ review.response.by }}</strong>
        <time datetime="{{ review.response.date }}">{{ review.response.date|date('d/m/Y') }}</time>
      </div>
      <p class="review-card__response-body">{{ review.response.body }}</p>
    </div>
  {% endif %}
</article>
