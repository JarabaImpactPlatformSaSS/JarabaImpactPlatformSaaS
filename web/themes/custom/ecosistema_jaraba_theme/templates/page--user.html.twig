{#
/**
 * @file
 * page--user.html.twig
 *
 * Template LIMPIO para paginas del sistema de usuario autenticado.
 * Aplica a: /user/{uid}, /user/{uid}/edit, /user/logout/confirm,
 *           /user/{uid}/contact, /user/{uid}/cancel/confirm
 *
 * Patron: Frontend Page Pattern (Zero Region Policy)
 * Usa header global con avatar_nav + contenido limpio + footer.
 *
 * Variables inyectadas desde hook_preprocess_page__user():
 * - user_content: Render array del formulario/vista de usuario
 * - user_page_type: 'profile', 'edit', 'logout', 'contact', 'cancel', 'generic'
 * - user_display_name: Nombre del usuario
 * - clean_content: Contenido del controlador (fallback)
 * - clean_messages: Mensajes del sistema
 * - avatar_nav: Navegacion contextual por avatar
 */
#}
{% set site_name = site_name|default('Jaraba Impact Platform') %}

{{ attach_library('ecosistema_jaraba_theme/global') }}

<!DOCTYPE html>
<html{{ html_attributes }}>
<head>
  <head-placeholder token="{{ placeholder_token }}">
  <title>{{ head_title|safe_join(' | ') }}</title>
  <css-placeholder token="{{ placeholder_token }}">
  <js-placeholder token="{{ placeholder_token }}">
</head>

<body{{ attributes.addClass('user-page', 'page-user', 'full-width-layout') }}>
  <a href="#main-content" class="visually-hidden focusable skip-link">
    {% trans %}Ir al contenido principal{% endtrans %}
  </a>

  {% include '@ecosistema_jaraba_theme/partials/_header.html.twig' with {
    site_name: site_name,
    logo: logo|default(''),
    logged_in: logged_in,
    theme_settings: theme_settings|default({}),
    avatar_nav: avatar_nav|default(null),
  } only %}

  <main id="main-content" class="user-main">
    {# Mensajes del sistema (status, warning, error) #}
    {% if clean_messages %}
      <div class="highlighted container">
        {{ clean_messages }}
      </div>
    {% endif %}

    <div class="user-wrapper">
      {# Cabecera de seccion con icono contextual #}
      <div class="user-section-header">
        <div class="user-section-header__icon" aria-hidden="true">
          {% if user_page_type == 'profile' %}
            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="24" cy="24" r="22" fill="var(--ej-color-secondary, #00A9A5)" opacity="0.1"/>
              <circle cx="24" cy="18" r="7" fill="var(--ej-color-secondary, #00A9A5)" opacity="0.3"/>
              <path d="M10 42c0-8 6-14 14-14s14 6 14 14" stroke="var(--ej-color-secondary, #00A9A5)" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
          {% elseif user_page_type == 'edit' %}
            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="24" cy="24" r="22" fill="var(--ej-color-primary, #FF8C42)" opacity="0.1"/>
              <path d="M28 8l8 8-16 16H12v-8l16-16z" fill="var(--ej-color-corporate, #233D63)" opacity="0.3"/>
              <path d="M28 8l8 8M12 32l24-24" stroke="var(--ej-color-primary, #FF8C42)" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
          {% elseif user_page_type == 'logout' %}
            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="24" cy="24" r="22" fill="var(--ej-color-danger, #EF4444)" opacity="0.1"/>
              <rect x="8" y="8" width="20" height="32" rx="3" fill="var(--ej-color-corporate, #233D63)" opacity="0.3"/>
              <path d="M32 18l6 6-6 6" stroke="var(--ej-color-danger, #EF4444)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M38 24H22" stroke="var(--ej-color-danger, #EF4444)" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
          {% else %}
            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="24" cy="24" r="22" fill="var(--ej-color-corporate, #233D63)" opacity="0.1"/>
              <circle cx="24" cy="18" r="7" fill="var(--ej-color-corporate, #233D63)" opacity="0.3"/>
              <path d="M10 42c0-8 6-14 14-14s14 6 14 14" stroke="var(--ej-color-corporate, #233D63)" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
          {% endif %}
        </div>

        <div class="user-section-header__text">
          <h1 class="user-section-header__title">
            {% if user_page_type == 'profile' %}
              {{ user_display_name|default('Usuario') }}
            {% elseif user_page_type == 'edit' %}
              {% trans %}Editar perfil{% endtrans %}
            {% elseif user_page_type == 'logout' %}
              {% trans %}Cerrar sesion{% endtrans %}
            {% elseif user_page_type == 'contact' %}
              {% trans %}Contactar usuario{% endtrans %}
            {% elseif user_page_type == 'cancel' %}
              {% trans %}Cancelar cuenta{% endtrans %}
            {% else %}
              {% trans %}Mi cuenta{% endtrans %}
            {% endif %}
          </h1>
          <p class="user-section-header__subtitle">
            {% if user_page_type == 'profile' %}
              {% trans %}Panel de usuario{% endtrans %}
            {% elseif user_page_type == 'edit' %}
              {% trans %}Actualiza tu informacion{% endtrans %}
            {% elseif user_page_type == 'logout' %}
              {% trans %}Estas seguro de que deseas salir?{% endtrans %}
            {% elseif user_page_type == 'contact' %}
              {% trans %}Envia un mensaje{% endtrans %}
            {% elseif user_page_type == 'cancel' %}
              {% trans %}Esta accion no se puede deshacer{% endtrans %}
            {% endif %}
          </p>
        </div>
      </div>

      {# Contenido LIMPIO - Solo la vista/formulario del usuario #}
      <div class="user-content-area">
        {{ user_content }}
      </div>

      {# Enlaces de navegacion secundaria #}
      <div class="user-nav-links">
        {% if user_page_type == 'profile' and user is defined and user.id is defined %}
          <a href="{{ path('entity.user.edit_form', {'user': user.id}) }}" class="user-nav-links__item">
            {% trans %}Editar perfil{% endtrans %}
          </a>
          <span class="user-nav-links__separator" aria-hidden="true">·</span>
        {% elseif user_page_type == 'edit' and user is defined and user.id is defined %}
          <a href="{{ path('entity.user.canonical', {'user': user.id}) }}" class="user-nav-links__item">
            {% trans %}Ver perfil{% endtrans %}
          </a>
          <span class="user-nav-links__separator" aria-hidden="true">·</span>
        {% endif %}
        <a href="{{ path('<front>') }}" class="user-nav-links__item">
          {% trans %}Ir al inicio{% endtrans %}
        </a>
      </div>
    </div>
  </main>

  {% include '@ecosistema_jaraba_theme/partials/_footer.html.twig' with {
    site_name: site_name,
    logo: logo|default(''),
    theme_settings: theme_settings|default({}),
  } only %}

  <js-bottom-placeholder token="{{ placeholder_token }}">
</body>
</html>
