# =============================================================================
# Jaraba Impact Platform - Redis Sentinel Configuration
# N3 Enterprise Class - Doc 197 - High Availability Infrastructure
# =============================================================================
# Deploy this identical config to 3 Sentinel instances.  Quorum of 2 means
# any 2 Sentinels must agree before triggering automatic failover.
# =============================================================================

port 26379
daemonize yes
pidfile /var/run/redis-sentinel.pid
logfile /var/log/redis/sentinel.log
dir /tmp

# ---------------------------------------------------------------------------
# Monitor Definition
# "2" = quorum - number of Sentinels that must agree the master is down
# ---------------------------------------------------------------------------
sentinel monitor jaraba-master redis-master.jaraba.io 6379 2
sentinel auth-pass jaraba-master ${REDIS_PASSWORD}

# ---------------------------------------------------------------------------
# Timing
# ---------------------------------------------------------------------------
# Consider master down after 5 s of no response
sentinel down-after-milliseconds jaraba-master 5000

# Allow up to 60 s for the failover process to complete
sentinel failover-timeout jaraba-master 60000

# Only 1 replica syncs from the new master at a time (reduce replication load)
sentinel parallel-syncs jaraba-master 1

# ---------------------------------------------------------------------------
# Security
# ---------------------------------------------------------------------------
sentinel deny-scripts-reconfig yes

# ---------------------------------------------------------------------------
# Notification (optional - integrate with alerting)
# ---------------------------------------------------------------------------
# sentinel notification-script jaraba-master /opt/jaraba/scripts/sentinel-notify.sh
# sentinel client-reconfig-script jaraba-master /opt/jaraba/scripts/sentinel-reconfig.sh
