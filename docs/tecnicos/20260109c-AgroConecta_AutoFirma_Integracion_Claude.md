IntegraciÃ³n con AutoFirma
Firma ElectrÃ³nica con Certificado del Usuario
EspecificaciÃ³n TÃ©cnica para AgroConecta
1. Â¿QuÃ© es AutoFirma?
AutoFirma es una aplicaciÃ³n de escritorio desarrollada por el Gobierno de EspaÃ±a que permite firmar documentos electrÃ³nicamente usando certificados digitales instalados en el navegador (FNMT, DNIe) o en tarjetas criptogrÃ¡ficas.
1.1. Diferencia con Firma en Servidor
Aspecto	Firma en Servidor	AutoFirma (Usuario)
Â¿QuiÃ©n firma?	La plataforma (persona jurÃ­dica)	El usuario individual (productor)
Certificado	Sello de empresa centralizado	DNIe o FNMT del usuario
IntervenciÃ³n	AutomÃ¡tica, sin usuario	Requiere acciÃ³n del usuario
Caso de uso	Certificados de trazabilidad	Contratos, declaraciones
1.2. Casos de Uso en AgroConecta
â€¢	Contrato de alta como productor: El productor firma digitalmente el acuerdo con la plataforma.
â€¢	DeclaraciÃ³n responsable: DeclaraciÃ³n sobre el origen y calidad del producto.
â€¢	Contratos B2B: Acuerdos de suministro con restaurantes o distribuidores.
â€¢	AceptaciÃ³n de tÃ©rminos especiales: Para certificaciones o denominaciones de origen.
2. Arquitectura de la IntegraciÃ³n
2.1. Flujo Completo
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                    FLUJO DE FIRMA CON AUTOFIRMA                                  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                                                                                  â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚   â”‚   NAVEGADOR   â”‚      â”‚   AUTOFIRMA   â”‚      â”‚    DRUPAL     â”‚              â”‚ â”‚   â”‚   (Usuario)   â”‚      â”‚   (Local)     â”‚      â”‚   (Servidor)  â”‚              â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚           â”‚                      â”‚                      â”‚                       â”‚ â”‚           â”‚  1. Usuario pulsa                           â”‚                       â”‚ â”‚           â”‚     "Firmar documento"                      â”‚                       â”‚ â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>                      â”‚ â”‚           â”‚                      â”‚                      â”‚                       â”‚ â”‚           â”‚                      â”‚      2. Drupal genera PDF                    â”‚ â”‚           â”‚                      â”‚         y devuelve datos                     â”‚ â”‚           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚ â”‚           â”‚                      â”‚                      â”‚                       â”‚ â”‚           â”‚  3. JavaScript llama â”‚                      â”‚                       â”‚ â”‚           â”‚     protocolo        â”‚                      â”‚                       â”‚ â”‚           â”‚     afirma://        â”‚                      â”‚                       â”‚ â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                       â”‚ â”‚           â”‚                      â”‚                      â”‚                       â”‚ â”‚           â”‚                      â”‚  4. AutoFirma se abre                        â”‚ â”‚           â”‚                      â”‚     Usuario selecciona                       â”‚ â”‚           â”‚                      â”‚     certificado y firma                      â”‚ â”‚           â”‚                      â”‚                      â”‚                       â”‚ â”‚           â”‚  5. AutoFirma        â”‚                      â”‚                       â”‚ â”‚           â”‚     devuelve PDF     â”‚                      â”‚                       â”‚ â”‚           â”‚     firmado (Base64) â”‚                      â”‚                       â”‚ â”‚           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                       â”‚ â”‚           â”‚                      â”‚                      â”‚                       â”‚ â”‚           â”‚  6. JavaScript envÃ­a                        â”‚                       â”‚ â”‚           â”‚     PDF firmado a                           â”‚                       â”‚ â”‚           â”‚     Drupal                                  â”‚                       â”‚ â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>                      â”‚ â”‚           â”‚                      â”‚                      â”‚                       â”‚ â”‚           â”‚                      â”‚      7. Drupal valida firma,                 â”‚ â”‚           â”‚                      â”‚         guarda documento y                   â”‚ â”‚           â”‚                      â”‚         actualiza estado                     â”‚ â”‚           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚ â”‚           â”‚                      â”‚                      â”‚                       â”‚ â”‚           â”‚  8. ConfirmaciÃ³n     â”‚                      â”‚                       â”‚ â”‚           â”‚     al usuario       â”‚                      â”‚                       â”‚ â”‚           â”‚                      â”‚                      â”‚                       â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚                                                                                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
2.2. Componentes Necesarios
Componente	UbicaciÃ³n	FunciÃ³n
autofirma.js	LibrerÃ­a JS oficial	ComunicaciÃ³n con AutoFirma vÃ­a WebSocket/protocolo afirma://
agroconecta-firma.js	Tema Drupal	Orquesta el flujo: prepara documento, llama AutoFirma, recibe resultado
AutoFirmaController	MÃ³dulo Drupal	Genera PDFs para firma, recibe documentos firmados, valida y almacena
AutoFirma (app)	PC del usuario	AplicaciÃ³n de escritorio que realiza la firma con el certificado
â€ƒ
3. Protocolo de ComunicaciÃ³n con AutoFirma
3.1. MÃ©todos de ComunicaciÃ³n
AutoFirma soporta dos mÃ©todos de comunicaciÃ³n:
MÃ©todo	DescripciÃ³n	CuÃ¡ndo usar
WebSocket	ConexiÃ³n bidireccional con AutoFirma en localhost:puerto	Recomendado. MÃ¡s fiable y permite callbacks.
afirma://	Protocolo URL personalizado que lanza AutoFirma	Fallback si WebSocket falla. Menos control.
3.2. Operaciones Disponibles
OperaciÃ³n	DescripciÃ³n
sign	Firma un documento (PDF, XML, etc.) con el certificado seleccionado por el usuario.
cosign	AÃ±ade una firma adicional a un documento ya firmado (cofirma).
countersign	Firma sobre las firmas existentes (contrafirma).
getBase64FromText	Utilidad para convertir texto a Base64.
echo	Verifica si AutoFirma estÃ¡ disponible y respondiendo.
3.3. Formatos de Firma Soportados
Formato	DescripciÃ³n	Uso recomendado
PAdES	PDF Advanced Electronic Signatures. Firma embebida en PDF.	Documentos PDF (contratos)
XAdES	XML Advanced Electronic Signatures. Para documentos XML.	Facturas electrÃ³nicas
CAdES	CMS Advanced Electronic Signatures. Firma detached.	Cualquier tipo de archivo
â€ƒ
4. ImplementaciÃ³n en Drupal
4.1. Estructura de Archivos
modules/custom/agroconecta_core/ â”œâ”€â”€ src/ â”‚   â””â”€â”€ Controller/ â”‚       â””â”€â”€ AutoFirmaController.php       â† Endpoints para firma â”œâ”€â”€ js/ â”‚   â”œâ”€â”€ autofirma.js                      â† LibrerÃ­a oficial (descargar) â”‚   â””â”€â”€ agroconecta-firma.js              â† Nuestra integraciÃ³n â”œâ”€â”€ templates/ â”‚   â””â”€â”€ autofirma-modal.html.twig         â† Modal de firma â”œâ”€â”€ agroconecta_core.routing.yml          â† Rutas para API â””â”€â”€ agroconecta_core.libraries.yml        â† DeclaraciÃ³n de JS  themes/custom/agroconecta_theme/ â”œâ”€â”€ templates/ â”‚   â””â”€â”€ paragraphs/ â”‚       â””â”€â”€ paragraph--documento-firma.html.twig  â† Componente visual â””â”€â”€ scss/     â””â”€â”€ components/         â””â”€â”€ _autofirma.scss               â† Estilos del modal
4.2. Obtener la LibrerÃ­a JavaScript de AutoFirma
Descargar la librerÃ­a oficial desde el repositorio del Gobierno:
# Descargar desde GitHub del MinDigital wget https://github.com/ctt-gob-es/clienteafirma/raw/master/afirma-simple/src/main/webapp/js/autofirma.js  # Copiar al mÃ³dulo cp autofirma.js modules/custom/agroconecta_core/js/
4.3. Controller: AutoFirmaController.php
Controlador que gestiona la generaciÃ³n de documentos para firma y la recepciÃ³n de documentos firmados.
<?php // Archivo: src/Controller/AutoFirmaController.php // Ver archivo completo en los entregables
4.4. JavaScript: agroconecta-firma.js
Script que orquesta el flujo de firma en el navegador.
// Archivo: js/agroconecta-firma.js // Ver archivo completo en los entregables
â€ƒ
5. Experiencia de Usuario
5.1. Flujo Visual
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                    PANTALLA: DASHBOARD PRODUCTOR                         â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                                                                          â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚   â”‚  ðŸ“„ DOCUMENTOS PENDIENTES DE FIRMA                                â”‚  â”‚ â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚   â”‚                                                                   â”‚  â”‚ â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚   â”‚  â”‚ ðŸ“‹ Contrato de Alta como Productor                          â”‚ â”‚  â”‚ â”‚   â”‚  â”‚    Estado: â³ Pendiente de firma                             â”‚ â”‚  â”‚ â”‚   â”‚  â”‚    Fecha lÃ­mite: 15/01/2026                                  â”‚ â”‚  â”‚ â”‚   â”‚  â”‚                                                              â”‚ â”‚  â”‚ â”‚   â”‚  â”‚    [ðŸ‘ï¸ Ver documento]  [âœï¸ FIRMAR CON CERTIFICADO]          â”‚ â”‚  â”‚ â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚   â”‚                                                                   â”‚  â”‚ â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚   â”‚  â”‚ ðŸ“‹ DeclaraciÃ³n Responsable - Lote LOTE-202501-001           â”‚ â”‚  â”‚ â”‚   â”‚  â”‚    Estado: âœ… Firmado el 05/01/2026                          â”‚ â”‚  â”‚ â”‚   â”‚  â”‚                                                              â”‚ â”‚  â”‚ â”‚   â”‚  â”‚    [ðŸ“¥ Descargar firmado]  [ðŸ” Verificar firma]             â”‚ â”‚  â”‚ â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚   â”‚                                                                   â”‚  â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚                                                                          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚                               â”‚ Usuario pulsa "FIRMAR CON CERTIFICADO"                               â–¼  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                        MODAL DE FIRMA                                    â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                                                                          â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚   â”‚                     âœï¸ FIRMAR DOCUMENTO                          â”‚  â”‚ â”‚   â”‚                                                                   â”‚  â”‚ â”‚   â”‚   Documento: Contrato de Alta como Productor                     â”‚  â”‚ â”‚   â”‚                                                                   â”‚  â”‚ â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ â”‚   â”‚   â”‚                                                          â”‚   â”‚  â”‚ â”‚   â”‚   â”‚   â³ Conectando con AutoFirma...                         â”‚   â”‚  â”‚ â”‚   â”‚   â”‚                                                          â”‚   â”‚  â”‚ â”‚   â”‚   â”‚   Si AutoFirma no se abre automÃ¡ticamente,              â”‚   â”‚  â”‚ â”‚   â”‚   â”‚   [haga clic aquÃ­ para lanzarlo manualmente]            â”‚   â”‚  â”‚ â”‚   â”‚   â”‚                                                          â”‚   â”‚  â”‚ â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ â”‚   â”‚                                                                   â”‚  â”‚ â”‚   â”‚   â„¹ï¸ Necesita tener instalado AutoFirma y un certificado        â”‚  â”‚ â”‚   â”‚      digital (DNIe o FNMT) en su navegador.                      â”‚  â”‚ â”‚   â”‚                                                                   â”‚  â”‚ â”‚   â”‚   [â“ Ayuda: Instalar AutoFirma]    [âœ–ï¸ Cancelar]                â”‚  â”‚ â”‚   â”‚                                                                   â”‚  â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚                                                                          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚                               â”‚ AutoFirma se abre                               â–¼  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                    AUTOFIRMA (AplicaciÃ³n de escritorio)                  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                                                                          â”‚ â”‚   Seleccione el certificado para firmar:                                â”‚ â”‚                                                                          â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚   â”‚  ðŸ” GARCÃA LÃ“PEZ, MARTA - 12345678A                             â”‚  â”‚ â”‚   â”‚     FNMT Clase 2 CA                                              â”‚  â”‚ â”‚   â”‚     VÃ¡lido hasta: 15/03/2027                                     â”‚  â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚                                                                          â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚   â”‚  ðŸ” DNI ELECTRÃ“NICO - 12345678A                                 â”‚  â”‚ â”‚   â”‚     AC DNIE 001                                                  â”‚  â”‚ â”‚   â”‚     VÃ¡lido hasta: 20/06/2028                                     â”‚  â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚                                                                          â”‚ â”‚                              [Firmar]  [Cancelar]                        â”‚ â”‚                                                                          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
5.2. Estados del Documento
Estado	Icono	DescripciÃ³n
Borrador	ðŸ“	Documento generado, pendiente de enviar para firma
Pendiente	â³	Enviado al usuario, esperando firma
En proceso	ðŸ”„	El usuario ha iniciado el proceso de firma
Firmado	âœ…	Documento firmado correctamente
Rechazado	âŒ	El usuario cancelÃ³ o rechazÃ³ firmar
Expirado	âŒ›	PasÃ³ la fecha lÃ­mite sin firma
â€ƒ
6. Requisitos para el Usuario
6.1. InstalaciÃ³n de AutoFirma
1.	Descargar desde: https://firmaelectronica.gob.es/Home/Descargas.html
2.	Ejecutar instalador (requiere permisos de administrador)
3.	Permitir la instalaciÃ³n del certificado raÃ­z de AutoFirma
4.	Reiniciar el navegador
6.2. Certificado Digital
El usuario necesita uno de estos certificados instalados:
Tipo	ObtenciÃ³n	Coste
FNMT Persona FÃ­sica	sede.fnmt.gob.es + acreditaciÃ³n presencial	Gratuito
DNI ElectrÃ³nico	ComisarÃ­a de PolicÃ­a + lector de tarjetas	~15â‚¬ (lector)
FNMT Representante	Para personas jurÃ­dicas	~14â‚¬/2 aÃ±os
7. GestiÃ³n de Errores
Error	SoluciÃ³n mostrada al usuario
AutoFirma no instalado	"No se detectÃ³ AutoFirma. [Descargar AutoFirma] o [Reintentar]"
Sin certificados	"No se encontraron certificados vÃ¡lidos. [CÃ³mo obtener certificado]"
Certificado caducado	"Su certificado ha caducado. RenuÃ©velo en sede.fnmt.gob.es"
Usuario cancelÃ³	"Firma cancelada. El documento permanece pendiente."
Error de conexiÃ³n	"Error de conexiÃ³n. Verifique que AutoFirma estÃ¡ abierto. [Reintentar]"
8. Consideraciones de Seguridad
â€¢	HTTPS obligatorio: AutoFirma solo funciona en sitios con certificado SSL vÃ¡lido.
â€¢	Token CSRF: Todas las peticiones al servidor incluyen token anti-falsificaciÃ³n.
â€¢	ValidaciÃ³n servidor: El servidor valida la firma antes de aceptar el documento.
â€¢	No almacenar certificados: La clave privada nunca sale del dispositivo del usuario.
â€¢	AuditorÃ­a: Registrar quiÃ©n firmÃ³, cuÃ¡ndo, con quÃ© certificado (sin datos sensibles).
9. Limitaciones Conocidas
â€¢	Solo escritorio: AutoFirma no funciona en mÃ³viles ni tablets. Alternativa: firma diferida o Cl@ve Firma.
â€¢	InstalaciÃ³n requerida: El usuario debe instalar la aplicaciÃ³n previamente.
â€¢	Experiencia tÃ©cnica: Usuarios no tÃ©cnicos pueden encontrar el proceso confuso.
â€¢	Navegadores: Mejor soporte en Chrome y Firefox. Edge y Safari pueden tener problemas.
10. Alternativas Complementarias
Alternativa	DescripciÃ³n	Coste
Cl@ve Firma	Firma en la nube con Cl@ve PIN. Sin instalaciÃ³n. Gobierno de EspaÃ±a.	Gratuito
Viafirma	Servicio cloud comercial. Mejor UX. API REST.	~1â‚¬/firma
Signaturit	Firma avanzada cloud. IntegraciÃ³n sencilla.	~0.5-3â‚¬/firma

