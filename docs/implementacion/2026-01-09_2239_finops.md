# FinOps - OptimizaciÃ³n de Costes Cloud

**Fecha de creaciÃ³n:** 2026-01-09 22:39  
**Ãšltima actualizaciÃ³n:** 2026-01-09 22:39  
**VersiÃ³n:** 1.0.0  
**CategorÃ­a:** ImplementaciÃ³n

---

## ğŸ“‘ Tabla de Contenidos (TOC)

1. [PropÃ³sito](#1-propÃ³sito)
2. [Principios FinOps](#2-principios-finops)
3. [Modelo de Costes](#3-modelo-de-costes)
4. [Estrategias de OptimizaciÃ³n](#4-estrategias-de-optimizaciÃ³n)
5. [AutomatizaciÃ³n](#5-automatizaciÃ³n)
6. [Dashboards y Reporting](#6-dashboards-y-reporting)
7. [Gobernanza de Costes](#7-gobernanza-de-costes)
8. [Registro de Cambios](#8-registro-de-cambios)

---

## 1. PropÃ³sito

FinOps (Financial Operations) permite:

- **Visibilidad** total de costes cloud
- **Responsabilidad** distribuida por equipo/tenant
- **OptimizaciÃ³n** continua de recursos
- **PredicciÃ³n** de costes futuros
- **AlineaciÃ³n** negocio-tecnologÃ­a

---

## 2. Principios FinOps

### 2.1 Fases del Ciclo FinOps

```mermaid
graph LR
    A[INFORM] --> B[OPTIMIZE]
    B --> C[OPERATE]
    C --> A
    
    style A fill:#4CAF50
    style B fill:#2196F3
    style C fill:#FF9800
```

| Fase | Objetivo | Actividades |
|------|----------|-------------|
| **INFORM** | Visibilidad | Dashboards, etiquetado, alertas |
| **OPTIMIZE** | Eficiencia | Right-sizing, reservas, spot |
| **OPERATE** | Gobernanza | PolÃ­ticas, budgets, revisiones |

### 2.2 Responsabilidades

| Rol | Responsabilidad |
|-----|-----------------|
| **Engineering** | Optimizar cÃ³digo y recursos |
| **Finance** | Budgets y forecasting |
| **Business** | Unit economics y ROI |
| **FinOps Lead** | Coordinar y educar |

---

## 3. Modelo de Costes

### 3.1 Estructura de Costes SaaS

```
                    COSTE TOTAL
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INFRA â”‚       â”‚  SaaS â”‚       â”‚ PEOPLEâ”‚
    â”‚  40%  â”‚       â”‚  35%  â”‚       â”‚  25%  â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”˜       â””â”€â”€â”€â”¬â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚
   â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
   â”‚    â”‚    â”‚     â”‚    â”‚    â”‚
  VM   DB  CDN  Stripe Ecwid 3rd-party
```

### 3.2 Costes por CategorÃ­a

| CategorÃ­a | Servicio | Coste Mensual Est. | Notas |
|-----------|----------|-------------------|-------|
| **Compute** | VPS/Container | â‚¬200-500 | Variable por trÃ¡fico |
| **Database** | MariaDB Managed | â‚¬100-300 | Por rÃ©plicas |
| **Cache** | Redis | â‚¬50-100 | Por memoria |
| **Storage** | Object Storage | â‚¬20-50 | Por GB |
| **CDN** | Cloudflare | â‚¬0-100 | Tier free disponible |
| **Backup** | Offsite | â‚¬30-50 | Por retenciÃ³n |
| **Monitoring** | Grafana Cloud | â‚¬0-50 | Tier free disponible |
| **Email** | SMTP Transactional | â‚¬20-100 | Por volumen |
| **Stripe** | Procesamiento | 1.4-2.9% + â‚¬0.25 | Por transacciÃ³n |
| **Ecwid** | E-commerce | â‚¬0-35/tienda | Por plan tenant |

### 3.3 Coste por Tenant

```yaml
# FÃ³rmula de coste por tenant
tenant_cost:
  fixed:
    - platform_share: â‚¬2/mes  # Infraestructura compartida
    
  variable:
    - storage: â‚¬0.05/GB/mes
    - bandwidth: â‚¬0.01/GB
    - api_calls: â‚¬0.001/1000 calls
    - email_sends: â‚¬0.01/email
    
  passthrough:
    - stripe_fees: 1.4% + â‚¬0.25/tx
    - ecwid_subscription: segÃºn plan tenant
```

---

## 4. Estrategias de OptimizaciÃ³n

### 4.1 Right-Sizing

| Recurso | MÃ©trica | AcciÃ³n si < 30% | AcciÃ³n si > 80% |
|---------|---------|-----------------|-----------------|
| CPU | avg_usage | Reducir cores | Aumentar cores |
| Memoria | avg_used | Reducir RAM | Aumentar RAM |
| Disco | avg_iops | Cambiar a HDD | Cambiar a SSD |
| DB Connections | pool_usage | Reducir pool | Aumentar pool |

```promql
# Query para identificar recursos infrautilizados
avg by (instance) (rate(container_cpu_usage_seconds_total[24h])) 
  / on(instance) container_spec_cpu_quota * 100 < 30
```

### 4.2 Instancias Reservadas vs On-Demand

| Tipo | Descuento | Compromiso | Uso Recomendado |
|------|-----------|------------|-----------------|
| **On-Demand** | 0% | Ninguno | Desarrollo, picos |
| **Reserved 1yr** | 30-40% | 1 aÃ±o | ProducciÃ³n estable |
| **Reserved 3yr** | 50-60% | 3 aÃ±os | Core infrastructure |
| **Spot/Preemptible** | 70-90% | Ninguno | Batch, CI/CD |

### 4.3 Spot Instances para Staging

```yaml
# ConfiguraciÃ³n staging con spot instances
staging:
  compute:
    type: spot
    fallback: on-demand
    interruption_handler: graceful_shutdown
    max_price: 50% of on-demand
    
  schedule:
    active_hours: "08:00-20:00 CET"
    weekend: "off"
```

### 4.4 Autoscaling Basado en Coste

```yaml
# HPA con lÃ­mite de coste
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: jaraba-appserver-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: appserver
  minReplicas: 2
  maxReplicas: 10
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Pods
          value: 1
          periodSeconds: 60
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
```

---

## 5. AutomatizaciÃ³n

### 5.1 Apagado AutomÃ¡tico de Staging

```yaml
# ECA Model: Apagar staging fuera de horario
id: finops_staging_shutdown
label: 'FinOps: Apagar Staging Nocturno'
events:
  - plugin: cron
    id: nightly_shutdown
    configuration:
      frequency: '0 20 * * 1-5'  # 20:00 L-V
      
actions:
  - plugin: kubernetes_scale
    id: scale_down_staging
    configuration:
      namespace: jaraba-staging
      replicas: 0
      deployments:
        - appserver
        - worker
        
  - plugin: slack_notification
    id: notify_shutdown
    configuration:
      message: 'ğŸ’¤ Staging apagado. Ahorro estimado: â‚¬X/noche'
```

### 5.2 Alertas de AnomalÃ­as de Coste

```yaml
# Alertmanager: AnomalÃ­a de coste
groups:
  - name: finops
    rules:
      - alert: CostAnomalyDetected
        expr: |
          (cloud_cost_hourly - avg_over_time(cloud_cost_hourly[7d])) 
          / stddev_over_time(cloud_cost_hourly[7d]) > 3
        for: 1h
        labels:
          severity: warning
        annotations:
          summary: "AnomalÃ­a de coste detectada"
          description: "Coste actual {{ $value | humanize }} desviaciones sobre la media"
          
      - alert: BudgetThreshold80
        expr: cloud_cost_mtd / cloud_budget_monthly * 100 > 80
        for: 1h
        labels:
          severity: warning
        annotations:
          summary: "80% del presupuesto mensual consumido"
```

### 5.3 Limpieza AutomÃ¡tica de Recursos

```bash
#!/bin/bash
# Script: cleanup_orphaned_resources.sh

# Eliminar snapshots antiguos (> 30 dÃ­as)
aws ec2 describe-snapshots --owner-ids self \
  --query 'Snapshots[?StartTime<=`'$(date -d '30 days ago' --iso-8601)'`].SnapshotId' \
  --output text | xargs -r aws ec2 delete-snapshot --snapshot-id

# Eliminar volumes no attached
aws ec2 describe-volumes --filters "Name=status,Values=available" \
  --query 'Volumes[*].VolumeId' --output text | \
  xargs -r aws ec2 delete-volume --volume-id

# Eliminar IPs elÃ¡sticas no asociadas
aws ec2 describe-addresses --query 'Addresses[?AssociationId==null].AllocationId' \
  --output text | xargs -r aws ec2 release-address --allocation-id
```

---

## 6. Dashboards y Reporting

### 6.1 Dashboard Ejecutivo

| Panel | Contenido |
|-------|-----------|
| **Coste MTD** | Gauge vs budget |
| **Forecast EOM** | ProyecciÃ³n fin de mes |
| **Coste por Servicio** | Pie chart |
| **Coste por Tenant** | Top 10 consumidores |
| **Tendencia Mensual** | Line chart 12 meses |
| **Ahorro Logrado** | Stat panel vs mes anterior |

### 6.2 Dashboard TÃ©cnico

| Panel | Query |
|-------|-------|
| **CPU Cost Efficiency** | `sum(rate(cpu_usage)) / sum(cpu_requested)` |
| **Memory Waste** | `sum(memory_requested - memory_used)` |
| **Idle Resources** | `count(avg_utilization < 10%)` |
| **Spot Savings** | `sum(spot_discount_amount)` |

### 6.3 Reporte Mensual

```markdown
# Reporte FinOps - [Mes AÃ±o]

## Resumen
- **Coste Total:** â‚¬X,XXX
- **vs Budget:** +X% / -X%
- **vs Mes Anterior:** +X% / -X%

## Costes por CategorÃ­a
| CategorÃ­a | Coste | % Total | Î” Mes Ant. |
|-----------|-------|---------|------------|
| Compute | â‚¬XXX | XX% | +X% |
| Database | â‚¬XXX | XX% | -X% |
| ... | ... | ... | ... |

## Top 5 Tenants por Consumo
1. Tenant A - â‚¬XXX
2. Tenant B - â‚¬XXX
...

## Optimizaciones Aplicadas
- Right-sizing: -â‚¬XXX
- Spot instances: -â‚¬XXX
- Apagado staging: -â‚¬XXX

## Recomendaciones
1. Considerar reserved instances para DB
2. Revisar tenant X por alto consumo
```

---

## 7. Gobernanza de Costes

### 7.1 PolÃ­tica de Etiquetado

Todos los recursos deben tener:

| Tag | Obligatorio | Ejemplo |
|-----|-------------|---------|
| `Environment` | âœ… | production, staging, dev |
| `Service` | âœ… | appserver, database, cache |
| `Team` | âœ… | platform, product |
| `CostCenter` | âœ… | CC-001 |
| `Tenant` | Si aplica | tenant-42 |

```yaml
# Terraform: Enforce tags
resource "aws_instance" "example" {
  # ...
  
  tags = {
    Environment = var.environment
    Service     = "appserver"
    Team        = "platform"
    CostCenter  = "CC-001"
    ManagedBy   = "terraform"
  }
  
  lifecycle {
    prevent_destroy = true
    ignore_changes  = [tags["LastModified"]]
  }
}
```

### 7.2 Presupuestos por Equipo

| Equipo | Budget Mensual | Alertas |
|--------|----------------|---------|
| Platform | â‚¬500 | 50%, 80%, 100% |
| Product | â‚¬300 | 50%, 80%, 100% |
| Data | â‚¬200 | 50%, 80%, 100% |
| QA | â‚¬100 | 80%, 100% |

### 7.3 RevisiÃ³n Trimestral

| Actividad | Responsable | Entregable |
|-----------|-------------|------------|
| AnÃ¡lisis de tendencias | FinOps Lead | Report |
| Right-sizing review | Engineering | Lista de cambios |
| Reservas evaluation | Finance + FinOps | Recomendaciones |
| Budget adjustment | Finance | Nuevos budgets |

---

## 8. Registro de Cambios

| Fecha | VersiÃ³n | Autor | DescripciÃ³n |
|-------|---------|-------|-------------|
| 2026-01-09 | 1.0.0 | IA Asistente | CreaciÃ³n inicial del documento |
