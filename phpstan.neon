# AUDIT-SEC-N11: SAST enhancement â€” PHPStan configuration
# Level raised from 5 to 6 for stronger type-safety and security checks.
# Security-specific rules included via phpstan-security.neon.
includes:
  - phpstan-baseline.neon
  - phpstan-security.neon

parameters:
  # AUDIT-SEC-N11: Level 6 enables union type checks, stricter return types,
  # and better detection of unsafe type coercions relevant to security.
  level: 6

  paths:
    - web/modules/custom

  excludePaths:
    - '*/tests/fixtures/*.php'
    - '*/node_modules/*'
    # Contrib-like module with missing Google AI dependencies.
    - web/modules/custom/ai_provider_google_gemini

  ignoreErrors:
    # new static() is a best practice in Drupal.
    - "#^Unsafe usage of new static#"
    # Common in Drupal modules that mix DI with procedural code.
    - "#Drupal calls should be avoided in classes, use dependency injection instead#"
    # PHP 8 promoted constructor properties get native types but
    # ControllerBase/FormBase/DrushCommands parent declares them without.
    - identifier: property.extraNativeType
    - identifier: property.missingNativeType

  reportUnmatchedIgnoredErrors: false

  tmpDir: phpstan-tmp
